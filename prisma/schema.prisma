// ============================================
// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ… SCADA - Prisma Schema
// ÙˆÙÙ‚ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª ÙÙŠ Ù…Ù„Ù 05_Ù†Ø¸Ø§Ù…_Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©_ÙˆØ§Ù„ØªØ­ÙƒÙ….md
// ============================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

// ============================================
// 1ï¸âƒ£ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© - SCADA (Ø§Ù„Ù…Ù‡Ù…Ø© 24)
// ============================================

/// Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©
model scada_stations {
  id          String    @id @default(uuid()) @db.Uuid
  businessId  String?   @map("business_id") @db.Uuid
  code        String    @unique @db.VarChar(20)
  name        String    @db.VarChar(200)
  nameEn      String?   @map("name_en") @db.VarChar(200)
  type        String    @db.VarChar(50) // main, substation, distribution, solar
  voltageLevel String?  @map("voltage_level") @db.VarChar(20) // HV, MV, LV
  latitude    Decimal?  @db.Decimal(10, 8)
  longitude   Decimal?  @db.Decimal(11, 8)
  address     String?   @db.VarChar(500)
  capacity    Decimal?  @db.Decimal(15, 2) // MVA
  status      String    @default("online") @db.VarChar(20) // online, offline, maintenance
  lastSyncAt  DateTime? @map("last_sync_at")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  devices           scada_devices[]
  monitoringPoints  monitoring_points[]
  alerts            alerts[]
  controlCommands   control_commands[]
  energySummaries   energy_summary[]
  qualityMetrics    quality_metrics[]
  reliabilityMetrics reliability_metrics[]
  incidents         incidents[]
  safetyInspections safety_inspections[]
  accessPoints      access_points[]
  cameras           cameras[]
  securityEvents    security_events[]
  integratedDevices integrated_devices[]

  @@map("scada_stations")
}

/// Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© (Ø§Ù„Ù…Ø­ÙˆÙ„Ø§ØªØŒ Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ØŒ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª)
model scada_devices {
  id          String    @id @default(uuid()) @db.Uuid
  stationId   String    @map("station_id") @db.Uuid
  code        String    @unique @db.VarChar(50)
  name        String    @db.VarChar(200)
  nameEn      String?   @map("name_en") @db.VarChar(200)
  type        String    @db.VarChar(50) // transformer, breaker, meter, feeder, panel
  manufacturer String?  @db.VarChar(100)
  model       String?   @db.VarChar(100)
  serialNumber String?  @map("serial_number") @db.VarChar(100)
  protocol    String    @db.VarChar(50) // modbus_tcp, modbus_rtu, mqtt, http
  ipAddress   String?   @map("ip_address") @db.VarChar(50)
  port        Int?
  slaveId     Int?      @map("slave_id")
  status      String    @default("online") @db.VarChar(20)
  lastReadAt  DateTime? @map("last_read_at")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station         scada_stations @relation(fields: [stationId], references: [id])
  monitoringPoints monitoring_points[]
  controlCommands control_commands[]

  @@map("scada_devices")
}

/// Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (monitoring_points)
model monitoring_points {
  id            String    @id @default(uuid()) @db.Uuid
  businessId    String?   @map("business_id") @db.Uuid
  stationId     String    @map("station_id") @db.Uuid
  deviceId      String?   @map("device_id") @db.Uuid
  pointCode     String    @map("point_code") @db.VarChar(50)
  name          String    @db.VarChar(255)
  pointType     String    @map("point_type") @db.VarChar(20) // analog, digital, calculated
  dataType      String    @map("data_type") @db.VarChar(50) // voltage, current, power, temperature, frequency, status
  unit          String?   @db.VarChar(20)
  sourceType    String?   @map("source_type") @db.VarChar(50) // generator, solar_panel, meter, sensor
  sourceId      String?   @map("source_id") @db.Uuid
  minValue      Decimal?  @map("min_value") @db.Decimal(15, 4)
  maxValue      Decimal?  @map("max_value") @db.Decimal(15, 4)
  warningLow    Decimal?  @map("warning_low") @db.Decimal(15, 4)
  warningHigh   Decimal?  @map("warning_high") @db.Decimal(15, 4)
  alarmLow      Decimal?  @map("alarm_low") @db.Decimal(15, 4)
  alarmHigh     Decimal?  @map("alarm_high") @db.Decimal(15, 4)
  modbusAddress String?   @map("modbus_address") @db.VarChar(50)
  scaleFactor   Decimal   @default(1) @map("scale_factor") @db.Decimal(10, 4)
  scanInterval  Int       @default(5) @map("scan_interval") // Ø«ÙˆØ§Ù†ÙŠ
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station       scada_stations @relation(fields: [stationId], references: [id])
  device        scada_devices? @relation(fields: [deviceId], references: [id])
  liveReadings  live_readings[]
  readingsHistory readings_history[]
  alerts        alerts[]

  @@unique([stationId, pointCode])
  @@map("scada_monitoring_points")
}

/// Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­ÙŠØ© (live_readings)
model live_readings {
  id          String   @id @default(uuid()) @db.Uuid
  pointId     String   @map("point_id") @db.Uuid
  readingTime DateTime @default(now()) @map("reading_time")
  value       Decimal  @db.Decimal(15, 4)
  quality     String   @default("good") @db.VarChar(20) // good, bad, uncertain
  status      String   @default("normal") @db.VarChar(20) // normal, warning, alarm

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  point       monitoring_points @relation(fields: [pointId], references: [id])

  @@index([pointId, readingTime])
  @@map("scada_live_readings")
}

/// Ø³Ø¬Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª (readings_history)
model readings_history {
  id              String   @id @default(uuid()) @db.Uuid
  pointId         String   @map("point_id") @db.Uuid
  readingTime     DateTime @map("reading_time")
  value           Decimal  @db.Decimal(15, 4)
  quality         String   @default("good") @db.VarChar(20)
  aggregationType String   @default("raw") @map("aggregation_type") @db.VarChar(20) // raw, hourly, daily, monthly

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  point           monitoring_points @relation(fields: [pointId], references: [id])

  @@index([pointId, readingTime])
  @@index([aggregationType, readingTime])
  @@map("scada_readings_history")
}

/// Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (alerts)
model alerts {
  id              String    @id @default(uuid()) @db.Uuid
  businessId      String?   @map("business_id") @db.Uuid
  stationId       String    @map("station_id") @db.Uuid
  pointId         String?   @map("point_id") @db.Uuid
  alertCode       String    @map("alert_code") @db.VarChar(50)
  alertType       String    @map("alert_type") @db.VarChar(20) // warning, alarm, critical
  severity        String    @db.VarChar(20) // low, medium, high, critical
  title           String    @db.VarChar(255)
  message         String    @db.Text
  sourceType      String?   @map("source_type") @db.VarChar(50)
  sourceId        String?   @map("source_id") @db.Uuid
  value           Decimal?  @db.Decimal(15, 4)
  threshold       Decimal?  @db.Decimal(15, 4)
  status          String    @default("active") @db.VarChar(20) // active, acknowledged, resolved, escalated
  triggeredAt     DateTime  @default(now()) @map("triggered_at")
  acknowledgedBy  String?   @map("acknowledged_by") @db.Uuid
  acknowledgedAt  DateTime? @map("acknowledged_at")
  resolvedBy      String?   @map("resolved_by") @db.Uuid
  resolvedAt      DateTime? @map("resolved_at")
  resolutionNotes String?   @map("resolution_notes") @db.Text
  workOrderId     String?   @map("work_order_id") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station         scada_stations @relation(fields: [stationId], references: [id])
  point           monitoring_points? @relation(fields: [pointId], references: [id])

  @@index([stationId])
  @@index([severity])
  @@index([status])
  @@map("scada_alerts")
}

/// Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (alert_rules)
model alert_rules {
  id                    String   @id @default(uuid()) @db.Uuid
  businessId            String?  @map("business_id") @db.Uuid
  name                  String   @db.VarChar(255)
  description           String?  @db.Text
  ruleType              String   @map("rule_type") @db.VarChar(50) // threshold, rate_of_change, pattern, custom
  condition             Json     @default("{}")
  alertType             String   @map("alert_type") @db.VarChar(20)
  severity              String   @db.VarChar(20)
  messageTemplate       String?  @map("message_template") @db.Text
  notificationChannels  Json     @default("[]") @map("notification_channels") // sms, email, push, telegram
  escalationRules       Json?    @map("escalation_rules")
  autoCreateWorkOrder   Boolean  @default(false) @map("auto_create_work_order")
  isActive              Boolean  @default(true) @map("is_active")
  createdAt             DateTime @default(now()) @map("created_at")

  @@map("scada_alert_rules")
}

/// Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ­ÙƒÙ… (control_commands)
model control_commands {
  id           String    @id @default(uuid()) @db.Uuid
  businessId   String?   @map("business_id") @db.Uuid
  stationId    String    @map("station_id") @db.Uuid
  deviceId     String?   @map("device_id") @db.Uuid
  targetType   String    @map("target_type") @db.VarChar(50) // generator, switch, breaker, meter
  targetId     String    @map("target_id") @db.Uuid
  commandType  String    @map("command_type") @db.VarChar(50) // start, stop, open, close, set_value
  commandValue String?   @map("command_value") @db.VarChar(255)
  parameters   Json      @default("{}")
  status       String    @default("pending") @db.VarChar(20) // pending, sent, executed, failed, cancelled
  issuedBy     String    @map("issued_by") @db.Uuid
  issuedAt     DateTime  @default(now()) @map("issued_at")
  executedAt   DateTime? @map("executed_at")
  result       String?   @db.Text
  notes        String?   @db.Text
  createdAt    DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station      scada_stations @relation(fields: [stationId], references: [id])
  device       scada_devices? @relation(fields: [deviceId], references: [id])

  @@index([stationId])
  @@index([status])
  @@map("scada_control_commands")
}

// ============================================
// 2ï¸âƒ£ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (Ø§Ù„Ù…Ù‡Ù…Ø© 25)
// ============================================

/// Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ø§Ù‚Ø© (energy_summary)
model energy_summary {
  id               String   @id @default(uuid()) @db.Uuid
  businessId       String?  @map("business_id") @db.Uuid
  stationId        String   @map("station_id") @db.Uuid
  summaryDate      DateTime @map("summary_date") @db.Date
  summaryType      String   @map("summary_type") @db.VarChar(20) // hourly, daily, monthly, yearly
  totalGeneration  Decimal? @map("total_generation") @db.Decimal(15, 4) // kWh
  dieselGeneration Decimal? @map("diesel_generation") @db.Decimal(15, 4)
  solarGeneration  Decimal? @map("solar_generation") @db.Decimal(15, 4)
  totalConsumption Decimal? @map("total_consumption") @db.Decimal(15, 4)
  gridLosses       Decimal? @map("grid_losses") @db.Decimal(15, 4)
  lossPercentage   Decimal? @map("loss_percentage") @db.Decimal(5, 2)
  peakDemand       Decimal? @map("peak_demand") @db.Decimal(15, 4) // kW
  peakTime         DateTime? @map("peak_time") @db.Time()
  minDemand        Decimal? @map("min_demand") @db.Decimal(15, 4)
  averageDemand    Decimal? @map("average_demand") @db.Decimal(15, 4)
  powerFactor      Decimal? @map("power_factor") @db.Decimal(4, 3)
  fuelConsumed     Decimal? @map("fuel_consumed") @db.Decimal(15, 4) // Ù„ØªØ±
  fuelEfficiency   Decimal? @map("fuel_efficiency") @db.Decimal(10, 4) // kWh/Ù„ØªØ±
  createdAt        DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station          scada_stations @relation(fields: [stationId], references: [id])

  @@unique([stationId, summaryDate, summaryType])
  @@index([summaryDate])
  @@map("scada_energy_summary")
}

/// ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (consumption_analysis)
model consumption_analysis {
  id                   String   @id @default(uuid()) @db.Uuid
  businessId           String?  @map("business_id") @db.Uuid
  analysisDate         DateTime @map("analysis_date") @db.Date
  analysisType         String   @map("analysis_type") @db.VarChar(50) // by_station, by_cable, by_customer_type, by_tariff
  groupKey             String   @map("group_key") @db.VarChar(255)
  groupName            String   @map("group_name") @db.VarChar(255)
  consumption          Decimal  @db.Decimal(15, 4)
  percentage           Decimal? @db.Decimal(5, 2)
  customerCount        Int?     @map("customer_count")
  averagePerCustomer   Decimal? @map("average_per_customer") @db.Decimal(15, 4)
  comparisonPrevious   Decimal? @map("comparison_previous") @db.Decimal(15, 4)
  growthRate           Decimal? @map("growth_rate") @db.Decimal(5, 2)
  createdAt            DateTime @default(now()) @map("created_at")

  @@index([analysisDate])
  @@map("scada_consumption_analysis")
}

/// ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù„Ø¨ (demand_forecast)
model demand_forecast {
  id              String   @id @default(uuid()) @db.Uuid
  businessId      String?  @map("business_id") @db.Uuid
  stationId       String   @map("station_id") @db.Uuid
  forecastDate    DateTime @map("forecast_date") @db.Date
  forecastHour    Int      @map("forecast_hour")
  predictedDemand Decimal  @map("predicted_demand") @db.Decimal(15, 4)
  confidenceLevel Decimal? @map("confidence_level") @db.Decimal(5, 2)
  modelUsed       String?  @map("model_used") @db.VarChar(100)
  actualDemand    Decimal? @map("actual_demand") @db.Decimal(15, 4)
  accuracy        Decimal? @db.Decimal(5, 2)
  createdAt       DateTime @default(now()) @map("created_at")

  @@index([forecastDate])
  @@map("scada_demand_forecast")
}

// ============================================
// 3ï¸âƒ£ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© (Ø§Ù„Ù…Ù‡Ù…Ø© 26)
// ============================================

/// Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© (quality_metrics)
model quality_metrics {
  id                String   @id @default(uuid()) @db.Uuid
  businessId        String?  @map("business_id") @db.Uuid
  stationId         String   @map("station_id") @db.Uuid
  metricDate        DateTime @map("metric_date") @db.Date
  metricType        String   @map("metric_type") @db.VarChar(50) // voltage_quality, frequency_stability, power_factor, harmonics
  averageValue      Decimal? @map("average_value") @db.Decimal(15, 4)
  minValue          Decimal? @map("min_value") @db.Decimal(15, 4)
  maxValue          Decimal? @map("max_value") @db.Decimal(15, 4)
  violationsCount   Int?     @map("violations_count")
  complianceRate    Decimal? @map("compliance_rate") @db.Decimal(5, 2)
  standardReference String?  @map("standard_reference") @db.VarChar(100)
  createdAt         DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station           scada_stations @relation(fields: [stationId], references: [id])

  @@index([metricDate])
  @@map("scada_quality_metrics")
}

/// Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© (reliability_metrics)
model reliability_metrics {
  id                   String   @id @default(uuid()) @db.Uuid
  businessId           String?  @map("business_id") @db.Uuid
  stationId            String   @map("station_id") @db.Uuid
  periodStart          DateTime @map("period_start") @db.Date
  periodEnd            DateTime @map("period_end") @db.Date
  saifi                Decimal? @db.Decimal(10, 4) // Ù…Ø¹Ø¯Ù„ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹
  saidi                Decimal? @db.Decimal(10, 4) // Ù…Ø¹Ø¯Ù„ Ù…Ø¯Ø© Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹
  caidi                Decimal? @db.Decimal(10, 4) // Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø§Ù†Ù‚Ø·Ø§Ø¹
  asai                 Decimal? @db.Decimal(10, 6) // Ù…Ø¤Ø´Ø± ØªÙˆÙØ± Ø§Ù„Ø®Ø¯Ù…Ø©
  totalOutages         Int?     @map("total_outages")
  plannedOutages       Int?     @map("planned_outages")
  unplannedOutages     Int?     @map("unplanned_outages")
  totalDurationMinutes Int?     @map("total_duration_minutes")
  customersAffected    Int?     @map("customers_affected")
  createdAt            DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station              scada_stations @relation(fields: [stationId], references: [id])

  @@index([periodStart, periodEnd])
  @@map("scada_reliability_metrics")
}

/// Ø§Ù„Ø­ÙˆØ§Ø¯Ø« (incidents)
model incidents {
  id                String    @id @default(uuid()) @db.Uuid
  businessId        String?   @map("business_id") @db.Uuid
  stationId         String    @map("station_id") @db.Uuid
  incidentNumber    String    @unique @map("incident_number") @db.VarChar(20)
  incidentType      String    @map("incident_type") @db.VarChar(50) // outage, equipment_failure, safety, fire, theft
  severity          String    @db.VarChar(20) // minor, moderate, major, critical
  title             String    @db.VarChar(255)
  description       String?   @db.Text
  location          String?   @db.VarChar(255)
  occurredAt        DateTime  @map("occurred_at")
  detectedAt        DateTime? @map("detected_at")
  reportedBy        String?   @map("reported_by") @db.Uuid
  status            String    @default("open") @db.VarChar(20) // open, investigating, resolved, closed
  rootCause         String?   @map("root_cause") @db.Text
  correctiveActions String?   @map("corrective_actions") @db.Text
  preventiveActions String?   @map("preventive_actions") @db.Text
  resolvedAt        DateTime? @map("resolved_at")
  closedAt          DateTime? @map("closed_at")
  attachments       Json?     @default("[]")
  createdAt         DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station           scada_stations @relation(fields: [stationId], references: [id])

  @@index([incidentType])
  @@index([status])
  @@map("scada_incidents")
}

/// Ø§Ù„ÙØ­ÙˆØµØ§Øª (safety_inspections)
model safety_inspections {
  id               String    @id @default(uuid()) @db.Uuid
  businessId       String?   @map("business_id") @db.Uuid
  stationId        String    @map("station_id") @db.Uuid
  inspectionNumber String    @unique @map("inspection_number") @db.VarChar(20)
  inspectionType   String    @map("inspection_type") @db.VarChar(50) // routine, safety, compliance, audit
  scheduledDate    DateTime  @map("scheduled_date") @db.Date
  performedDate    DateTime? @map("performed_date") @db.Date
  inspectorId      String?   @map("inspector_id") @db.Uuid
  checklistId      String?   @map("checklist_id") @db.Uuid
  status           String    @default("scheduled") @db.VarChar(20) // scheduled, in_progress, completed, cancelled
  overallResult    String?   @map("overall_result") @db.VarChar(20) // pass, fail, conditional
  findingsCount    Int?      @map("findings_count")
  criticalFindings Int?      @map("critical_findings")
  report           String?   @db.Text
  attachments      Json?     @default("[]")
  createdAt        DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station          scada_stations @relation(fields: [stationId], references: [id])

  @@index([scheduledDate])
  @@index([status])
  @@map("scada_safety_inspections")
}

// ============================================
// 4ï¸âƒ£ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© (Ø§Ù„Ù…Ù‡Ù…Ø© 27)
// ============================================

/// Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆØµÙˆÙ„ (access_points)
model access_points {
  id           String   @id @default(uuid()) @db.Uuid
  businessId   String?  @map("business_id") @db.Uuid
  stationId    String   @map("station_id") @db.Uuid
  pointCode    String   @map("point_code") @db.VarChar(50)
  name         String   @db.VarChar(255)
  pointType    String   @map("point_type") @db.VarChar(20) // gate, door, cabinet
  location     String?  @db.VarChar(255)
  accessMethod String   @map("access_method") @db.VarChar(20) // card, biometric, code, key
  isMonitored  Boolean  @default(true) @map("is_monitored")
  cameraId     String?  @map("camera_id") @db.Uuid
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station      scada_stations @relation(fields: [stationId], references: [id])
  accessLogs   access_log[]

  @@unique([stationId, pointCode])
  @@map("scada_access_points")
}

/// Ø³Ø¬Ù„ Ø§Ù„ÙˆØµÙˆÙ„ (access_log)
model access_log {
  id            String   @id @default(uuid()) @db.Uuid
  accessPointId String   @map("access_point_id") @db.Uuid
  userId        String?  @map("user_id") @db.Uuid
  accessTime    DateTime @default(now()) @map("access_time")
  accessType    String   @map("access_type") @db.VarChar(10) // entry, exit
  accessMethod  String   @map("access_method") @db.VarChar(20)
  status        String   @db.VarChar(20) // granted, denied, forced
  cardNumber    String?  @map("card_number") @db.VarChar(50)
  notes         String?  @db.Text

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  accessPoint   access_points @relation(fields: [accessPointId], references: [id])

  @@index([accessTime])
  @@map("scada_access_log")
}

/// Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§Øª (cameras)
model cameras {
  id               String   @id @default(uuid()) @db.Uuid
  businessId       String?  @map("business_id") @db.Uuid
  stationId        String   @map("station_id") @db.Uuid
  cameraCode       String   @map("camera_code") @db.VarChar(50)
  name             String   @db.VarChar(255)
  location         String?  @db.VarChar(255)
  cameraType       String   @map("camera_type") @db.VarChar(20) // fixed, ptz, dome
  ipAddress        String?  @map("ip_address") @db.VarChar(50)
  streamUrl        String?  @map("stream_url") @db.VarChar(500)
  recordingEnabled Boolean  @default(true) @map("recording_enabled")
  motionDetection  Boolean  @default(true) @map("motion_detection")
  status           String   @default("online") @db.VarChar(20) // online, offline, maintenance
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station          scada_stations @relation(fields: [stationId], references: [id])

  @@unique([stationId, cameraCode])
  @@map("scada_cameras")
}

/// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ù…Ø§Ù† (security_events)
model security_events {
  id              String    @id @default(uuid()) @db.Uuid
  businessId      String?   @map("business_id") @db.Uuid
  stationId       String    @map("station_id") @db.Uuid
  eventType       String    @map("event_type") @db.VarChar(50) // intrusion, motion, door_forced, camera_offline, alarm
  severity        String    @db.VarChar(20)
  sourceType      String?   @map("source_type") @db.VarChar(50)
  sourceId        String?   @map("source_id") @db.Uuid
  description     String?   @db.Text
  occurredAt      DateTime  @default(now()) @map("occurred_at")
  status          String    @default("new") @db.VarChar(20) // new, acknowledged, investigating, resolved, false_alarm
  acknowledgedBy  String?   @map("acknowledged_by") @db.Uuid
  acknowledgedAt  DateTime? @map("acknowledged_at")
  resolvedBy      String?   @map("resolved_by") @db.Uuid
  resolvedAt      DateTime? @map("resolved_at")
  resolutionNotes String?   @map("resolution_notes") @db.Text
  videoClip       String?   @map("video_clip") @db.VarChar(500)
  createdAt       DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station         scada_stations @relation(fields: [stationId], references: [id])

  @@index([eventType])
  @@index([status])
  @@map("scada_security_events")
}

// ============================================
// 5ï¸âƒ£ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (Ø§Ù„Ù…Ù‡Ù…Ø© 28)
// ============================================

/// Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© (integrated_devices)
model integrated_devices {
  id               String    @id @default(uuid()) @db.Uuid
  businessId       String?   @map("business_id") @db.Uuid
  stationId        String    @map("station_id") @db.Uuid
  deviceCode       String    @unique @map("device_code") @db.VarChar(50)
  name             String    @db.VarChar(255)
  deviceType       String    @map("device_type") @db.VarChar(50) // sts_meter, iot_sensor, acrel_meter
  manufacturer     String?   @db.VarChar(255)
  model            String?   @db.VarChar(255)
  serialNumber     String?   @map("serial_number") @db.VarChar(100)
  ipAddress        String?   @map("ip_address") @db.VarChar(50)
  port             Int?
  protocol         String    @db.VarChar(50) // modbus, mqtt, http, proprietary
  connectionParams Json?     @map("connection_params")
  pollingInterval  Int       @default(60) @map("polling_interval") // Ø«ÙˆØ§Ù†ÙŠ
  lastCommunication DateTime? @map("last_communication")
  status           String    @default("offline") @db.VarChar(20) // online, offline, error
  isActive         Boolean   @default(true) @map("is_active")
  createdAt        DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  station          scada_stations @relation(fields: [stationId], references: [id])
  communicationLogs device_communication_log[]

  @@map("scada_integrated_devices")
}

/// Ø³Ø¬Ù„ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª (device_communication_log)
model device_communication_log {
  id                String   @id @default(uuid()) @db.Uuid
  deviceId          String   @map("device_id") @db.Uuid
  communicationTime DateTime @default(now()) @map("communication_time")
  direction         String   @db.VarChar(10) // inbound, outbound
  messageType       String?  @map("message_type") @db.VarChar(100)
  request           String?  @db.Text
  response          String?  @db.Text
  status            String   @db.VarChar(20) // success, failed, timeout
  errorMessage      String?  @map("error_message") @db.Text
  durationMs        Int?     @map("duration_ms")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  device            integrated_devices @relation(fields: [deviceId], references: [id])

  @@index([communicationTime])
  @@map("scada_device_communication_log")
}

/// Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (sync_tasks)
model sync_tasks {
  id           String    @id @default(uuid()) @db.Uuid
  businessId   String?   @map("business_id") @db.Uuid
  taskName     String    @map("task_name") @db.VarChar(255)
  taskType     String    @map("task_type") @db.VarChar(50) // data_collection, command_execution, sync
  sourceSystem String?   @map("source_system") @db.VarChar(100)
  targetSystem String?   @map("target_system") @db.VarChar(100)
  schedule     String?   @db.VarChar(100) // cron expression
  lastRun      DateTime? @map("last_run")
  nextRun      DateTime? @map("next_run")
  status       String    @default("active") @db.VarChar(20) // active, paused, failed
  lastResult   String?   @map("last_result") @db.Text
  errorCount   Int       @default(0) @map("error_count")
  isActive     Boolean   @default(true) @map("is_active")
  createdAt    DateTime  @default(now()) @map("created_at")

  @@map("scada_sync_tasks")
}

/// Ø³Ø¬Ù„ Ø§Ù„ÙØµÙ„/Ø§Ù„ÙˆØµÙ„ (meter_control_log)
model meter_control_log {
  id            String    @id @default(uuid()) @db.Uuid
  businessId    String?   @map("business_id") @db.Uuid
  customerId    String?   @map("customer_id") @db.Uuid
  meterId       String    @map("meter_id") @db.Uuid
  actionType    String    @map("action_type") @db.VarChar(20) // disconnect, reconnect, tariff_change
  triggerType   String    @map("trigger_type") @db.VarChar(50) // auto_overdue, manual, payment_received
  invoiceId     String?   @map("invoice_id") @db.Uuid
  paymentId     String?   @map("payment_id") @db.Uuid
  status        String    @default("pending") @db.VarChar(20) // pending, success, failed
  acrelResponse Json?     @map("acrel_response")
  executedAt    DateTime? @map("executed_at")
  executedBy    String?   @map("executed_by") @db.Uuid
  notes         String?   @db.Text
  createdAt     DateTime  @default(now()) @map("created_at")

  @@index([meterId])
  @@index([actionType])
  @@map("scada_meter_control_log")
}

// ============================================
// 6ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
// ============================================

/// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (system_settings)
model system_settings {
  id        String   @id @default(uuid()) @db.Uuid
  key       String   @unique @db.VarChar(100)
  value     String   @db.Text
  category  String   @db.VarChar(50)
  description String? @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("scada_system_settings")
}

/// Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (event_logs)
model event_logs {
  id          String   @id @default(uuid()) @db.Uuid
  eventType   String   @map("event_type") @db.VarChar(50)
  entityType  String?  @map("entity_type") @db.VarChar(50)
  entityId    String?  @map("entity_id") @db.Uuid
  userId      String?  @map("user_id") @db.Uuid
  action      String   @db.VarChar(50)
  details     Json?    @default("{}")
  ipAddress   String?  @map("ip_address") @db.VarChar(50)
  userAgent   String?  @map("user_agent") @db.VarChar(500)
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([eventType])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("scada_event_logs")
}

/// Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (notifications)
model notifications {
  id          String    @id @default(uuid()) @db.Uuid
  userId      String?   @map("user_id") @db.Uuid
  type        String    @db.VarChar(50) // alert, info, warning, success
  channel     String    @db.VarChar(20) // push, email, sms, telegram
  title       String    @db.VarChar(255)
  message     String    @db.Text
  data        Json?     @default("{}")
  status      String    @default("pending") @db.VarChar(20) // pending, sent, delivered, failed
  sentAt      DateTime? @map("sent_at")
  readAt      DateTime? @map("read_at")
  createdAt   DateTime  @default(now()) @map("created_at")

  @@index([userId])
  @@index([status])
  @@map("scada_notifications")
}


// ============================================
// 7ï¸âƒ£ Ø§Ù„ØªÙˆØ£Ù… Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ø´Ø¨ÙƒØ© (Digital Twin)
// ============================================

/// Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© (geo_locations)
model geo_locations {
  id              String    @id @default(uuid()) @db.Uuid
  entityType      String    @map("entity_type") @db.VarChar(50) // customer, asset, warehouse, technician, distribution_box, network_node
  entityId        String    @map("entity_id") @db.Uuid
  latitude        Decimal   @db.Decimal(10, 8)
  longitude       Decimal   @db.Decimal(11, 8)
  altitude        Decimal?  @db.Decimal(8, 2)
  accuracyMeters  Decimal?  @map("accuracy_meters") @db.Decimal(6, 2)
  source          String    @default("manual") @db.VarChar(20) // manual, gps_app, imported, surveyed
  addressText     String?   @map("address_text") @db.Text
  district        String?   @db.VarChar(100)
  city            String?   @db.VarChar(100)
  region          String?   @db.VarChar(100)
  locationType    String?   @map("location_type") @db.VarChar(50) // primary, secondary, meter_location
  notes           String?   @db.Text
  recordedBy      String?   @map("recorded_by") @db.Uuid
  recordedAt      DateTime  @default(now()) @map("recorded_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@unique([entityType, entityId, locationType])
  @@index([latitude, longitude])
  @@index([entityType, entityId])
  @@map("scada_geo_locations")
}

/// Ø¹Ù‚Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ© (network_nodes)
model network_nodes {
  id                String    @id @default(uuid()) @db.Uuid
  stationId         String?   @map("station_id") @db.Uuid
  nodeCode          String    @unique @map("node_code") @db.VarChar(30)
  nodeName          String?   @map("node_name") @db.VarChar(100)
  nodeType          String    @map("node_type") @db.VarChar(30) // substation, pole, distribution_box, transformer, junction, attachment_point, meter_point
  latitude          Decimal   @db.Decimal(10, 8)
  longitude         Decimal   @db.Decimal(11, 8)
  altitude          Decimal?  @db.Decimal(8, 2)
  owner             String?   @db.VarChar(50) // company, government, private
  installationDate  DateTime? @map("installation_date") @db.Date
  status            String    @default("active") @db.VarChar(20) // active, planned, decommissioned
  properties        Json?     @default("{}")
  lastInspectionDate DateTime? @map("last_inspection_date") @db.Date
  condition         String?   @db.VarChar(20) // good, fair, poor, critical
  assetId           String?   @map("asset_id") @db.Uuid
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  components        node_components[]
  segmentsFrom      network_segments[] @relation("FromNode")
  segmentsTo        network_segments[] @relation("ToNode")

  @@index([nodeType])
  @@index([stationId])
  @@index([latitude, longitude])
  @@map("scada_network_nodes")
}

/// Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø¹Ù‚Ø¯Ø© (node_components)
model node_components {
  id                String    @id @default(uuid()) @db.Uuid
  nodeId            String    @map("node_id") @db.Uuid
  componentCode     String?   @map("component_code") @db.VarChar(30)
  componentType     String    @map("component_type") @db.VarChar(50) // tension_clamp, suspension_clamp, insulator, fuse, switch, arrester
  manufacturer      String?   @db.VarChar(100)
  model             String?   @db.VarChar(100)
  serialNumber      String?   @map("serial_number") @db.VarChar(50)
  installationDate  DateTime? @map("installation_date") @db.Date
  condition         String    @default("good") @db.VarChar(20)
  lastInspectionDate DateTime? @map("last_inspection_date") @db.Date
  unitCost          Decimal?  @map("unit_cost") @db.Decimal(10, 2)
  notes             String?   @db.Text
  createdAt         DateTime  @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  node              network_nodes @relation(fields: [nodeId], references: [id], onDelete: Cascade)

  @@map("scada_node_components")
}

/// Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ© (network_segments)
model network_segments {
  id                String    @id @default(uuid()) @db.Uuid
  stationId         String?   @map("station_id") @db.Uuid
  segmentCode       String    @unique @map("segment_code") @db.VarChar(30)
  fromNodeId        String    @map("from_node_id") @db.Uuid
  toNodeId          String    @map("to_node_id") @db.Uuid
  cableType         String    @map("cable_type") @db.VarChar(50) // ABC, bare_conductor, underground, fiber_optic
  cableSizeMm2      Decimal?  @map("cable_size_mm2") @db.Decimal(6, 2)
  cableMaterial     String?   @map("cable_material") @db.VarChar(30) // aluminum, copper, ACSR
  lengthMeters      Decimal?  @map("length_meters") @db.Decimal(10, 2)
  calculatedLength  Decimal?  @map("calculated_length") @db.Decimal(10, 2)
  voltageLevel      String?   @map("voltage_level") @db.VarChar(20) // LV, MV, HV
  maxCurrentAmps    Decimal?  @map("max_current_amps") @db.Decimal(8, 2)
  resistancePerKm   Decimal?  @map("resistance_per_km") @db.Decimal(8, 4)
  installationDate  DateTime? @map("installation_date") @db.Date
  status            String    @default("active") @db.VarChar(20)
  condition         String    @default("good") @db.VarChar(20)
  costPerMeter      Decimal?  @map("cost_per_meter") @db.Decimal(10, 2)
  assetId           String?   @map("asset_id") @db.Uuid
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  fromNode          network_nodes @relation("FromNode", fields: [fromNodeId], references: [id])
  toNode            network_nodes @relation("ToNode", fields: [toNodeId], references: [id])

  @@map("scada_network_segments")
}


// ============================================
// ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„ØªÙÙˆÙŠØ¶ - Authentication & Authorization
// ============================================

/// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
model scada_users {
  id          String    @id @default(uuid()) @db.Uuid
  username    String    @unique @db.VarChar(50)
  email       String    @unique @db.VarChar(100)
  password    String    @db.VarChar(255)
  fullName    String    @map("full_name") @db.VarChar(200)
  role        String    @default("viewer") @db.VarChar(20) // admin, operator, viewer, engineer
  isActive    Boolean   @default(true) @map("is_active")
  lastLoginAt DateTime? @map("last_login_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at") // Soft Delete

  @@map("scada_users")
}

/// Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª - Audit Trail
model scada_audit_log {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String?  @map("user_id") @db.Uuid
  action      String   @db.VarChar(50) // create, update, delete, login, logout
  entityType  String   @map("entity_type") @db.VarChar(50)
  entityId    String?  @map("entity_id") @db.Uuid
  oldValues   Json?    @map("old_values")
  newValues   Json?    @map("new_values")
  ipAddress   String?  @map("ip_address") @db.VarChar(45)
  userAgent   String?  @map("user_agent") @db.VarChar(500)
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("scada_audit_log")
}
