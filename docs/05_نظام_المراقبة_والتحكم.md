# ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู (Monitoring & Control System)

> **ุขุฎุฑ ุชุญุฏูุซ:** ุฏูุณูุจุฑ 2024
> **ุงูุญุงูุฉ:** ุชุตููู ููุงุฆู
> **ุงููุตุฏุฑ:** ุงูููุงู 24-28 ูู ููู ุงูุชู ุฏู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู ูููุฑ ุฑุคูุฉ ุดุงููุฉ ูุชุญูู ูุนูู ูู ุฌููุน ููููุงุช ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉุ ููุดูู:

---

## ๐๏ธ ุงุณุชุฑุงุชูุฌูุฉ ุชุฎุฒูู ุงูุจูุงูุงุช (Data Storage Strategy)

> **ูุจุฏุฃ ุฃุณุงุณู:** ููุตุฉ Acrel IoT-EMS ุงููุญููุฉ ุชุญุชูู ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุฒูููุฉ (TSDB) ูุญุณูููุฉ ููุจูุงูุงุช ุงูููุฑุจุงุฆูุฉ. ูุชุฌูุจ ุงูุชูุฑุงุฑุ ูุนุชูุฏ ุงูุชูุฒูุน ุงูุชุงูู:

### ุชูุฒูุน ุงูุจูุงูุงุช ุจูู ุงููุธุงููู:

| ููุน ุงูุจูุงูุงุช | ููุงู ุงูุชุฎุฒูู | ุงูุณุจุจ |
|-------------|--------------|-------|
| **ุงููุฑุงุกุงุช ุงูููุฑุจุงุฆูุฉ ุงูุชุงุฑูุฎูุฉ** | Acrel TSDB | ูุญุณูููุฉ ููุจูุงูุงุช ุงูุฒูููุฉ |
| **ุจูุงูุงุช ุฌูุฏุฉ ุงูุทุงูุฉ** | Acrel TSDB | ุจูุงูุงุช ูููุฉ ุนุงููุฉ ุงูุชุฑุฏุฏ |
| **ุณุฌู ุงูุฅูุฐุงุฑุงุช ุงููููุฉ** | Acrel TSDB | ูุฑุชุจุทุฉ ุจุงูุนุฏุงุฏุงุช |
| **ุจูุงูุงุช ุงูุนููุงุก (CRM)** | ูุธุงููุง | ุจูุงูุงุช ุฃุนูุงู |
| **ุงูููุงุชูุฑ ูุงููุฏููุนุงุช** | ูุธุงููุง | ุจูุงูุงุช ูุงููุฉ |
| **ุงููููุฏ ุงููุญุงุณุจูุฉ** | ูุธุงููุง | ุจูุงูุงุช ูุงููุฉ |
| **ุณุฌู ุงููุตู/ุงููุตู** | ูุธุงููุง | ูุฑุชุจุท ุจุงูููุงุชูุฑ |
| **ุฃูุงูุฑ ุงูุนูู** | ูุธุงููุง | ุจูุงูุงุช ุชุดุบูููุฉ |

### ุขููุฉ ุฌูุจ ุงูุจูุงูุงุช ุนูุฏ ุงูุทูุจ:

```python
# ูุซุงู: ุนุฑุถ ุฑุณู ุจูุงูู ูุงุณุชููุงู ุนููู
class ConsumptionService:
    def get_customer_consumption_chart(self, customer_id, period):
        # 1. ุฌูุจ meter_id ูู ูุงุนุฏุฉ ุจูุงูุงุชูุง
        customer = CustomerRepository.get(customer_id)
        meter_id = customer.meter_id
        
        # 2. ุฌูุจ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ูู Acrel API
        consumption_data = AcrelAPI.get_meter_history(
            meter_id=meter_id,
            start_date=period.start,
            end_date=period.end
        )
        
        # 3. ุฅุฑุฌุงุน ุงูุจูุงูุงุช ููุนุฑุถ
        return consumption_data
```

---

## ๐ ุงุณุชุฎุฏุงู ุชูุงุฑูุฑ Acrel ุงูุฌุงูุฒุฉ

> ููุตุฉ Acrel IoT-EMS ุชููุฑ ุชูุงุฑูุฑ ุฌุงูุฒุฉ ูููู ุงุณุชุฎุฏุงููุง ูุจุงุดุฑุฉ ุฃู ุชุถููููุง ูู ูุธุงููุง.

### ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ ูู Acrel:

| ุงูุชูุฑูุฑ | ุงููุตู | ุงูุงุณุชุฎุฏุงู |
|---------|-------|----------|
| **ุชูุฑูุฑ ุงูุงุณุชููุงู ุงููููู/ุงูุดูุฑู** | ุงุณุชููุงู ูู ุนุฏุงุฏ | ุงูููุชุฑุฉ |
| **ุชูุฑูุฑ ุฐุฑูุฉ ุงูุทูุจ** | ุฃููุงุช ุงูุฐุฑูุฉ ูููููุง | ุชุฎุทูุท ุงูุฃุญูุงู |
| **ุชูุฑูุฑ ุฌูุฏุฉ ุงูุทุงูุฉ** | THD, PF, Unbalance | ุงูุตูุงูุฉ ุงูููุงุฆูุฉ |
| **ุชูุฑูุฑ ุงูุฅูุฐุงุฑุงุช** | ุณุฌู ุงูุฅูุฐุงุฑุงุช ูุฃููุงุชูุง | ุชุญููู ุงูุฃุนุทุงู |
| **ุชูุฑูุฑ ููุงุกุฉ ุงูุดุจูุฉ** | ุงูููุฏ ุงูููู | ุชุญุณูู ุงูุดุจูุฉ |

### API ูุฌูุจ ุชูุงุฑูุฑ Acrel:

```
GET    /api/v1/acrel/reports/consumption        - ุชูุฑูุฑ ุงูุงุณุชููุงู
GET    /api/v1/acrel/reports/peak-demand        - ุชูุฑูุฑ ุงูุฐุฑูุฉ
GET    /api/v1/acrel/reports/power-quality      - ุชูุฑูุฑ ุฌูุฏุฉ ุงูุทุงูุฉ
GET    /api/v1/acrel/reports/alarms             - ุชูุฑูุฑ ุงูุฅูุฐุงุฑุงุช
GET    /api/v1/acrel/reports/efficiency         - ุชูุฑูุฑ ุงูููุงุกุฉ
```

---
1. **ุงููุฑุงูุจุฉ ุงููุนููุฉ (SCADA)** - ูุงุฌูุฉ ูุฑุงูุจุฉ ูุชุญูู
2. **ูุฑุงูุจุฉ ุงูุทุงูุฉ ูุงูุงุณุชููุงู** - ุชุญููู ุงูุฅูุชุงุฌ ูุงูุงุณุชููุงู
3. **ูุฑุงูุจุฉ ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ** - ุงููุญูุตุงุช ูุงูุงูุชุซุงู
4. **ูุฑุงูุจุฉ ุงูุฃูุงู ูุงูุญูุงูุฉ** - ุงูุชุญูู ูู ุงููุตูู ูุงููุงููุฑุงุช
5. **ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ** - STSุ IoTุ Acrel

---

## ๐ ุงูุนูุงูุฉ ูุน ุงููููุงุช ุงููุฑุฌุนูุฉ

| ุงูููู | ุงูุนูุงูุฉ |
|-------|---------|
| **03_ูุธุงู_ุงูุฃุตูู** | ูุฑุงุกุงุช ุงููููุฏุงุชุ ุงูุฃููุงุญ ุงูุดูุณูุฉุ ุงูุนุฏุงุฏุงุช |
| **02_ูุธุงู_ุงููุทูุฑ** | APIs ููุชูุงูู ูุน IoT ูSTS ูAcrel |
| **01_ุงููุธุงู_ุงูุฃู** | ุงููุญุทุงุชุ ุงููุณุชุฎุฏูููุ ุงูุตูุงุญูุงุช |
| **04_ูุธุงู_ุงูุนูููุงุช_ุงูููุฏุงููุฉ** | ุฅูุดุงุก ููุงู ุตูุงูุฉ ุนูุฏ ุงูุชุดุงู ุฃุนุทุงู |
| **05_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ** | ุฑุจุท ุงูุชูุจููุงุช ุจุฃูุงูุฑ ุงูุนูู |

---

## ๐๏ธ ูููู ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู

```
ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู
โ
โโโ 1๏ธโฃ ุงููุฑุงูุจุฉ ุงููุนููุฉ (SCADA)
โ   โโโ ูุงุฌูุฉ SCADA
โ   โโโ ุฌูุน ุงูุจูุงูุงุช ุงูุญูุฉ
โ   โโโ ุงูุชูุจููุงุช ูุงูุฅูุฐุงุฑุงุช
โ   โโโ ุงูุชุญูู ุงูุขูู
โ
โโโ 2๏ธโฃ ูุฑุงูุจุฉ ุงูุทุงูุฉ ูุงูุงุณุชููุงู
โ   โโโ ุฌูุน ุจูุงูุงุช ุงูุทุงูุฉ
โ   โโโ ุชุญููู ุงูุงุณุชููุงู
โ   โโโ ุงูุชูุจููุงุช
โ   โโโ ุงูุชูุงุฑูุฑ
โ
โโโ 3๏ธโฃ ูุฑุงูุจุฉ ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ
โ   โโโ ุงููุญูุตุงุช ูุงูุงุฎุชุจุงุฑุงุช
โ   โโโ ุฅุฏุงุฑุฉ ุงููุดุงูู
โ   โโโ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ
โ   โโโ ุงูุชูุงุฑูุฑ ูุงูุงูุชุซุงู
โ
โโโ 4๏ธโฃ ูุฑุงูุจุฉ ุงูุฃูุงู ูุงูุญูุงูุฉ
โ   โโโ ุงูุชุญูู ูู ุงููุตูู
โ   โโโ ุงููุฑุงูุจุฉ ุจุงููุงููุฑุงุช
โ   โโโ ุงูุฅูุฐุงุฑุงุช
โ   โโโ ุงูุณุฌูุงุช ูุงูุชูุงุฑูุฑ
โ
โโโ 5๏ธโฃ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ
    โโโ ุชูุงูู STS (ุนุฏุงุฏุงุช ุงูุฏูุน ุงููุณุจู)
    โโโ ุชูุงูู IoT (ุฃุฌูุฒุฉ ุงูุงุณุชุดุนุงุฑ)
    โโโ ุชูุงูู Acrel (ุฃุฌูุฒุฉ ุงูููุงุณ)
    โโโ ุงููุฒุงููุฉ ูุงูุชุญุฏูุซ
```

---

# 1๏ธโฃ ุงููุฑุงูุจุฉ ุงููุนููุฉ - SCADA (ุงููููุฉ 24)

## ๐ฏ ุงูุบุฑุถ

ุชูููุฑ ูุงุฌูุฉ ูุฑุงูุจุฉ ูุชุญูู ูุนููุฉ (Supervisory Control and Data Acquisition) ูุฌููุน ููููุงุช ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉ.

## ๐ ููููุงุช SCADA

### 1. ูุงุฌูุฉ SCADA ุงูุฑุฆูุณูุฉ

**ุงูุนูุงุตุฑ:**
- ุฎุฑูุทุฉ ุงูุดุจูุฉ ุงูุชูุงุนููุฉ
- ุญุงูุฉ ุงููุญุทุงุช ูุงููููุฏุงุช
- ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ (KPIs)
- ุงูุชูุจููุงุช ุงููุดุทุฉ
- ุงูุฑุณูู ุงูุจูุงููุฉ ุงูุญูุฉ

### 2. ููุญุงุช ุงููุฑุงูุจุฉ (Dashboards)

| ุงูููุญุฉ | ุงููุญุชูู |
|--------|---------|
| **ููุญุฉ ุงููุญุทุงุช** | ุญุงูุฉ ูู ูุญุทุฉุ ุงูุฅูุชุงุฌุ ุงูุงุณุชููุงู |
| **ููุญุฉ ุงููููุฏุงุช** | ุณุงุนุงุช ุงูุชุดุบููุ ุงูุญุฑุงุฑุฉุ ุงููููุฏุ ุงูุญูู |
| **ููุญุฉ ุงูุทุงูุฉ ุงูุดูุณูุฉ** | ุงูุฅูุชุงุฌุ ุงูููุงุกุฉุ ุญุงูุฉ ุงูุฃููุงุญ |
| **ููุญุฉ ุงูุดุจูุฉ** | ุญุงูุฉ ุงูููุงุจูุ ุงูุฃุญูุงูุ ุงูููุฏ |
| **ููุญุฉ ุงูุนุฏุงุฏุงุช** | ุงููุฑุงุกุงุชุ ุงูุงุณุชููุงูุ ุงูููุชุฑุฉ |

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ููุงุท ุงููุฑุงูุจุฉ: `monitoring_points`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| point_code | VARCHAR(50) | ููุฏ ุงูููุทุฉ |
| name | VARCHAR(255) | ุงุณู ุงูููุทุฉ |
| point_type | ENUM | ุงูููุน (analog, digital, calculated) |
| data_type | ENUM | ููุน ุงูุจูุงูุงุช (voltage, current, power, temperature, frequency, status) |
| unit | VARCHAR(20) | ุงููุญุฏุฉ |
| source_type | VARCHAR(50) | ูุตุฏุฑ ุงูุจูุงูุงุช (generator, solar_panel, meter, sensor) |
| source_id | UUID | ูุนุฑู ุงููุตุฏุฑ |
| min_value | DECIMAL | ุงูุญุฏ ุงูุฃุฏูู |
| max_value | DECIMAL | ุงูุญุฏ ุงูุฃูุตู |
| warning_low | DECIMAL | ุชุญุฐูุฑ ููุฎูุถ |
| warning_high | DECIMAL | ุชุญุฐูุฑ ูุฑุชูุน |
| alarm_low | DECIMAL | ุฅูุฐุงุฑ ููุฎูุถ |
| alarm_high | DECIMAL | ุฅูุฐุงุฑ ูุฑุชูุน |
| scan_interval | INT | ูุชุฑุฉ ุงููุฑุงุกุฉ (ุซูุงูู) |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุงููุฑุงุกุงุช ุงูุญูุฉ: `live_readings`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| point_id | UUID | ููุทุฉ ุงููุฑุงูุจุฉ |
| reading_time | TIMESTAMP | ููุช ุงููุฑุงุกุฉ |
| value | DECIMAL | ุงููููุฉ |
| quality | ENUM | ุฌูุฏุฉ ุงููุฑุงุกุฉ (good, bad, uncertain) |
| status | ENUM | ุงูุญุงูุฉ (normal, warning, alarm) |

### ุฌุฏูู ุณุฌู ุงููุฑุงุกุงุช: `readings_history`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| point_id | UUID | ููุทุฉ ุงููุฑุงูุจุฉ |
| reading_time | TIMESTAMP | ููุช ุงููุฑุงุกุฉ |
| value | DECIMAL | ุงููููุฉ |
| quality | ENUM | ุฌูุฏุฉ ุงููุฑุงุกุฉ |
| aggregation_type | ENUM | ููุน ุงูุชุฌููุน (raw, hourly, daily, monthly) |

### ุฌุฏูู ุงูุชูุจููุงุช: `alerts`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| point_id | UUID | ููุทุฉ ุงููุฑุงูุจุฉ (ุงุฎุชูุงุฑู) |
| alert_code | VARCHAR(50) | ููุฏ ุงูุชูุจูู |
| alert_type | ENUM | ุงูููุน (warning, alarm, critical) |
| severity | ENUM | ุงูุฎุทูุฑุฉ (low, medium, high, critical) |
| title | VARCHAR(255) | ุงูุนููุงู |
| message | TEXT | ุงูุฑุณุงูุฉ |
| source_type | VARCHAR(50) | ูุตุฏุฑ ุงูุชูุจูู |
| source_id | UUID | ูุนุฑู ุงููุตุฏุฑ |
| value | DECIMAL | ุงููููุฉ ุงููุณุจุจุฉ |
| threshold | DECIMAL | ุงูุญุฏ ุงููุชุฌุงูุฒ |
| status | ENUM | ุงูุญุงูุฉ (active, acknowledged, resolved, escalated) |
| triggered_at | TIMESTAMP | ููุช ุงูุชูุนูู |
| acknowledged_by | UUID | ูู ุฃูุฑ ุจุงูุชูุจูู |
| acknowledged_at | TIMESTAMP | ููุช ุงูุฅูุฑุงุฑ |
| resolved_by | UUID | ูู ุญู ุงููุดููุฉ |
| resolved_at | TIMESTAMP | ููุช ุงูุญู |
| resolution_notes | TEXT | ููุงุญุธุงุช ุงูุญู |
| work_order_id | UUID | ุฃูุฑ ุงูุนูู ุงููุฑุชุจุท |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ููุงุนุฏ ุงูุชูุจููุงุช: `alert_rules`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| name | VARCHAR(255) | ุงุณู ุงููุงุนุฏุฉ |
| description | TEXT | ุงููุตู |
| rule_type | ENUM | ููุน ุงููุงุนุฏุฉ (threshold, rate_of_change, pattern, custom) |
| condition | JSON | ุดุฑูุท ุงูุชูุนูู |
| alert_type | ENUM | ููุน ุงูุชูุจูู |
| severity | ENUM | ุงูุฎุทูุฑุฉ |
| message_template | TEXT | ูุงูุจ ุงูุฑุณุงูุฉ |
| notification_channels | JSON | ูููุงุช ุงูุฅุดุนุงุฑ (sms, email, push, telegram) |
| escalation_rules | JSON | ููุงุนุฏ ุงูุชุตุนูุฏ |
| auto_create_work_order | BOOLEAN | ุฅูุดุงุก ุฃูุฑ ุนูู ุชููุงุฆู |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุฃูุงูุฑ ุงูุชุญูู: `control_commands`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| target_type | VARCHAR(50) | ููุน ุงููุฏู (generator, switch, breaker) |
| target_id | UUID | ูุนุฑู ุงููุฏู |
| command_type | ENUM | ููุน ุงูุฃูุฑ (start, stop, open, close, set_value) |
| command_value | VARCHAR(255) | ูููุฉ ุงูุฃูุฑ |
| status | ENUM | ุงูุญุงูุฉ (pending, sent, executed, failed, cancelled) |
| issued_by | UUID | ูู ุฃุตุฏุฑ ุงูุฃูุฑ |
| issued_at | TIMESTAMP | ููุช ุงูุฅุตุฏุงุฑ |
| executed_at | TIMESTAMP | ููุช ุงูุชูููุฐ |
| result | TEXT | ุงููุชูุฌุฉ |
| notes | TEXT | ููุงุญุธุงุช |

---

# 2๏ธโฃ ูุฑุงูุจุฉ ุงูุทุงูุฉ ูุงูุงุณุชููุงู (ุงููููุฉ 25)

## ๐ฏ ุงูุบุฑุถ

ูุฑุงูุจุฉ ูุชุญููู ุฅูุชุงุฌ ูุงุณุชููุงู ุงูุทุงูุฉ ุงูููุฑุจุงุฆูุฉ ูู ุงูุดุจูุฉ.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ููุฎุต ุงูุทุงูุฉ: `energy_summary`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| summary_date | DATE | ุงูุชุงุฑูุฎ |
| summary_type | ENUM | ุงูููุน (hourly, daily, monthly, yearly) |
| total_generation | DECIMAL | ุฅุฌูุงูู ุงูุชูููุฏ (kWh) |
| diesel_generation | DECIMAL | ุชูููุฏ ุงูุฏูุฒู |
| solar_generation | DECIMAL | ุชูููุฏ ุงูุดูุณู |
| total_consumption | DECIMAL | ุฅุฌูุงูู ุงูุงุณุชููุงู |
| grid_losses | DECIMAL | ููุฏ ุงูุดุจูุฉ |
| loss_percentage | DECIMAL | ูุณุจุฉ ุงูููุฏ |
| peak_demand | DECIMAL | ุฐุฑูุฉ ุงูุทูุจ (kW) |
| peak_time | TIME | ููุช ุงูุฐุฑูุฉ |
| min_demand | DECIMAL | ุฃุฏูู ุทูุจ |
| average_demand | DECIMAL | ูุชูุณุท ุงูุทูุจ |
| power_factor | DECIMAL | ูุนุงูู ุงููุฏุฑุฉ |
| fuel_consumed | DECIMAL | ุงููููุฏ ุงููุณุชููู (ูุชุฑ) |
| fuel_efficiency | DECIMAL | ููุงุกุฉ ุงููููุฏ (kWh/ูุชุฑ) |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุชุญููู ุงูุงุณุชููุงู: `consumption_analysis`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| analysis_date | DATE | ุงูุชุงุฑูุฎ |
| analysis_type | ENUM | ุงูููุน (by_station, by_cable, by_customer_type, by_tariff) |
| group_key | VARCHAR(255) | ููุชุงุญ ุงูุชุฌููุน |
| group_name | VARCHAR(255) | ุงุณู ุงููุฌููุนุฉ |
| consumption | DECIMAL | ุงูุงุณุชููุงู |
| percentage | DECIMAL | ุงููุณุจุฉ |
| customer_count | INT | ุนุฏุฏ ุงููุดุชุฑููู |
| average_per_customer | DECIMAL | ุงููุชูุณุท ููู ูุดุชุฑู |
| comparison_previous | DECIMAL | ููุงุฑูุฉ ุจุงููุชุฑุฉ ุงูุณุงุจูุฉ |
| growth_rate | DECIMAL | ูุนุฏู ุงูููู |

### ุฌุฏูู ุชููุนุงุช ุงูุทูุจ: `demand_forecast`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| forecast_date | DATE | ุชุงุฑูุฎ ุงูุชููุน |
| forecast_hour | INT | ุงูุณุงุนุฉ |
| predicted_demand | DECIMAL | ุงูุทูุจ ุงููุชููุน |
| confidence_level | DECIMAL | ูุณุชูู ุงูุซูุฉ |
| model_used | VARCHAR(100) | ุงููููุฐุฌ ุงููุณุชุฎุฏู |
| actual_demand | DECIMAL | ุงูุทูุจ ุงููุนูู (ุจุนุฏ ุงูุญุฏุซ) |
| accuracy | DECIMAL | ุงูุฏูุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 3๏ธโฃ ูุฑุงูุจุฉ ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ (ุงููููุฉ 26)

## ๐ฏ ุงูุบุฑุถ

ุถูุงู ุฌูุฏุฉ ุงูุฎุฏูุฉ ุงูููุฑุจุงุฆูุฉ ูุงูุงูุชุซุงู ููุนุงููุฑ ุงูุณูุงูุฉ.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ูุคุดุฑุงุช ุงูุฌูุฏุฉ: `quality_metrics`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| metric_date | DATE | ุงูุชุงุฑูุฎ |
| metric_type | ENUM | ุงูููุน (voltage_quality, frequency_stability, power_factor, harmonics) |
| average_value | DECIMAL | ุงููุชูุณุท |
| min_value | DECIMAL | ุงูุฃุฏูู |
| max_value | DECIMAL | ุงูุฃุนูู |
| violations_count | INT | ุนุฏุฏ ุงูุชุฌุงูุฒุงุช |
| compliance_rate | DECIMAL | ูุณุจุฉ ุงูุงูุชุซุงู |
| standard_reference | VARCHAR(100) | ุงููุนูุงุฑ ุงููุฑุฌุนู |

### ุฌุฏูู ูุคุดุฑุงุช ุงูููุซูููุฉ: `reliability_metrics`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| period_start | DATE | ุจุฏุงูุฉ ุงููุชุฑุฉ |
| period_end | DATE | ููุงูุฉ ุงููุชุฑุฉ |
| saifi | DECIMAL | ูุนุฏู ุชูุฑุงุฑ ุงูุงููุทุงุน (SAIFI) |
| saidi | DECIMAL | ูุนุฏู ูุฏุฉ ุงูุงููุทุงุน (SAIDI) |
| caidi | DECIMAL | ูุชูุณุท ูุฏุฉ ุงูุงููุทุงุน (CAIDI) |
| asai | DECIMAL | ูุคุดุฑ ุชููุฑ ุงูุฎุฏูุฉ (ASAI) |
| total_outages | INT | ุฅุฌูุงูู ุงูุงููุทุงุนุงุช |
| planned_outages | INT | ุงูุงููุทุงุนุงุช ุงููุฎุทุทุฉ |
| unplanned_outages | INT | ุงูุงููุทุงุนุงุช ุบูุฑ ุงููุฎุทุทุฉ |
| total_duration_minutes | INT | ุฅุฌูุงูู ูุฏุฉ ุงูุงููุทุงุน (ุฏูุงุฆู) |
| customers_affected | INT | ุงููุดุชุฑููู ุงููุชุฃุซุฑูู |

### ุฌุฏูู ุงูุญูุงุฏุซ: `incidents`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| incident_number | VARCHAR(20) | ุฑูู ุงูุญุงุฏุซ |
| incident_type | ENUM | ุงูููุน (outage, equipment_failure, safety, fire, theft) |
| severity | ENUM | ุงูุฎุทูุฑุฉ (minor, moderate, major, critical) |
| title | VARCHAR(255) | ุงูุนููุงู |
| description | TEXT | ุงููุตู |
| location | VARCHAR(255) | ุงููููุน |
| occurred_at | TIMESTAMP | ููุช ุงูุญุฏูุซ |
| detected_at | TIMESTAMP | ููุช ุงูุงูุชุดุงู |
| reported_by | UUID | ุงููุจูุบ |
| status | ENUM | ุงูุญุงูุฉ (open, investigating, resolved, closed) |
| root_cause | TEXT | ุงูุณุจุจ ุงูุฌุฐุฑู |
| corrective_actions | TEXT | ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ |
| preventive_actions | TEXT | ุงูุฅุฌุฑุงุกุงุช ุงูููุงุฆูุฉ |
| resolved_at | TIMESTAMP | ููุช ุงูุญู |
| closed_at | TIMESTAMP | ููุช ุงูุฅุบูุงู |
| attachments | JSON | ุงููุฑููุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุงููุญูุตุงุช: `safety_inspections`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| inspection_number | VARCHAR(20) | ุฑูู ุงููุญุต |
| inspection_type | ENUM | ุงูููุน (routine, safety, compliance, audit) |
| scheduled_date | DATE | ุงูุชุงุฑูุฎ ุงููุฌุฏูู |
| performed_date | DATE | ุชุงุฑูุฎ ุงูุชูููุฐ |
| inspector_id | UUID | ุงูููุชุด |
| checklist_id | UUID | ูุงุฆูุฉ ุงููุญุต |
| status | ENUM | ุงูุญุงูุฉ (scheduled, in_progress, completed, cancelled) |
| overall_result | ENUM | ุงููุชูุฌุฉ (pass, fail, conditional) |
| findings_count | INT | ุนุฏุฏ ุงูููุงุญุธุงุช |
| critical_findings | INT | ุงูููุงุญุธุงุช ุงูุญุฑุฌุฉ |
| report | TEXT | ุงูุชูุฑูุฑ |
| attachments | JSON | ุงููุฑููุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 4๏ธโฃ ูุฑุงูุจุฉ ุงูุฃูุงู ูุงูุญูุงูุฉ (ุงููููุฉ 27)

## ๐ฏ ุงูุบุฑุถ

ุญูุงูุฉ ุงููุญุทุงุช ูุงูุฃุตูู ูู ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู ูุงูุณุฑูุฉ.

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ููุงุท ุงููุตูู: `access_points`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| point_code | VARCHAR(50) | ููุฏ ุงูููุทุฉ |
| name | VARCHAR(255) | ุงูุงุณู |
| point_type | ENUM | ุงูููุน (gate, door, cabinet) |
| location | VARCHAR(255) | ุงููููุน |
| access_method | ENUM | ุทุฑููุฉ ุงููุตูู (card, biometric, code, key) |
| is_monitored | BOOLEAN | ูุฑุงูุจุฉ |
| camera_id | UUID | ุงููุงููุฑุง ุงููุฑุชุจุทุฉ |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุณุฌู ุงููุตูู: `access_log`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| access_point_id | UUID | ููุทุฉ ุงููุตูู |
| user_id | UUID | ุงููุณุชุฎุฏู |
| access_time | TIMESTAMP | ููุช ุงููุตูู |
| access_type | ENUM | ุงูููุน (entry, exit) |
| access_method | ENUM | ุงูุทุฑููุฉ |
| status | ENUM | ุงูุญุงูุฉ (granted, denied, forced) |
| card_number | VARCHAR(50) | ุฑูู ุงูุจุทุงูุฉ |
| notes | TEXT | ููุงุญุธุงุช |

### ุฌุฏูู ุงููุงููุฑุงุช: `cameras`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| camera_code | VARCHAR(50) | ููุฏ ุงููุงููุฑุง |
| name | VARCHAR(255) | ุงูุงุณู |
| location | VARCHAR(255) | ุงููููุน |
| camera_type | ENUM | ุงูููุน (fixed, ptz, dome) |
| ip_address | VARCHAR(50) | ุนููุงู IP |
| stream_url | VARCHAR(500) | ุฑุงุจุท ุงูุจุซ |
| recording_enabled | BOOLEAN | ุงูุชุณุฌูู ููุนู |
| motion_detection | BOOLEAN | ูุดู ุงูุญุฑูุฉ |
| status | ENUM | ุงูุญุงูุฉ (online, offline, maintenance) |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุฃุญุฏุงุซ ุงูุฃูุงู: `security_events`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| event_type | ENUM | ุงูููุน (intrusion, motion, door_forced, camera_offline, alarm) |
| severity | ENUM | ุงูุฎุทูุฑุฉ |
| source_type | VARCHAR(50) | ูุตุฏุฑ ุงูุญุฏุซ |
| source_id | UUID | ูุนุฑู ุงููุตุฏุฑ |
| description | TEXT | ุงููุตู |
| occurred_at | TIMESTAMP | ููุช ุงูุญุฏูุซ |
| status | ENUM | ุงูุญุงูุฉ (new, acknowledged, investigating, resolved, false_alarm) |
| acknowledged_by | UUID | ูู ุฃูุฑ |
| acknowledged_at | TIMESTAMP | ููุช ุงูุฅูุฑุงุฑ |
| resolved_by | UUID | ูู ุญู |
| resolved_at | TIMESTAMP | ููุช ุงูุญู |
| resolution_notes | TEXT | ููุงุญุธุงุช ุงูุญู |
| video_clip | VARCHAR(500) | ุฑุงุจุท ููุทุน ุงูููุฏูู |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

# 5๏ธโฃ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ (ุงููููุฉ 28)

## ๐ฏ ุงูุบุฑุถ

ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ ูุฌูุน ุงูุจูุงูุงุช ูุงูุชุญูู.

## ๐ ุงูุฃูุธูุฉ ุงููุชูุงููุฉ

### 1. ุชูุงูู STS (ุนุฏุงุฏุงุช ุงูุฏูุน ุงููุณุจู)

| ุงูุนูููุฉ | ุงููุตู |
|---------|-------|
| ูุฑุงุกุฉ ุงูุฑุตูุฏ | ุงุณุชุนูุงู ุนู ุฑุตูุฏ ุงูุนุฏุงุฏ |
| ุดุญู ุงูุฑุตูุฏ | ุฅุถุงูุฉ ุฑุตูุฏ ููุนุฏุงุฏ |
| ูุฑุงุกุฉ ุงูุงุณุชููุงู | ุฌูุจ ุจูุงูุงุช ุงูุงุณุชููุงู |
| ุงูุชุญูู | ูุตู/ุชูุตูู ุงูุนุฏุงุฏ |
| ุงูุชูุจููุงุช | ุงุณุชูุงู ุชูุจููุงุช ุงูุนุฏุงุฏ |

### 2. ุชูุงูู IoT (ุฃุฌูุฒุฉ ุงูุงุณุชุดุนุงุฑ)

| ุงูุฌูุงุฒ | ุงูุจูุงูุงุช |
|--------|----------|
| ุญุณุงุณุงุช ุงูุญุฑุงุฑุฉ | ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงููููุฏุงุช ูุงููุญููุงุช |
| ุญุณุงุณุงุช ุงููููุฏ | ูุณุชูู ุงููููุฏ ูู ุงูุฎุฒุงูุงุช |
| ุญุณุงุณุงุช ุงูุฌูุฏ | ูุฑุงุกุงุช ุงูุฌูุฏ ุงูููุฑุจุงุฆู |
| ุญุณุงุณุงุช ุงูุชูุงุฑ | ูุฑุงุกุงุช ุงูุชูุงุฑ ุงูููุฑุจุงุฆู |
| ุญุณุงุณุงุช ุงูุทุงูุฉ | ูุฑุงุกุงุช ุงูุทุงูุฉ ูุงููุฏุฑุฉ |

### 3. ุชูุงูู Acrel IoT-EMS (ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ)

#### ุฃููุงุน ุงูุนุฏุงุฏุงุช:

| ุงูููุน | ุงูููุฏูู | ุงูุงุณุชุฎุฏุงู | ุงูุจูุงูุงุช |
|------|--------|----------|----------|
| ุนุฏุงุฏุงุช ุงููุดุชุฑููู | ADL200-WF | ููุงุณ ุงุณุชููุงู ุงููุดุชุฑููู | ุงููุฑุงุกุฉุ ุงูุงุณุชููุงูุ ุงูุญุงูุฉ |
| ุนุฏุงุฏุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ | ADW300-WF | ูุฑุงูุจุฉ ุงูุดุจูุฉ | ุงูุฌูุฏุ ุงูุชูุงุฑุ ุงูุทุงูุฉุ ุงูุชุฑุฏุฏ |

#### ุงููุธุงุฆู ุงูุจุฑูุฌูุฉ:

| ุงููุธููุฉ | ุงููุตู | ุงููุนุงููุงุช |
|---------|-------|----------|
| `getMeterReadings(meter_id)` | ุฌูุจ ุงููุฑุงุกุฉ ุงูุญุงููุฉ ูุงูุงุณุชููุงู | meter_id: UUID |
| `getInfrastructureMetrics(meter_id)` | ุฌูุจ ุจูุงูุงุช ุงูุชุดุบูู (ุฌูุฏุ ุชูุงุฑุ ุทุงูุฉ) | meter_id: UUID |
| `disconnectMeter(meter_id)` | ูุตู ุงูุฎุฏูุฉ ุนู ุจุนุฏ | meter_id: UUID |
| `reconnectMeter(meter_id)` | ุฅุนุงุฏุฉ ุชูุตูู ุงูุฎุฏูุฉ | meter_id: UUID |
| `setTariff(meter_id, new_tariff)` | ุชุบููุฑ ุงูุชุนุฑูุฉ ุนู ุจุนุฏ | meter_id, tariff_id |
| `setMonthlyQuota(meter_id, quota_kwh)` | ุชุญุฏูุฏ ุญุตุฉ ุงูุงุณุชููุงู ุงูุดูุฑูุฉ | meter_id, quota_kwh |
| `getMonthlyConsumption(meter_id, year, month)` | ุฌูุจ ุงูุงุณุชููุงู ุงูุดูุฑู | meter_id, year, month |
| `addCredit(meter_id, kwh)` | ุฅุถุงูุฉ ุฑุตูุฏ ุฅุถุงูู ููุนุฏุงุฏ | meter_id, kwh |
| `getMeterBalance(meter_id)` | ุฌูุจ ุฑุตูุฏ ุงูุนุฏุงุฏ ุงูุญุงูู | meter_id: UUID |

#### ููุทู ุงููุตู/ุงููุตู ุงูุชููุงุฆู:

```
// === ููุทู ุงููุตู ุงูุชููุงุฆู ===
Scheduled Job: auto_disconnect_overdue (daily at 08:00)

FOR EACH invoice IN overdue_invoices:
    IF (invoice.due_date + grace_period_days < TODAY)
    AND (invoice.status = 'unpaid')
    AND (customer.meter_type = 'smart_iot')
    AND (customer.auto_disconnect_enabled = true)
    THEN:
        1. ุงุณุชุฏุนุงุก disconnectMeter(customer.meter_id)
        2. ุชุญุฏูุซ customer.service_status = 'disconnected'
        3. ุชุณุฌูู ูู disconnect_log
        4. ุฅุฑุณุงู SMS/WhatsApp ููุนููู
        5. ุฅูุดุงุก ููุฏ ูุญุงุณุจู (ุฅู ูุฒู)

// === ููุทู ุงููุตู ุงูุชููุงุฆู ===
Trigger: ON payment_received

IF (payment.customer.service_status = 'disconnected')
AND (payment.covers_overdue_amount = true)
THEN:
    1. ุงุณุชุฏุนุงุก reconnectMeter(customer.meter_id)
    2. ุชุญุฏูุซ customer.service_status = 'active'
    3. ุชุณุฌูู ูู reconnect_log
    4. ุฅุฑุณุงู SMS/WhatsApp "ุชู ุฅุนุงุฏุฉ ุงูุฎุฏูุฉ"
    5. ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ ุฅูู 'paid'
```

#### ุฌุฏูู ุณุฌู ุงููุตู/ุงููุตู: `meter_control_log`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| customer_id | UUID | ุงูุนููู |
| meter_id | UUID | ุงูุนุฏุงุฏ |
| action_type | ENUM | ุงูููุน (disconnect, reconnect, tariff_change) |
| trigger_type | ENUM | ุงููุณุจุจ (auto_overdue, manual, payment_received) |
| invoice_id | UUID | ุงููุงุชูุฑุฉ ุงููุฑุชุจุทุฉ |
| payment_id | UUID | ุงูุฏูุนุฉ ุงููุฑุชุจุทุฉ |
| status | ENUM | ุงูุญุงูุฉ (pending, success, failed) |
| acrel_response | JSON | ุงุณุชุฌุงุจุฉ Acrel |
| executed_at | TIMESTAMP | ููุช ุงูุชูููุฐ |
| executed_by | UUID | ุงููููุฐ (NULL ููุชููุงุฆู) |
| notes | TEXT | ููุงุญุธุงุช |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

#### ุฅุนุฏุงุฏุงุช ุงููุตู ุงูุชููุงุฆู:

| ุงูุฅุนุฏุงุฏ | ุงููุตู | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ |
|---------|-------|------------------|
| grace_period_days | ูุชุฑุฉ ุงูุณูุงุญ ุจุนุฏ ุงูุงุณุชุญูุงู | 7 ุฃูุงู |
| auto_disconnect_enabled | ุชูุนูู ุงููุตู ุงูุชููุงุฆู | true |
| auto_reconnect_enabled | ุชูุนูู ุงููุตู ุงูุชููุงุฆู | true |
| disconnect_time | ููุช ุชูููุฐ ุงููุตู | 08:00 |
| notify_before_disconnect | ุฅุดุนุงุฑ ูุจู ุงููุตู | 24 ุณุงุนุฉ |

## ๐ ุงูุฌุฏุงูู

### ุฌุฏูู ุงูุฃุฌูุฒุฉ ุงููุชูุงููุฉ: `integrated_devices`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| station_id | UUID | ุงููุญุทุฉ |
| device_code | VARCHAR(50) | ููุฏ ุงูุฌูุงุฒ |
| name | VARCHAR(255) | ุงูุงุณู |
| device_type | ENUM | ุงูููุน (sts_meter, iot_sensor, acrel_meter) |
| manufacturer | VARCHAR(255) | ุงูุดุฑูุฉ ุงููุตูุนุฉ |
| model | VARCHAR(255) | ุงูููุฏูู |
| serial_number | VARCHAR(100) | ุงูุฑูู ุงูุชุณูุณูู |
| ip_address | VARCHAR(50) | ุนููุงู IP |
| port | INT | ุงููููุฐ |
| protocol | ENUM | ุงูุจุฑูุชูููู (modbus, mqtt, http, proprietary) |
| connection_params | JSON | ูุนุงููุงุช ุงูุงุชุตุงู |
| polling_interval | INT | ูุชุฑุฉ ุงูุงุณุชุนูุงู (ุซูุงูู) |
| last_communication | TIMESTAMP | ุขุฎุฑ ุงุชุตุงู |
| status | ENUM | ุงูุญุงูุฉ (online, offline, error) |
| is_active | BOOLEAN | ูุดุท |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

### ุฌุฏูู ุณุฌู ุงูุงุชุตุงูุงุช: `device_communication_log`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| device_id | UUID | ุงูุฌูุงุฒ |
| communication_time | TIMESTAMP | ููุช ุงูุงุชุตุงู |
| direction | ENUM | ุงูุงุชุฌุงู (inbound, outbound) |
| message_type | VARCHAR(100) | ููุน ุงูุฑุณุงูุฉ |
| request | TEXT | ุงูุทูุจ |
| response | TEXT | ุงูุงุณุชุฌุงุจุฉ |
| status | ENUM | ุงูุญุงูุฉ (success, failed, timeout) |
| error_message | TEXT | ุฑุณุงูุฉ ุงูุฎุทุฃ |
| duration_ms | INT | ุงููุฏุฉ (ูููู ุซุงููุฉ) |

### ุฌุฏูู ููุงู ุงููุฒุงููุฉ: `sync_tasks`

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|-------|-------|
| id | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| business_id | UUID | ุงููุฌููุนุฉ |
| task_name | VARCHAR(255) | ุงุณู ุงููููุฉ |
| task_type | ENUM | ุงูููุน (data_collection, command_execution, sync) |
| source_system | VARCHAR(100) | ุงููุธุงู ุงููุตุฏุฑ |
| target_system | VARCHAR(100) | ุงููุธุงู ุงููุฏู |
| schedule | VARCHAR(100) | ุงูุฌุฏููุฉ (cron expression) |
| last_run | TIMESTAMP | ุขุฎุฑ ุชุดุบูู |
| next_run | TIMESTAMP | ุงูุชุดุบูู ุงููุงุฏู |
| status | ENUM | ุงูุญุงูุฉ (active, paused, failed) |
| last_result | TEXT | ูุชูุฌุฉ ุขุฎุฑ ุชุดุบูู |
| error_count | INT | ุนุฏุฏ ุงูุฃุฎุทุงุก |
| is_active | BOOLEAN | ูุดุทุฉ |
| created_at | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก |

---

## ๐ฐ ุงูุฑุจุท ุงููุญุงุณุจู

### ุงูุญุณุงุจุงุช ุงููุฑุชุจุทุฉ:

| ุงูุญุณุงุจ | ุงูุฑูุฒ | ุงูุงุณุชุฎุฏุงู |
|--------|-------|-----------|
| ุฅูุฑุงุฏุงุช ุงูููุฑุจุงุก | 41XX | ูู ุจูุงูุงุช ุงูุนุฏุงุฏุงุช |
| ุชูุงููู ุงููููุฏ | 5110 | ูู ูุฑุงุกุงุช ุงูุงุณุชููุงู |
| ูุตุฑููุงุช ุงูุตูุงูุฉ | 5300 | ูู ุฃูุงูุฑ ุงูุนูู ุงูููุดุฃุฉ |
| ุฎุณุงุฆุฑ ุงูุดุจูุฉ | 5XXX | ูู ุชุญููู ุงูููุฏ |

---

## ๐ฑ ุงูุดุงุดุงุช ูุงููุงุฌูุงุช

### 1. ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ (SCADA):
- ุฎุฑูุทุฉ ุงูุดุจูุฉ ุงูุชูุงุนููุฉ
- ุญุงูุฉ ุงููุญุทุงุช ูุงููููุฏุงุช
- ุงูุชูุจููุงุช ุงููุดุทุฉ
- ูุคุดุฑุงุช ุงูุฃุฏุงุก

### 2. ูุฑุงูุจุฉ ุงูุทุงูุฉ:
- ุฅูุชุงุฌ ูุงุณุชููุงู ุงูุทุงูุฉ
- ุชุญููู ุงูููุฏ
- ุชููุนุงุช ุงูุทูุจ
- ุชูุงุฑูุฑ ุงูููุงุกุฉ

### 3. ูุฑุงูุจุฉ ุงูุฌูุฏุฉ:
- ูุคุดุฑุงุช ุงูุฌูุฏุฉ
- ูุคุดุฑุงุช ุงูููุซูููุฉ
- ุงูุญูุงุฏุซ
- ุงููุญูุตุงุช

### 3.1 ููุญุฉ ุชุญููู ุฌูุฏุฉ ุงูุทุงูุฉ (Power Quality Dashboard):

> **ุงูุบุฑุถ:** ููุญุฉ ูููุฉ ูููููุฏุณูู ููุฑุงูุจุฉ ุตุญุฉ ุงูุดุจูุฉ ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุนุฏุงุฏุงุช ADW300-WF

**ุงูููููุงุช:**

| ุงููููู | ุงููุตู | ุงููุตุฏุฑ |
|---------|-------|--------|
| **ุฑุณู ุจูุงูู ุงูุชูุงูููุงุช (Harmonics)** | THD% ููุฌูุฏ ูุงูุชูุงุฑ (ุญุชู ุงูุชูุงูููุฉ 31) | ADW300 |
| **ูุคุดุฑ ุนุฏู ุงุชุฒุงู ุงูุฌูุฏ** | Voltage Unbalance % ููุฃุทูุงุฑ ุงูุซูุงุซุฉ | ADW300 |
| **ูุคุดุฑ ุนุฏู ุงุชุฒุงู ุงูุชูุงุฑ** | Current Unbalance % ููุฃุทูุงุฑ ุงูุซูุงุซุฉ | ADW300 |
| **ุฑุณู ุจูุงูู ุงูุฌูุฏ** | ุฌูุฏ ูู ุทูุฑ ูุน ุงูุญุฏูุฏ ุงูููุจููุฉ (ยฑ10%) | ADW300 |
| **ุฑุณู ุจูุงูู ุงูุชุฑุฏุฏ** | ุงูุชุฑุฏุฏ ุงููุนูู ููุงุฑูุฉ ุจู 50Hz | ADW300 |
| **ูุนุงูู ุงููุฏุฑุฉ (PF)** | ููู ุฎุท ุชูุฒูุน | ADW300 |
| **ุฎุฑูุทุฉ ุญุฑุงุฑูุฉ ููุฃุญูุงู** | ุชูุฒูุน ุงูุฃุญูุงู ุนูู ุงููุฎุงุฑุฌ | ADW300 |

**ุงูุชูุจููุงุช ุงูุชููุงุฆูุฉ:**

| ุงูุญุฏุซ | ุงูุญุฏ | ุงูุฅุฌุฑุงุก |
|--------|------|--------|
| THD ูุฑุชูุน | > 5% | ุชูุจูู ูููููุฏุณูู |
| ุนุฏู ุงุชุฒุงู ุงูุฌูุฏ | > 2% | ุชูุจูู + ูุญุต ุงูุฃุญูุงู |
| ุนุฏู ุงุชุฒุงู ุงูุชูุงุฑ | > 10% | ุชูุจูู + ุฅุนุงุฏุฉ ุชูุฒูุน ุงูุฃุญูุงู |
| ูุนุงูู ูุฏุฑุฉ ููุฎูุถ | < 0.85 | ุชูุจูู + ูุญุต ุงูููุซูุงุช |
| ุชุฑุฏุฏ ุบูุฑ ูุณุชูุฑ | ยฑ0.5Hz | ุชูุจูู + ูุญุต ุงููููุฏุงุช |

**API ููุญุฉ ุฌูุฏุฉ ุงูุทุงูุฉ:**
```
GET    /api/v1/power-quality/dashboard           - ููุญุฉ ุฌูุฏุฉ ุงูุทุงูุฉ
GET    /api/v1/power-quality/harmonics/:meter_id - ุชุญููู ุงูุชูุงูููุงุช
GET    /api/v1/power-quality/unbalance/:meter_id - ุชุญููู ุนุฏู ุงูุงุชุฒุงู
GET    /api/v1/power-quality/voltage/:meter_id   - ุชุญููู ุงูุฌูุฏ
GET    /api/v1/power-quality/frequency/:meter_id - ุชุญููู ุงูุชุฑุฏุฏ
GET    /api/v1/power-quality/pf/:meter_id        - ูุนุงูู ุงููุฏุฑุฉ
```

### 4. ูุฑุงูุจุฉ ุงูุฃูุงู:
- ุญุงูุฉ ุงููุงููุฑุงุช
- ุณุฌู ุงููุตูู
- ุฃุญุฏุงุซ ุงูุฃูุงู
- ุงูุชูุจููุงุช

### 5. ุฅุฏุงุฑุฉ ุงูุชูุงููุงุช:
- ุญุงูุฉ ุงูุฃุฌูุฒุฉ
- ุณุฌู ุงูุงุชุตุงูุงุช
- ููุงู ุงููุฒุงููุฉ
- ุงูุชูุงุฑูุฑ

---

## ๐ APIs

### SCADA:
```
GET    /api/v1/scada/dashboard              - ููุญุฉ ุงูุชุญูู
GET    /api/v1/scada/stations/:id/live      - ุงูุจูุงูุงุช ุงูุญูุฉ ูููุญุทุฉ
GET    /api/v1/monitoring-points            - ููุงุท ุงููุฑุงูุจุฉ
GET    /api/v1/alerts                       - ุงูุชูุจููุงุช
POST   /api/v1/alerts/:id/acknowledge       - ุฅูุฑุงุฑ ุงูุชูุจูู
POST   /api/v1/control/commands             - ุฅุฑุณุงู ุฃูุฑ ุชุญูู
```

### ุงูุทุงูุฉ:
```
GET    /api/v1/energy/summary               - ููุฎุต ุงูุทุงูุฉ
GET    /api/v1/energy/consumption           - ุชุญููู ุงูุงุณุชููุงู
GET    /api/v1/energy/forecast              - ุชููุนุงุช ุงูุทูุจ
GET    /api/v1/energy/losses                - ุชุญููู ุงูููุฏ
```

### ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ:
```
GET    /api/v1/quality/metrics              - ูุคุดุฑุงุช ุงูุฌูุฏุฉ
GET    /api/v1/reliability/metrics          - ูุคุดุฑุงุช ุงูููุซูููุฉ
GET    /api/v1/incidents                    - ุงูุญูุงุฏุซ
POST   /api/v1/incidents                    - ุชุณุฌูู ุญุงุฏุซ
GET    /api/v1/inspections                  - ุงููุญูุตุงุช
```

### ุงูุฃูุงู:
```
GET    /api/v1/security/cameras             - ุงููุงููุฑุงุช
GET    /api/v1/security/access-log          - ุณุฌู ุงููุตูู
GET    /api/v1/security/events              - ุฃุญุฏุงุซ ุงูุฃูุงู
POST   /api/v1/security/events/:id/resolve  - ุญู ุงูุญุฏุซ
```

### ุงูุชูุงููุงุช:
```
GET    /api/v1/integrations/devices         - ุงูุฃุฌูุฒุฉ ุงููุชูุงููุฉ
GET    /api/v1/integrations/devices/:id/status - ุญุงูุฉ ุงูุฌูุงุฒ
POST   /api/v1/integrations/sync            - ุชุดุบูู ูุฒุงููุฉ
GET    /api/v1/integrations/logs            - ุณุฌู ุงูุงุชุตุงูุงุช
```

### ุชูุงูู Acrel IoT-EMS:
```
# === ุนุฏุงุฏุงุช ุงููุดุชุฑููู (ADL200) ===
GET    /api/v1/acrel/meters                           - ูุงุฆูุฉ ุนุฏุงุฏุงุช Acrel
GET    /api/v1/acrel/meters/:meter_id/readings        - ูุฑุงุกุฉ ุงูุนุฏุงุฏ ุงูุญุงููุฉ ูุงูุงุณุชููุงู
GET    /api/v1/acrel/meters/:meter_id/history         - ุณุฌู ุงููุฑุงุกุงุช ุงูุชุงุฑูุฎูุฉ
POST   /api/v1/acrel/meters/:meter_id/disconnect      - ูุตู ุงูุฎุฏูุฉ ุนู ุจุนุฏ
POST   /api/v1/acrel/meters/:meter_id/reconnect       - ุฅุนุงุฏุฉ ุชูุตูู ุงูุฎุฏูุฉ
PUT    /api/v1/acrel/meters/:meter_id/tariff          - ุชุบููุฑ ุงูุชุนุฑูุฉ ุนู ุจุนุฏ
GET    /api/v1/acrel/meters/:meter_id/status          - ุญุงูุฉ ุงูุนุฏุงุฏ (ูุชุตู/ููุตูู)

# === ุนุฏุงุฏุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ (ADW300) ===
GET    /api/v1/acrel/infrastructure                   - ูุงุฆูุฉ ุนุฏุงุฏุงุช ุงููุฑุงูุจุฉ
GET    /api/v1/acrel/infrastructure/:meter_id/metrics - ุงูุจูุงูุงุช ุงูุชุดุบูููุฉ (ุฌูุฏุ ุชูุงุฑุ ุทุงูุฉุ ุชุฑุฏุฏ)
GET    /api/v1/acrel/infrastructure/:meter_id/live    - ุงูุจูุงูุงุช ุงูุญูุฉ ููุนุฏุงุฏ
GET    /api/v1/acrel/infrastructure/:meter_id/history - ุงูุณุฌู ุงูุชุงุฑูุฎู

# === ุงููุฒุงููุฉ ูุงูุฃุชูุชุฉ ===
POST   /api/v1/acrel/sync/all                         - ูุฒุงููุฉ ุฌููุน ุงูุนุฏุงุฏุงุช
POST   /api/v1/acrel/sync/meters                      - ูุฒุงููุฉ ุนุฏุงุฏุงุช ุงููุดุชุฑููู
POST   /api/v1/acrel/sync/infrastructure              - ูุฒุงููุฉ ุนุฏุงุฏุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ
GET    /api/v1/acrel/sync/status                      - ุญุงูุฉ ุขุฎุฑ ูุฒุงููุฉ

# === Webhooks (ุงุณุชูุจุงู ุงูุฃุญุฏุงุซ ูู Acrel) ===
POST   /api/v1/acrel/webhooks/meter-reading           - ุงุณุชูุจุงู ูุฑุงุกุฉ ุฌุฏูุฏุฉ
POST   /api/v1/acrel/webhooks/alert                   - ุงุณุชูุจุงู ุชูุจูู ูู ุงูุนุฏุงุฏ
POST   /api/v1/acrel/webhooks/status-change           - ุงุณุชูุจุงู ุชุบููุฑ ุญุงูุฉ ุงูุนุฏุงุฏ
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู

| ุงููููุฉ | ุงููุฏุฉ | ุงูููุงุฑุฏ |
|--------|-------|---------|
| ุงููุฑุงูุจุฉ ุงููุนููุฉ SCADA (ุงููููุฉ 24) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ูุฑุงูุจุฉ ุงูุทุงูุฉ ูุงูุงุณุชููุงู (ุงููููุฉ 25) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ูุฑุงูุจุฉ ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ (ุงููููุฉ 26) | 3.75 ุฃุณุงุจูุน | 3 ูุทูุฑูู |
| ูุฑุงูุจุฉ ุงูุฃูุงู ูุงูุญูุงูุฉ (ุงููููุฉ 27) | 2.5 ุฃุณุงุจูุน | 2 ูุทูุฑูู |
| ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ (ุงููููุฉ 28) | 2.5 ุฃุณุงุจูุน | 2 ูุทูุฑูู |
| **ุงูุฅุฌูุงูู** | **~16 ุฃุณุจูุน** | **600 ุณุงุนุฉ** |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฑุจุท ูุน ููู 03:** ูุฑุงุกุงุช ุงููููุฏุงุช ูุงูุฃููุงุญ ุงูุดูุณูุฉ ุชุฃุชู ูู ุฌุฏุงูู ููู 03
2. **ุงูุฑุจุท ูุน ููู 02:** APIs ุงูุชูุงูู ูุน IoT ูSTS ููุซูุฉ ูู ูุธุงู ุงููุทูุฑ
3. **ุฅูุดุงุก ููุงู ุชููุงุฆูุฉ:** ุนูุฏ ุงูุชุดุงู ุนุทูุ ูููุดุฃ ุฃูุฑ ุนูู ูู ูุธุงู ุงูุฃุตูู ูุงูุตูุงูุฉ
4. **ุงูุชูุจููุงุช ูุชุนุฏุฏุฉ ุงููููุงุช:** SMSุ Emailุ Pushุ Telegram
5. **ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ:** ุชูุญูุธ ููุชุญููู ูุงูุชูุจุค

---

# 8. ูุธุงู ุงูุฎุฑุงุฆุท ูุงูุชูุฃู ุงูุฑููู ููุดุจูุฉ (GIS & Digital Twin)

> **ุงูุบุฑุถ:** ุชูููุฑ ุฎุฏูุฉ ุฎุฑุงุฆุท ูุฑูุฒูุฉ ูุชูุซูู ุฑููู ุฏููู ููุดุจูุฉ ุงูููุฑุจุงุฆูุฉ (ุงูุชูุฃู ุงูุฑููู)

## 8.1 ุงูุฃูุธูุฉ ุงููุณุชููุฏุฉ ูู ุงูุฎุฑุงุฆุท

| ุงููุธุงู | ุงุณุชุฎุฏุงู ุงูุฎุฑุงุฆุท |
|--------|----------------|
| **ุงูุนููุงุก ูุงูููุชุฑุฉ (07)** | ููุงูุน ุงููุดุชุฑูููุ ุนูุงููู ุงูุชูุตูู |
| **ุงูุฃุตูู ูุงูุตูุงูุฉ (03)** | ููุงูุน ุงูุฃุตูู (ูุญุทุงุชุ ูููุฏุงุชุ ุทุจุงูููุ ููุงุจู) |
| **ุงูุนูููุงุช ุงูููุฏุงููุฉ (04)** | ุชุชุจุน ุงููููููุ ูุณุงุฑุงุช ุฃูุงูุฑ ุงูุนูู |
| **ุงููุฑุงูุจุฉ ูุงูุชุญูู (05)** | ุฎุฑูุทุฉ ุงูุดุจูุฉ ุงูููุฑุจุงุฆูุฉุ ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ |
| **ุงููุฎุฒูู ูุงููุดุชุฑูุงุช (06)** | ููุงูุน ุงููุณุชูุฏุนุงุช |

## 8.2 ุฌุฏูู ุงูููุงูุน ุงูุฌุบุฑุงููุฉ (geo_locations)

```sql
CREATE TABLE geo_locations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงูุฑุจุท ุงููุฑู (Polymorphic)
    entity_type VARCHAR(50) NOT NULL,  -- 'customer', 'asset', 'warehouse', 'technician', 'distribution_box', 'network_node'
    entity_id UUID NOT NULL,
    
    -- ุงูุฅุญุฏุงุซูุงุช
    latitude DECIMAL(10, 8) NOT NULL,
    longitude DECIMAL(11, 8) NOT NULL,
    altitude DECIMAL(8, 2),  -- ุงูุงุฑุชูุงุน (ุงุฎุชูุงุฑู)
    
    -- ุฏูุฉ ุงููููุน
    accuracy_meters DECIMAL(6, 2),
    source VARCHAR(20) DEFAULT 'manual',  -- 'manual', 'gps_app', 'imported', 'surveyed'
    
    -- ุงูุนููุงู ุงููุตู
    address_text TEXT,
    district VARCHAR(100),
    city VARCHAR(100),
    region VARCHAR(100),
    
    -- ุจูุงูุงุช ุฅุถุงููุฉ
    location_type VARCHAR(50),  -- 'primary', 'secondary', 'meter_location'
    notes TEXT,
    
    -- ุงูุชุชุจุน
    recorded_by UUID REFERENCES users(id),
    recorded_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(entity_type, entity_id, location_type)
);

CREATE INDEX idx_geo_locations_coords ON geo_locations(latitude, longitude);
CREATE INDEX idx_geo_locations_entity ON geo_locations(entity_type, entity_id);
```

---

# 9. ุงูุชูุฃู ุงูุฑููู ููุดุจูุฉ ุงูููุฑุจุงุฆูุฉ (Digital Twin)

> **ุงูุบุฑุถ:** ุฅูุดุงุก ูุณุฎุฉ ุฑูููุฉ ุฏูููุฉ ูููุตูุฉ ููุดุจูุฉ ุงูููุฑุจุงุฆูุฉ ุงููุงุฏูุฉ

## 9.1 ุงููุจุฏุฃ ุงูุฃุณุงุณู

```
ุงูุชูุฃู ุงูุฑููู = ูุณุฎุฉ ุฑูููุฉ ุญูุฉ ูู ุงูุดุจูุฉ ุงููุงุฏูุฉ

ุงูููุงุฆุฏ:
โโ ูุนุฑูุฉ ุจุงูุถุจุท ุฃูู ููุฌุฏ ูู ูุชุฑ ูู ุงูููุงุจู
โโ ุชุชุจุน ูุณุงุฑ ุงูููุฑุจุงุก ูู ุงููุญุทุฉ ุฅูู ุงููุดุชุฑู
โโ ุชุญููู ุงูุฎูุงุถ ุงูุฌูุฏ ูุงูุฃุญูุงู
โโ ุชุฎุทูุท ุงูุชูุณุนุงุช ุงููุณุชูุจููุฉ
โโ ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ ุจูุงุกู ุนูู ุจูุงูุงุช ุฏูููุฉ
โโ ูุญุงูุงุฉ ุงูุณููุงุฑูููุงุช ูุจู ุงูุชูููุฐ
```

## 9.2 ุฌุฏูู ุนูุฏ ุงูุดุจูุฉ (network_nodes)

```sql
CREATE TABLE network_nodes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- ุงูุชุนุฑูู
    node_code VARCHAR(30) UNIQUE NOT NULL,
    node_name VARCHAR(100),
    
    -- ุงูููุน
    node_type VARCHAR(30) NOT NULL,
    -- 'substation': ูุญุทุฉ
    -- 'pole': ุนููุฏ
    -- 'distribution_box': ุทุจููู ุชูุฒูุน
    -- 'transformer': ูุญูู
    -- 'junction': ููุทุฉ ุงูุชูุงุก
    -- 'attachment_point': ููุทุฉ ุชุนููู (ุฌุฏุงุฑุ ุดุฌุฑุฉ)
    -- 'meter_point': ููุทุฉ ุนุฏุงุฏ
    
    -- ุงููููุน
    latitude DECIMAL(10, 8) NOT NULL,
    longitude DECIMAL(11, 8) NOT NULL,
    altitude DECIMAL(8, 2),
    
    -- ุงูุฎุตุงุฆุต ุงูุนุงูุฉ
    owner VARCHAR(50),  -- 'company', 'government', 'private'
    installation_date DATE,
    status VARCHAR(20) DEFAULT 'active',  -- 'active', 'planned', 'decommissioned'
    
    -- ุฎุตุงุฆุต ุฎุงุตุฉ ุจุงูููุน (JSONB ูููุฑููุฉ)
    properties JSONB,
    /*
    ููุนููุฏ (pole):
    {
        "material": "wood|iron|concrete",
        "height_meters": 12,
        "owner": "company|government"
    }
    
    ููุทุจููู (distribution_box):
    {
        "box_type": "traditional|fiber|smart",
        "max_connections": 20,
        "current_connections": 15
    }
    
    ูููุญูู (transformer):
    {
        "capacity_kva": 250,
        "voltage_ratio": "11000/400",
        "cooling_type": "oil"
    }
    */
    
    -- ุงูุตูุงูุฉ
    last_inspection_date DATE,
    condition VARCHAR(20),  -- 'good', 'fair', 'poor', 'critical'
    
    -- ุงูุฑุจุท ุจุงูุฃุตูู
    asset_id UUID,  -- ุฑุจุท ุจุณุฌู ุงูุฃุตูู ุฅู ูุฌุฏ
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_network_nodes_type ON network_nodes(node_type);
CREATE INDEX idx_network_nodes_station ON network_nodes(station_id);
CREATE INDEX idx_network_nodes_coords ON network_nodes(latitude, longitude);
```

## 9.3 ุฌุฏูู ููููุงุช ุงูุนูุฏุฉ (node_components)

```sql
CREATE TABLE node_components (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    node_id UUID REFERENCES network_nodes(id) ON DELETE CASCADE,
    
    -- ุงูุชุนุฑูู
    component_code VARCHAR(30),
    component_type VARCHAR(50) NOT NULL,
    -- 'tension_clamp': ูุทุนุฉ ุดุฏ
    -- 'suspension_clamp': ูุทุนุฉ ุชุนููู
    -- 'insulator': ุนุงุฒู
    -- 'fuse': ูููุฒ
    -- 'switch': ููุชุงุญ
    -- 'arrester': ูุงูุน ุตูุงุนู
    
    -- ุงูุฎุตุงุฆุต
    manufacturer VARCHAR(100),
    model VARCHAR(100),
    serial_number VARCHAR(50),
    
    -- ุงูุญุงูุฉ
    installation_date DATE,
    condition VARCHAR(20) DEFAULT 'good',
    last_inspection_date DATE,
    
    -- ุงูุชูููุฉ
    unit_cost DECIMAL(10, 2),
    
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 9.4 ุฌุฏูู ููุงุทุน ุงูุดุจูุฉ (network_segments)

```sql
CREATE TABLE network_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- ุงูุชุนุฑูู
    segment_code VARCHAR(30) UNIQUE NOT NULL,
    
    -- ุงูุนูุฏ ุงููุชุตูุฉ
    from_node_id UUID REFERENCES network_nodes(id) NOT NULL,
    to_node_id UUID REFERENCES network_nodes(id) NOT NULL,
    
    -- ููุน ุงูููุจู
    cable_type VARCHAR(50) NOT NULL,  -- 'ABC', 'bare_conductor', 'underground', 'fiber_optic'
    cable_size_mm2 DECIMAL(6, 2),  -- ููุงุณ ุงูููุจู ุจุงููููยฒ
    cable_material VARCHAR(30),  -- 'aluminum', 'copper', 'ACSR'
    
    -- ุงูููุงุณุงุช
    length_meters DECIMAL(10, 2),  -- ูููู ุญุณุงุจู ุชููุงุฆูุงู ูู GPS
    calculated_length DECIMAL(10, 2),  -- ุงูุทูู ุงููุญุณูุจ ูู ุงูุฅุญุฏุงุซูุงุช
    
    -- ุงูุฎุตุงุฆุต ุงูููุฑุจุงุฆูุฉ
    voltage_level VARCHAR(20),  -- 'LV', 'MV', 'HV'
    max_current_amps DECIMAL(8, 2),
    resistance_per_km DECIMAL(8, 4),
    
    -- ุงูุญุงูุฉ
    installation_date DATE,
    status VARCHAR(20) DEFAULT 'active',
    condition VARCHAR(20) DEFAULT 'good',
    
    -- ุงูุชูููุฉ
    cost_per_meter DECIMAL(10, 2),
    total_cost DECIMAL(15, 2) GENERATED ALWAYS AS (length_meters * cost_per_meter) STORED,
    
    -- ุงูุฑุจุท ุจุงูุฃุตูู
    asset_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    -- ููุน ุงูุฑุจุท ุงูุฐุงุชู
    CONSTRAINT chk_different_nodes CHECK (from_node_id != to_node_id)
);

CREATE INDEX idx_network_segments_nodes ON network_segments(from_node_id, to_node_id);
CREATE INDEX idx_network_segments_station ON network_segments(station_id);

-- Trigger ูุญุณุงุจ ุงูุทูู ุชููุงุฆูุงู
CREATE OR REPLACE FUNCTION calculate_segment_length()
RETURNS TRIGGER AS $$
DECLARE
    from_lat DECIMAL(10, 8);
    from_lng DECIMAL(11, 8);
    to_lat DECIMAL(10, 8);
    to_lng DECIMAL(11, 8);
BEGIN
    SELECT latitude, longitude INTO from_lat, from_lng
    FROM network_nodes WHERE id = NEW.from_node_id;
    
    SELECT latitude, longitude INTO to_lat, to_lng
    FROM network_nodes WHERE id = NEW.to_node_id;
    
    -- ุญุณุงุจ ุงููุณุงูุฉ ุจุงููุชุฑ (ุตูุบุฉ Haversine ูุจุณุทุฉ)
    NEW.calculated_length := 111320 * SQRT(
        POWER(to_lat - from_lat, 2) + 
        POWER((to_lng - from_lng) * COS(RADIANS((from_lat + to_lat) / 2)), 2)
    );
    
    -- ุงุณุชุฎุฏุงู ุงูุทูู ุงููุญุณูุจ ุฅุฐุง ูู ููุฏุฎู ูุฏููุงู
    IF NEW.length_meters IS NULL THEN
        NEW.length_meters := NEW.calculated_length;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_calculate_segment_length
BEFORE INSERT OR UPDATE ON network_segments
FOR EACH ROW EXECUTE FUNCTION calculate_segment_length();
```

## 9.5 ุฌุฏูู ุฃุตูู ุงูุดุจูุฉ ุงููุฌูุนุฉ (network_assets)

```sql
CREATE TABLE network_assets (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID REFERENCES stations(id),
    
    -- ุงูุชุนุฑูู
    asset_code VARCHAR(30) UNIQUE NOT NULL,
    asset_name VARCHAR(200) NOT NULL,
    description TEXT,
    
    -- ุงููุทุงู ุงูุฌุบุฑุงูู
    coverage_area VARCHAR(200),  -- ูุซุงู: "ุดุจูุฉ ุชูุฒูุน ุญู ุงูุณูุงู"
    
    -- ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
    total_nodes_cost DECIMAL(15, 2) DEFAULT 0,
    total_segments_cost DECIMAL(15, 2) DEFAULT 0,
    total_components_cost DECIMAL(15, 2) DEFAULT 0,
    total_cost DECIMAL(15, 2) GENERATED ALWAYS AS (
        total_nodes_cost + total_segments_cost + total_components_cost
    ) STORED,
    
    -- ุงูุฅููุงู
    useful_life_years INTEGER DEFAULT 20,
    depreciation_method VARCHAR(20) DEFAULT 'straight_line',
    accumulated_depreciation DECIMAL(15, 2) DEFAULT 0,
    book_value DECIMAL(15, 2),
    
    -- ุงูุญุงูุฉ
    status VARCHAR(20) DEFAULT 'active',
    commissioning_date DATE,
    
    -- ุงูุฑุจุท ุงููุญุงุณุจู
    gl_asset_account VARCHAR(20),
    gl_depreciation_account VARCHAR(20),
    capitalization_entry_id UUID,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุฌุฏูู ุฑุจุท ุงูุนูุฏ ุจุฃุตู ุงูุดุจูุฉ
CREATE TABLE network_asset_nodes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    network_asset_id UUID REFERENCES network_assets(id) ON DELETE CASCADE,
    node_id UUID REFERENCES network_nodes(id),
    added_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(network_asset_id, node_id)
);

-- ุฌุฏูู ุฑุจุท ุงูููุงุทุน ุจุฃุตู ุงูุดุจูุฉ
CREATE TABLE network_asset_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    network_asset_id UUID REFERENCES network_assets(id) ON DELETE CASCADE,
    segment_id UUID REFERENCES network_segments(id),
    added_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(network_asset_id, segment_id)
);
```

## 9.6 ุดุงุดุฉ ุฃุฏุงุฉ ุฑุณู ุงูุดุจูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐บ๏ธ ุฃุฏุงุฉ ุฑุณู ูุชูุซูู ุงูุดุจูุฉ                              [ุญูุธ] [ุชุตุฏูุฑ] [ุทุจุงุนุฉ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  ุงูุฃุฏูุงุช: [๐ ููุทุฉ] [๐ ุฎุท] [โ๏ธ ุชุนุฏูู] [๐๏ธ ุญุฐู] [๐ ููุงุณ]                    โ
โ                                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                         โ   โ
โ  โ    โก ูุญุทุฉ ุงูุญุฏูุฏุฉ                                                     โ   โ
โ  โ       โ                                                                 โ   โ
โ  โ       โ (ABC 120mmยฒ)                                                   โ   โ
โ  โ       โ                                                                 โ   โ
โ  โ    โ ุนููุฏ-001                                                          โ   โ
โ  โ       โ                                                                 โ   โ
โ  โ       โ (ABC 120mmยฒ)                                                   โ   โ
โ  โ       โ                                                                 โ   โ
โ  โ    โ ุนููุฏ-002 โโโโโโโโโโโโโโ ูุญูู-001                                 โ   โ
โ  โ      / \        (ABC 70mmยฒ)    โ                                       โ   โ
โ  โ     /   \                      โ                                       โ   โ
โ  โ    /     \                  ๐ฆ ุทุจููู-001                               โ   โ
โ  โ   โ       โ                   / | \                                    โ   โ
โ  โ ุนููุฏ-003  ุนููุฏ-004          ๐ ๐ ๐                                   โ   โ
โ  โ   โ                                                                    โ   โ
โ  โ   โ (ABC 50mmยฒ)                                                       โ   โ
โ  โ   โ                                                                    โ   โ
โ  โ   โ ููุทุฉ ุชุนููู                                                        โ   โ
โ  โ                                                                         โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ ุงูุนูุตุฑ ุงููุญุฏุฏ: ุนููุฏ-002        โ  โ ุฎุตุงุฆุต ุงูููุทุน                        โ  โ
โ  โ                                 โ  โ                                     โ  โ
โ  โ ุงูููุน: ุนููุฏ                    โ  โ ูู: ุนููุฏ-001                        โ  โ
โ  โ ุงููุงุฏุฉ: ุฎุดุจ                    โ  โ ุฅูู: ุนููุฏ-002                       โ  โ
โ  โ ุงูุงุฑุชูุงุน: 12 ูุชุฑ               โ  โ ููุน ุงูููุจู: ABC                     โ  โ
โ  โ ุงููุงูู: ุงูุดุฑูุฉ                 โ  โ ุงูููุงุณ: 120 mmยฒ                     โ  โ
โ  โ ุชุงุฑูุฎ ุงูุชุฑููุจ: 2020-01-15     โ  โ ุงูุทูู: 180 ูุชุฑ                      โ  โ
โ  โ ุงูุญุงูุฉ: ุฌูุฏุฉ                   โ  โ ุงูุชูููุฉ: 90,000 ุฑูุงู               โ  โ
โ  โ                                 โ  โ                                     โ  โ
โ  โ [ุชุนุฏูู] [ุญุฐู] [ุตูุงูุฉ]         โ  โ [ุชุนุฏูู] [ุญุฐู]                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 9.7 ุดุงุดุฉ ุชุฌููุน ุฃุตู ุงูุดุจูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฆ ุฅูุดุงุก ุฃุตู ุดุจูุฉ ุฌุฏูุฏ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                 โ
โ  ุงุณู ุงูุฃุตู: [ุดุจูุฉ ุชูุฒูุน ุญู ุงูุณูุงู                              ]               โ
โ  ุงููุตู:     [ุดุจูุฉ ุงูุชูุฒูุน ูู ูุญูู-001 ุฅูู ุญู ุงูุณูุงู            ]               โ
โ                                                                                 โ
โ  ุงูุนูุงุตุฑ ุงููุฎุชุงุฑุฉ:                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ โ ุนููุฏ-001 (ุฎุดุจุ 12ู) .......................... 200,000 ุฑูุงู          โ   โ
โ  โ โ ุนููุฏ-002 (ุฎุดุจุ 12ู) .......................... 200,000 ุฑูุงู          โ   โ
โ  โ โ ุนููุฏ-003 (ุญุฏูุฏุ 15ู) ......................... 350,000 ุฑูุงู          โ   โ
โ  โ โ ูุญูู-001 (250 KVA) ........................... 400,000 ุฑูุงู          โ   โ
โ  โ โ ุทุจููู-001 (ููุจุฑุ 20 ููุทุฉ) .................... 150,000 ุฑูุงู          โ   โ
โ  โ โ ููุทุน: ูุญุทุฉ โ ุนููุฏ-001 (500ูุ 120mmยฒ) ......... 250,000 ุฑูุงู          โ   โ
โ  โ โ ููุทุน: ุนููุฏ-001 โ ุนููุฏ-002 (180ูุ 120mmยฒ) ..... 90,000 ุฑูุงู           โ   โ
โ  โ โ ููุทุน: ุนููุฏ-002 โ ูุญูู-001 (100ูุ 70mmยฒ) ...... 40,000 ุฑูุงู           โ   โ
โ  โ โ ูุทุน ุดุฏ ูุชุนููู (15 ูุทุนุฉ) ...................... 45,000 ุฑูุงู           โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                                 โ
โ  ููุฎุต ุงูุชูููุฉ:                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุชูููุฉ ุงูุนูุฏ (ุฃุนูุฏุฉุ ูุญููุงุชุ ุทุจุงุจููู): .......... 1,300,000 ุฑูุงู        โ   โ
โ  โ ุชูููุฉ ุงูููุงุทุน (ููุงุจู): ......................... 380,000 ุฑูุงู          โ   โ
โ  โ ุชูููุฉ ุงูููููุงุช (ูุทุน ุดุฏุ ุนูุงุฒู): ................ 45,000 ุฑูุงู           โ   โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ           โ   โ
โ  โ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: ............................. 1,725,000 ุฑูุงู        โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                                 โ
โ  ุงูุฅููุงู:                                                                      โ
โ  ุงูุนูุฑ ุงูุงูุชุฑุงุถู: [20] ุณูุฉ    ูุนุฏู ุงูุฅููุงู: 5%    ุงูุฅููุงู ุงูุณููู: 86,250 ุฑูุงู โ
โ                                                                                 โ
โ  [ุฅูุดุงุก ุงูุฃุตู ูููุฏ ุงูุฑุณููุฉ]  [ุญูุธ ููุณูุฏุฉ]  [ุฅูุบุงุก]                            โ
โ                                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 9.8 View: ุชุชุจุน ูุณุงุฑ ุงูููุฑุจุงุก (Power Flow Path)

```sql
-- View ูุชุชุจุน ูุณุงุฑ ุงูููุฑุจุงุก ูู ุงููุญุทุฉ ุฅูู ุฃู ููุทุฉ
CREATE OR REPLACE VIEW v_power_flow_paths AS
WITH RECURSIVE path_trace AS (
    -- ููุทุฉ ุงูุจุฏุงูุฉ: ุงููุญุทุงุช
    SELECT 
        n.id as node_id,
        n.node_code,
        n.node_type,
        n.station_id,
        ARRAY[n.id] as path,
        0 as depth,
        0::DECIMAL as total_length
    FROM network_nodes n
    WHERE n.node_type = 'substation'
    
    UNION ALL
    
    -- ุงูุชุชุจุน ุงูุชูุฑุงุฑู
    SELECT 
        n2.id,
        n2.node_code,
        n2.node_type,
        pt.station_id,
        pt.path || n2.id,
        pt.depth + 1,
        pt.total_length + COALESCE(s.length_meters, 0)
    FROM path_trace pt
    JOIN network_segments s ON s.from_node_id = pt.node_id
    JOIN network_nodes n2 ON n2.id = s.to_node_id
    WHERE NOT n2.id = ANY(pt.path)  -- ููุน ุงูุฏูุฑุงู
    AND pt.depth < 50  -- ุญุฏ ุฃูุตู ููุนูู
)
SELECT * FROM path_trace;
```

## 9.9 ุชุญููู ุงูุดุจูุฉ

### 9.9.1 ุชุญููู ุงูุฎูุงุถ ุงูุฌูุฏ

```sql
CREATE OR REPLACE FUNCTION analyze_voltage_drop(p_from_node UUID, p_to_node UUID)
RETURNS TABLE (
    segment_code VARCHAR,
    length_m DECIMAL,
    cable_size DECIMAL,
    resistance DECIMAL,
    voltage_drop_percent DECIMAL
) AS $$
BEGIN
    -- ุญุณุงุจ ุงูุฎูุงุถ ุงูุฌูุฏ ููู ููุทุน ูู ุงููุณุงุฑ
    RETURN QUERY
    WITH path AS (
        -- ุงุณุชุฎุฏุงู ุงูู recursive CTE ููุญุตูู ุนูู ุงููุณุงุฑ
        SELECT s.*, ROW_NUMBER() OVER() as seq
        FROM network_segments s
        -- ... ููุทู ุชุชุจุน ุงููุณุงุฑ
    )
    SELECT 
        p.segment_code,
        p.length_meters,
        p.cable_size_mm2,
        p.resistance_per_km * (p.length_meters / 1000),
        -- ุตูุบุฉ ูุจุณุทุฉ ูุงูุฎูุงุถ ุงูุฌูุฏ
        (p.resistance_per_km * (p.length_meters / 1000) * 100 / 400)::DECIMAL(5,2)
    FROM path p
    ORDER BY p.seq;
END;
$$ LANGUAGE plpgsql;
```

### 9.9.2 ุชุญููู ุงูุฃุญูุงู

```sql
CREATE OR REPLACE VIEW v_segment_load_analysis AS
SELECT 
    s.id as segment_id,
    s.segment_code,
    s.cable_size_mm2,
    s.max_current_amps,
    COUNT(DISTINCT cbc.customer_id) as connected_customers,
    SUM(c.contracted_load_kw) as total_load_kw,
    (SUM(c.contracted_load_kw) * 1000 / 400)::DECIMAL(10,2) as estimated_current_amps,
    CASE 
        WHEN (SUM(c.contracted_load_kw) * 1000 / 400) > s.max_current_amps * 0.8 THEN 'overloaded'
        WHEN (SUM(c.contracted_load_kw) * 1000 / 400) > s.max_current_amps * 0.6 THEN 'high'
        ELSE 'normal'
    END as load_status
FROM network_segments s
LEFT JOIN network_nodes n ON n.id = s.to_node_id AND n.node_type = 'distribution_box'
LEFT JOIN customer_box_connections cbc ON cbc.box_id = n.id
LEFT JOIN customers c ON c.id = cbc.customer_id
GROUP BY s.id, s.segment_code, s.cable_size_mm2, s.max_current_amps;
```

## 9.10 APIs ูุธุงู ุงูุฎุฑุงุฆุท ูุงูุชูุฃู ุงูุฑููู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| **ุงูููุงูุน** |
| GET | `/api/v1/geo/locations` | ุฌูุจ ุงูููุงูุน (ูุน ุชุตููุฉ) |
| POST | `/api/v1/geo/locations` | ุฅุถุงูุฉ ูููุน ุฌุฏูุฏ |
| PUT | `/api/v1/geo/locations/:id` | ุชุญุฏูุซ ูููุน |
| GET | `/api/v1/geo/nearby` | ุงูุจุญุซ ุจุงููุฑุจ ูู ููุทุฉ |
| **ุนูุฏ ุงูุดุจูุฉ** |
| GET | `/api/v1/network/nodes` | ุฌูุจ ุนูุฏ ุงูุดุจูุฉ |
| POST | `/api/v1/network/nodes` | ุฅุถุงูุฉ ุนูุฏุฉ ุฌุฏูุฏุฉ |
| PUT | `/api/v1/network/nodes/:id` | ุชุญุฏูุซ ุนูุฏุฉ |
| DELETE | `/api/v1/network/nodes/:id` | ุญุฐู ุนูุฏุฉ |
| GET | `/api/v1/network/nodes/:id/components` | ููููุงุช ุงูุนูุฏุฉ |
| **ููุงุทุน ุงูุดุจูุฉ** |
| GET | `/api/v1/network/segments` | ุฌูุจ ููุงุทุน ุงูุดุจูุฉ |
| POST | `/api/v1/network/segments` | ุฅุถุงูุฉ ููุทุน ุฌุฏูุฏ |
| PUT | `/api/v1/network/segments/:id` | ุชุญุฏูุซ ููุทุน |
| DELETE | `/api/v1/network/segments/:id` | ุญุฐู ููุทุน |
| **ุฃุตูู ุงูุดุจูุฉ** |
| GET | `/api/v1/network/assets` | ุฌูุจ ุฃุตูู ุงูุดุจูุฉ |
| POST | `/api/v1/network/assets` | ุฅูุดุงุก ุฃุตู ุดุจูุฉ |
| POST | `/api/v1/network/assets/:id/capitalize` | ุฑุณููุฉ ุฃุตู ุงูุดุจูุฉ |
| **ุงูุชุญููู** |
| GET | `/api/v1/network/trace/:nodeId` | ุชุชุจุน ูุณุงุฑ ุงูููุฑุจุงุก |
| GET | `/api/v1/network/voltage-drop` | ุชุญููู ุงูุฎูุงุถ ุงูุฌูุฏ |
| GET | `/api/v1/network/load-analysis` | ุชุญููู ุงูุฃุญูุงู |
| GET | `/api/v1/network/topology` | ุทูุจูููุฌูุง ุงูุดุจูุฉ |
| **ุงูุทุจุงููู ูุฎุทุท ุงูุชุฑุญูู** |
| GET | `/api/v1/geo/boxes` | ุฌูุจ ุงูุทุจุงููู |
| POST | `/api/v1/geo/boxes` | ุฅุถุงูุฉ ุทุจููู ุฌุฏูุฏ |
| GET | `/api/v1/geo/boxes/:id/customers` | ุงููุดุชุฑููู ุงููุฑุชุจุทูู ุจุทุจููู |
| GET | `/api/v1/migration/plans` | ุฌูุจ ุฎุทุท ุงูุชุฑุญูู |
| POST | `/api/v1/migration/plans` | ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ |
| POST | `/api/v1/migration/plans/:id/approve` | ุงูููุงููุฉ ุนูู ุฎุทุฉ |
| POST | `/api/v1/migration/plans/:id/generate-work-orders` | ุฅูุดุงุก ุฃูุงูุฑ ุงูุนูู |

---

# 10๏ธโฃ ููุตุฉ ุงูุชุดุบูู ูุงููุฑุงูุจุฉ ุงูููุญุฏุฉ - ุบุฑูุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ

> **ุงูุบุฑุถ:** ุฅูุดุงุก ูุงุฌูุฉ ูุฑูุฒูุฉ ุชุฌูุน ูู ุงูุจูุงูุงุช ูุงูุชุญูู ูู ููุงู ูุงุญุฏ - ูุธุงู SCADA ููุจุณูุท ูููุฎุตุต

## 10.1 ุงููุจุฏุฃ ุงูุฃุณุงุณู

```
ููุตุฉ ุงูุชุดุบูู ุงูููุญุฏุฉ:
โ
โโโ ุทุจูุฉ ุฏูุฌ ุงูุจูุงูุงุช ุงูุญูุฉ (Live Data Integration)
โ   โโโ DeepSea/ComAp (ุงููููุฏุงุช)
โ   โโโ Acrel ADW300 (ุนุฏุงุฏุงุช ุงููุฑุงูุจุฉ)
โ   โโโ Acrel ADL200 (ุนุฏุงุฏุงุช ุงููุดุชุฑููู)
โ
โโโ ููุญุฉ ุงูุชุญูู ุงูุฌุบุฑุงููุฉ (GIS Dashboard)
โ   โโโ ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ
โ   โโโ ุงูุจูุงูุงุช ุงูุญูุฉ (Data Overlay)
โ   โโโ ูุญุงูุงุฉ ุชุฏูู ุงูุทุงูุฉ
โ
โโโ ุฃุฏูุงุช ุงูุชุญูู ุงูุณุฑูุนุฉ
โ   โโโ ูุตู/ูุตู ุงููุดุชุฑููู
โ   โโโ ุงูุชุญูู ุจุงูููุงุทุน
โ   โโโ ุงูุชุญูู ุจุงููููุฏุงุช
โ
โโโ ุงูุฑูุงุจุท ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู
    โโโ ูุธุงู ุงูุฃุตูู
    โโโ ูุธุงู ุงูุชุฎุทูุท
    โโโ ูุธุงู ุงูููุชุฑุฉ
    โโโ ูุธุงู ุงููุฎุฒูู
```

## 10.2 ุชูุงูู ูุญุฏุงุช ุชุญูู ุงููููุฏุงุช (DeepSea/ComAp)

### ุฌุฏูู ุชูุงูู ุงููููุฏุงุช (generator_integrations)

```sql
CREATE TABLE generator_integrations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    generator_id UUID REFERENCES generators(id),
    
    -- ููุน ูุญุฏุฉ ุงูุชุญูู
    controller_type VARCHAR(50) NOT NULL,  -- 'deepsea', 'comap', 'other'
    controller_model VARCHAR(100),          -- 'DSE8610', 'InteliGen', etc.
    
    -- ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู
    connection_type VARCHAR(30),            -- 'modbus_tcp', 'modbus_rtu', 'api'
    ip_address VARCHAR(45),
    port INTEGER,
    slave_id INTEGER,
    api_endpoint VARCHAR(255),
    api_key VARCHAR(255),
    
    -- ุญุงูุฉ ุงูุงุชุตุงู
    is_connected BOOLEAN DEFAULT FALSE,
    last_connection TIMESTAMP,
    connection_errors INTEGER DEFAULT 0,
    
    -- ุฅุนุฏุงุฏุงุช ุงููุฑุงุกุฉ
    polling_interval_seconds INTEGER DEFAULT 5,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

### ุฌุฏูู ูุฑุงุกุงุช ุงููููุฏุงุช ุงูุญูุฉ (generator_live_readings)

```sql
CREATE TABLE generator_live_readings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    generator_id UUID REFERENCES generators(id),
    
    -- ุงูุจูุงูุงุช ุงูููุฑุจุงุฆูุฉ
    power_kw DECIMAL(10,2),           -- ุงูุฅูุชุงุฌ ุงูุญุงูู
    voltage_l1 DECIMAL(10,2),
    voltage_l2 DECIMAL(10,2),
    voltage_l3 DECIMAL(10,2),
    current_l1 DECIMAL(10,2),
    current_l2 DECIMAL(10,2),
    current_l3 DECIMAL(10,2),
    frequency_hz DECIMAL(5,2),
    power_factor DECIMAL(4,3),
    
    -- ุจูุงูุงุช ุงููุญุฑู
    engine_temperature DECIMAL(5,2),
    oil_pressure DECIMAL(10,2),
    coolant_temperature DECIMAL(5,2),
    fuel_level_percent DECIMAL(5,2),
    battery_voltage DECIMAL(5,2),
    
    -- ุจูุงูุงุช ุงูุชุดุบูู
    running_hours DECIMAL(15,2),
    generator_status VARCHAR(30),     -- 'running', 'stopped', 'standby', 'fault'
    
    -- ุงูุฃุฎุทุงุก ูุงูุชูุจููุงุช
    active_alarms JSONB,              -- [{code, description, severity}]
    
    reading_timestamp TIMESTAMP DEFAULT NOW()
);

-- ููุฑุณ ูููุฑุงุกุงุช ุงูุญูุฉ
CREATE INDEX idx_generator_live_readings_gen ON generator_live_readings(generator_id);
CREATE INDEX idx_generator_live_readings_time ON generator_live_readings(reading_timestamp DESC);
```

### Function: ุฌูุจ ุจูุงูุงุช ุงููููุฏ ูู DeepSea

```sql
CREATE OR REPLACE FUNCTION fetch_deepsea_generator_data(p_generator_id UUID)
RETURNS JSONB AS $$
DECLARE
    v_integration RECORD;
    v_response JSONB;
BEGIN
    -- ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุชูุงูู
    SELECT * INTO v_integration 
    FROM generator_integrations 
    WHERE generator_id = p_generator_id AND controller_type = 'deepsea';
    
    -- ูุญุงูุงุฉ ุฌูุจ ุงูุจูุงูุงุช (ูู ุงูุฅูุชุงุฌ: ุงุณุชุฏุนุงุก API ุญูููู)
    v_response := jsonb_build_object(
        'status', 'running',
        'power_kw', 450,
        'voltage', jsonb_build_object('l1', 380, 'l2', 379, 'l3', 381),
        'current', jsonb_build_object('l1', 685, 'l2', 680, 'l3', 690),
        'frequency_hz', 50.0,
        'engine_temp', 72,
        'running_hours', 15240,
        'alarms', '[]'::jsonb
    );
    
    -- ุชุณุฌูู ุงููุฑุงุกุฉ
    INSERT INTO generator_live_readings (
        generator_id, power_kw, voltage_l1, voltage_l2, voltage_l3,
        current_l1, current_l2, current_l3, frequency_hz,
        engine_temperature, running_hours, generator_status, active_alarms
    ) VALUES (
        p_generator_id,
        (v_response->>'power_kw')::DECIMAL,
        (v_response->'voltage'->>'l1')::DECIMAL,
        (v_response->'voltage'->>'l2')::DECIMAL,
        (v_response->'voltage'->>'l3')::DECIMAL,
        (v_response->'current'->>'l1')::DECIMAL,
        (v_response->'current'->>'l2')::DECIMAL,
        (v_response->'current'->>'l3')::DECIMAL,
        (v_response->>'frequency_hz')::DECIMAL,
        (v_response->>'engine_temp')::DECIMAL,
        (v_response->>'running_hours')::DECIMAL,
        v_response->>'status',
        v_response->'alarms'
    );
    
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุงุชุตุงู
    UPDATE generator_integrations 
    SET is_connected = TRUE, last_connection = NOW()
    WHERE generator_id = p_generator_id;
    
    RETURN v_response;
END;
$$ LANGUAGE plpgsql;
```

## 10.3 ููุญุฉ ุงูุชุญูู ุงูุฌุบุฑุงููุฉ ุงูููุญุฏุฉ

### ุดุงุดุฉ ุบุฑูุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐๏ธ ุบุฑูุฉ ุงูุชุญูู ุงููุฑูุฒูุฉ - ูุธุงู ุงููุฑุงูุจุฉ ุงูููุญุฏ                               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โ
โ โ                    ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ                       โ โ ููุฎุต ุณุฑูุน  โ โ
โ โ                                                             โ โ             โ โ
โ โ    โก ุงููุญุทุฉ ุงูุฑุฆูุณูุฉ                                      โ โ ุงูุฅูุชุงุฌ:    โ โ
โ โ      โ(450 kW) โ                                           โ โ 650 kW      โ โ
โ โ      โ                                                      โ โ             โ โ
โ โ      โโ โ๏ธ ูุญุทุฉ ุดูุณูุฉ                                      โ โ ุงูุงุณุชููุงู:  โ โ
โ โ      โ  โ(+200 kW) โ                                       โ โ 620 kW      โ โ
โ โ      โ                                                      โ โ             โ โ
โ โ      โโ ๐ ุดุจูุฉ ุงูุชูุฒูุน                                    โ โ ุงููุงุฆุถ:     โ โ
โ โ         โ                                                   โ โ +30 kW      โ โ
โ โ         โโ ๐๏ธ ุญู ุงูุณูุงู                                    โ โ             โ โ
โ โ         โ  โโ ูุญูู 1 โ(85 kW)                             โ โ โโโโโโโโโโโ โ โ
โ โ         โ  โโ ูุญูู 2 โ(92 kW)                             โ โ ุงููุดุชุฑููู: โ โ
โ โ         โ  โโ 250 ูุดุชุฑู                                    โ โ 430 ูุชุตู   โ โ
โ โ         โ     โโ ๐ข 230 ูุชุตู                               โ โ 15 ููุตูู   โ โ
โ โ         โ     โโ ๐ด 12 ููุตูู (ุฏูู)                         โ โ             โ โ
โ โ         โ     โโ โช 8 ููุตูู (ุฃูุฑ)                          โ โ โโโโโโโโโโโ โ โ
โ โ         โ                                                   โ โ ุงูุชูุจููุงุช: โ โ
โ โ         โโ ๐๏ธ ุญู ุงูููุฑ                                     โ โ โ๏ธ 2 ุชุญุฐูุฑ โ โ
โ โ            โโ ูุญูู 3 โ(78 kW)                             โ โ ๐ด 0 ุฎุทุฃ   โ โ
โ โ            โโ 180 ูุดุชุฑู                                    โ โ             โ โ
โ โ                                                             โ โ             โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โ
โ                                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ุฃุฏูุงุช ุงูุชุญูู ุงูุณุฑูุนุฉ                                                       โ โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ โ [๐ ูุตู ูุดุชุฑู] [๐ ูุตู ูุดุชุฑู] [โก ุชุดุบูู ูููุฏ] [๐ ุฅููุงู ูููุฏ]            โ โ
โ โ [๐ ูุชุญ ูุงุทุน] [๐ ุฅุบูุงู ูุงุทุน] [๐ ุฅุนุงุฏุฉ ุชูุงุฒู] [๐ ุฅูุดุงุก ุฃูุฑ ุนูู]        โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ุงูุชูุจููุงุช ุงููุดุทุฉ                                                           โ โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ
โ โ โ๏ธ 14:32 - ูุญูู ุญู ุงูุณูุงู 2: ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ูุฑุชูุนุฉ (65ยฐC)    [ุนุฑุถ] [ุฅุฌุฑุงุก] โ โ
โ โ โ๏ธ 14:28 - ูุดุชุฑู #1234: ุชุฌุงูุฒ ุงูุญุฏ ุงููุณููุญ (15 kW)         [ุนุฑุถ] [ูุตู]   โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                                 โ
โ ุขุฎุฑ ุชุญุฏูุซ: 2025-12-14 14:35:22                              [๐ ุชุญุฏูุซ ูุฏูู]   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 10.4 ูุญุงูุงุฉ ุชุฏูู ุงูุทุงูุฉ (Power Flow Simulation)

### ุฌุฏูู ุชุฏูู ุงูุทุงูุฉ (power_flow_data)

```sql
CREATE TABLE power_flow_data (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุงููุตุฏุฑ ูุงููุฌูุฉ
    source_type VARCHAR(30),          -- 'generator', 'solar', 'grid'
    source_id UUID,
    destination_type VARCHAR(30),     -- 'transformer', 'distribution_box', 'customer'
    destination_id UUID,
    
    -- ุจูุงูุงุช ุงูุชุฏูู
    power_kw DECIMAL(10,2),
    direction VARCHAR(10),            -- 'forward', 'reverse'
    load_percentage DECIMAL(5,2),
    
    -- ุงูุญุงูุฉ
    flow_status VARCHAR(20),          -- 'normal', 'overload', 'underload'
    
    calculated_at TIMESTAMP DEFAULT NOW()
);
```

### View: ุชุฏูู ุงูุทุงูุฉ ุงูุญู

```sql
CREATE OR REPLACE VIEW v_live_power_flow AS
SELECT 
    -- ุงููุตุงุฏุฑ (ุงููููุฏุงุช)
    g.id as source_id,
    'generator' as source_type,
    g.generator_name as source_name,
    glr.power_kw as generation_kw,
    
    -- ุงููุฌูุงุช (ุงููุญููุงุช)
    nn.id as destination_id,
    nn.node_type as destination_type,
    nn.node_name as destination_name,
    
    -- ุญุณุงุจ ุงูุชุฏูู
    glr.power_kw as flow_kw,
    CASE 
        WHEN glr.power_kw > g.rated_capacity * 0.9 THEN 'overload'
        WHEN glr.power_kw < g.rated_capacity * 0.3 THEN 'underload'
        ELSE 'normal'
    END as flow_status
FROM generators g
LEFT JOIN generator_live_readings glr ON glr.generator_id = g.id
    AND glr.reading_timestamp = (SELECT MAX(reading_timestamp) FROM generator_live_readings WHERE generator_id = g.id)
LEFT JOIN network_nodes nn ON nn.station_id = g.station_id;
```

## 10.5 ุฃุฏูุงุช ุงูุชุญูู ุงูุณุฑูุนุฉ

### ุฌุฏูู ุฃูุงูุฑ ุงูุชุญูู (control_commands)

```sql
CREATE TABLE control_commands (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ููุน ุงูุฃูุฑ
    command_type VARCHAR(50) NOT NULL,  -- 'disconnect_customer', 'reconnect_customer', 'open_breaker', 'close_breaker', 'start_generator', 'stop_generator'
    
    -- ุงููุฏู
    target_type VARCHAR(30),            -- 'customer', 'breaker', 'generator', 'transformer'
    target_id UUID,
    
    -- ุชูุงุตูู ุงูุฃูุฑ
    command_params JSONB,
    reason TEXT,
    
    -- ุงูุชูููุฐ
    status VARCHAR(20) DEFAULT 'pending',  -- 'pending', 'executing', 'completed', 'failed'
    executed_at TIMESTAMP,
    execution_result JSONB,
    error_message TEXT,
    
    -- ุงูุชุชุจุน
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    
    -- ุงูููุงููุฉ (ููุฃูุงูุฑ ุงูุญุณุงุณุฉ)
    requires_approval BOOLEAN DEFAULT FALSE,
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP
);
```

### Function: ุชูููุฐ ุฃูุฑ ูุตู ูุดุชุฑู

```sql
CREATE OR REPLACE FUNCTION execute_disconnect_customer(
    p_customer_id UUID,
    p_reason TEXT,
    p_operator_id UUID
)
RETURNS JSONB AS $$
DECLARE
    v_command_id UUID;
    v_meter_id UUID;
    v_result JSONB;
BEGIN
    -- ุฅูุดุงุก ุณุฌู ุงูุฃูุฑ
    INSERT INTO control_commands (
        command_type, target_type, target_id, reason, created_by
    ) VALUES (
        'disconnect_customer', 'customer', p_customer_id, p_reason, p_operator_id
    ) RETURNING id INTO v_command_id;
    
    -- ุฌูุจ ูุนุฑู ุงูุนุฏุงุฏ
    SELECT meter_id INTO v_meter_id FROM customers WHERE id = p_customer_id;
    
    -- ุชูููุฐ ุงููุตู ุนุจุฑ API ุงูุนุฏุงุฏ ุงูุฐูู
    -- (ูู ุงูุฅูุชุงุฌ: ุงุณุชุฏุนุงุก API ุญูููู)
    v_result := jsonb_build_object(
        'success', TRUE,
        'meter_id', v_meter_id,
        'disconnected_at', NOW()
    );
    
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุฃูุฑ
    UPDATE control_commands 
    SET status = 'completed', 
        executed_at = NOW(),
        execution_result = v_result
    WHERE id = v_command_id;
    
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุนููู
    UPDATE customers 
    SET status = 'disconnected',
        disconnection_date = CURRENT_DATE
    WHERE id = p_customer_id;
    
    -- ุชุณุฌูู ูู ุณุฌู ุงูุนููู
    INSERT INTO customer_history (customer_id, action, details, performed_by)
    VALUES (p_customer_id, 'disconnected', p_reason, p_operator_id);
    
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;
```

### Function: ุชูููุฐ ุฃูุฑ ูุตู ูุดุชุฑู

```sql
CREATE OR REPLACE FUNCTION execute_reconnect_customer(
    p_customer_id UUID,
    p_reason TEXT,
    p_operator_id UUID
)
RETURNS JSONB AS $$
DECLARE
    v_command_id UUID;
    v_meter_id UUID;
    v_result JSONB;
BEGIN
    -- ุฅูุดุงุก ุณุฌู ุงูุฃูุฑ
    INSERT INTO control_commands (
        command_type, target_type, target_id, reason, created_by
    ) VALUES (
        'reconnect_customer', 'customer', p_customer_id, p_reason, p_operator_id
    ) RETURNING id INTO v_command_id;
    
    -- ุฌูุจ ูุนุฑู ุงูุนุฏุงุฏ
    SELECT meter_id INTO v_meter_id FROM customers WHERE id = p_customer_id;
    
    -- ุชูููุฐ ุงููุตู ุนุจุฑ API ุงูุนุฏุงุฏ ุงูุฐูู
    v_result := jsonb_build_object(
        'success', TRUE,
        'meter_id', v_meter_id,
        'reconnected_at', NOW()
    );
    
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุฃูุฑ
    UPDATE control_commands 
    SET status = 'completed', 
        executed_at = NOW(),
        execution_result = v_result
    WHERE id = v_command_id;
    
    -- ุชุญุฏูุซ ุญุงูุฉ ุงูุนููู
    UPDATE customers 
    SET status = 'active',
        disconnection_date = NULL
    WHERE id = p_customer_id;
    
    -- ุชุณุฌูู ูู ุณุฌู ุงูุนููู
    INSERT INTO customer_history (customer_id, action, details, performed_by)
    VALUES (p_customer_id, 'reconnected', p_reason, p_operator_id);
    
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;
```

## 10.6 ุงูุฑูุงุจุท ุงูุณุฑูุนุฉ ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### ุฌุฏูู ุงูุฑูุงุจุท ุงูุณุฑูุนุฉ (quick_links_config)

```sql
CREATE TABLE quick_links_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ูุตุฏุฑ ุงูุฑุงุจุท
    source_element_type VARCHAR(50),  -- 'generator', 'transformer', 'customer', 'network_node'
    
    -- ุงูุฑุงุจุท ุงููุฏู
    link_type VARCHAR(50),            -- 'asset_history', 'create_work_order', 'view_invoice', 'check_inventory'
    target_system VARCHAR(50),        -- 'assets', 'planning', 'billing', 'inventory'
    link_template VARCHAR(255),       -- '/assets/{asset_id}/history'
    
    -- ุงูุนุฑุถ
    link_label VARCHAR(100),
    link_icon VARCHAR(50),
    display_order INTEGER,
    
    is_active BOOLEAN DEFAULT TRUE
);

-- ุฅุฏุฎุงู ุงูุฑูุงุจุท ุงูุงูุชุฑุงุถูุฉ
INSERT INTO quick_links_config (source_element_type, link_type, target_system, link_template, link_label, link_icon, display_order) VALUES
-- ุฑูุงุจุท ุงููููุฏุงุช
('generator', 'asset_history', 'assets', '/assets/generators/{id}/history', 'ุนุฑุถ ุงูููู ุงูุชุงุฑูุฎู', 'history', 1),
('generator', 'create_work_order', 'planning', '/work-orders/new?asset_type=generator&asset_id={id}', 'ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ', 'wrench', 2),

-- ุฑูุงุจุท ุงููุญููุงุช
('transformer', 'asset_history', 'assets', '/assets/transformers/{id}/history', 'ุนุฑุถ ุงูููู ุงูุชุงุฑูุฎู', 'history', 1),
('transformer', 'create_work_order', 'planning', '/work-orders/new?asset_type=transformer&asset_id={id}', 'ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ', 'wrench', 2),
('transformer', 'check_inventory', 'inventory', '/inventory/check?asset_type=transformer', 'ุงูุชุญูู ูู ูุทุน ุงูุบูุงุฑ', 'box', 3),

-- ุฑูุงุจุท ุงููุดุชุฑููู
('customer', 'view_invoice', 'billing', '/customers/{id}/invoices', 'ุนุฑุถ ุงูููุงุชูุฑ', 'file-text', 1),
('customer', 'payment_history', 'billing', '/customers/{id}/payments', 'ุณุฌู ุงููุฏููุนุงุช', 'credit-card', 2),
('customer', 'create_work_order', 'planning', '/work-orders/new?customer_id={id}', 'ุฅูุดุงุก ุฃูุฑ ุนูู', 'wrench', 3),

-- ุฑูุงุจุท ุนูุฏ ุงูุดุจูุฉ
('network_node', 'asset_history', 'assets', '/network/nodes/{id}/history', 'ุนุฑุถ ุงูููู ุงูุชุงุฑูุฎู', 'history', 1),
('network_node', 'create_work_order', 'planning', '/work-orders/new?network_node_id={id}', 'ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ', 'wrench', 2);
```

## 10.7 ุดุงุดุฉ ุชูุงุตูู ุงูุนูุตุฑ (Element Details Popup)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ ูุญูู ุญู ุงูุณูุงู ุงูุฑุฆูุณู                                     โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                 โ
โ ๐ ุงูุจูุงูุงุช ุงูุญูุฉ:                                             โ
โ โโ ุงูุฌูุฏ: 380/230 ูููุช                                        โ
โ โโ ุงูุชูุงุฑ: 150-152 ุฃูุจูุฑ                                      โ
โ โโ ุงูุทุงูุฉ: 85 ูููููุงุท                                         โ
โ โโ ูุนุงูู ุงููุฏุฑุฉ: 0.96                                         โ
โ โโ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: 45ยฐC                                         โ
โ โโ ุงูุงุณุชููุงู ุงูุชุฑุงููู: 125,450 ูููููุงุท/ุณุงุนุฉ                   โ
โ                                                                 โ
โ ๐ ุงูุญุงูุฉ: โ ุทุจูุนู                                            โ
โ                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                 โ
โ ๐ ุฑูุงุจุท ุณุฑูุนุฉ:                                                โ
โ โโ [๐ ุนุฑุถ ุงูููู ุงูุชุงุฑูุฎู] โ ูุธุงู ุงูุฃุตูู                      โ
โ โโ [๐ง ุฅูุดุงุก ุฃูุฑ ุตูุงูุฉ] โ ูุธุงู ุงูุชุฎุทูุท                        โ
โ โโ [๐ฆ ุงูุชุญูู ูู ูุทุน ุงูุบูุงุฑ] โ ูุธุงู ุงููุฎุฒูู                   โ
โ โโ [๐ฐ ุนุฑุถ ุงูุชูุงููู] โ ุงููุธุงู ุงููุญุงุณุจู                        โ
โ                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                 โ
โ ๐ ูุนูููุงุช ุฅุถุงููุฉ:                                             โ
โ โโ ุขุฎุฑ ุตูุงูุฉ: 2025-11-15                                      โ
โ โโ ุงูุชูููุฉ ุงููุชุฑุงููุฉ: 45,000 ุฑูุงู                             โ
โ โโ ุงูุฅููุงู ุงููุชุฑุงูู: 125,000 ุฑูุงู                             โ
โ                                                                 โ
โ                                              [ุฅุบูุงู]           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 10.8 APIs ููุตุฉ ุงูุชุดุบูู ุงูููุญุฏุฉ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/control-center/overview` | ููุฎุต ุบุฑูุฉ ุงูุชุญูู |
| GET | `/api/v1/control-center/map-data` | ุจูุงูุงุช ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ |
| GET | `/api/v1/control-center/live-readings` | ุงููุฑุงุกุงุช ุงูุญูุฉ |
| GET | `/api/v1/control-center/power-flow` | ุจูุงูุงุช ุชุฏูู ุงูุทุงูุฉ |
| GET | `/api/v1/control-center/alerts` | ุงูุชูุจููุงุช ุงููุดุทุฉ |
| POST | `/api/v1/control-center/commands/disconnect` | ูุตู ูุดุชุฑู |
| POST | `/api/v1/control-center/commands/reconnect` | ูุตู ูุดุชุฑู |
| POST | `/api/v1/control-center/commands/breaker` | ุงูุชุญูู ุจุงููุงุทุน |
| POST | `/api/v1/control-center/commands/generator` | ุงูุชุญูู ุจุงููููุฏ |
| GET | `/api/v1/control-center/element/:type/:id` | ุชูุงุตูู ุนูุตุฑ |
| GET | `/api/v1/control-center/element/:type/:id/quick-links` | ุงูุฑูุงุจุท ุงูุณุฑูุนุฉ |
| GET | `/api/v1/generators/:id/live-data` | ุจูุงูุงุช ุงููููุฏ ุงูุญูุฉ |
| POST | `/api/v1/generators/:id/fetch-data` | ุฌูุจ ุจูุงูุงุช ุงููููุฏ |

---

> **ุงูุธุฑ ุฃูุถุงู:** 
> - `03_ูุธุงู_ุงูุฃุตูู_ูุงูุตูุงูุฉ.md` - ููููู ุงูุชุงุฑูุฎู ููุฃุตูู
> - `07_ูุธุงู_ุงูุนููุงุก_ูุงูููุชุฑุฉ.md` - ููุตู/ูุตู ุงููุดุชุฑููู
> - `10_ูุธุงู_ุงูุชุฎุทูุท_ูุงููุดุงุฑูุน.md` - ูุฅูุดุงุก ุฃูุงูุฑ ุงูุนูู
> - `06_ูุธุงู_ุงููุฎุฒูู_ูุงููุดุชุฑูุงุช.md` - ููุชุญูู ูู ุงูููุงุฏ

---

# 10. ูุญุฏุฉ ุฅุฏุงุฑุฉ ุดุจูุฉ ุงูุงุชุตุงูุงุช ุงููุงุณูููุฉ ุงูุฎุงุตุฉ (IoT Network Management)

## 10.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุชุตููู ูุฅุฏุงุฑุฉ ุดุจูุฉ ุงุชุตุงูุงุช ูุงุณูููุฉ ุฎุงุตุฉ ูุฑุจุท ุนุฏุงุฏุงุช IoT ุจุงูุฎุงุฏู ุงููุฑูุฒูุ ูุณุชููุฉ ุนู ุดุจูุฉ ุงูุฅูุชุฑูุช ุงูุนุงูุฉ.

### ุจููุฉ ุงูุดุจูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           ุงููุญุทุฉ ุงููุฑูุฒูุฉ                                   โ
โ                         (ุฎุงุฏู Acrel + Controller)                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                          Backhaul (Point-to-Multi-Point)
                          (ููุงุฆูุงุช ูุงุณูููุฉ ูููุฉ)
                                    โ
          โโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โผ                         โผ                         โผ
โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ
โ   ููุทุฉ ูุตูู    โ       โ   ููุทุฉ ูุตูู    โ       โ   ููุทุฉ ูุตูู    โ
โ   ุฑุฆูุณูุฉ (ุฃ)   โ       โ   ุฑุฆูุณูุฉ (ุจ)   โ       โ   ุฑุฆูุณูุฉ (ุฌ)   โ
โ   (ุญู ุงูุฃูู)   โ       โ   (ุญู ุงูููุฑ)   โ       โ   (ุญู ุงูุณูุงู)  โ
โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโ
          โ                         โ                         โ
    WiFi ุฎุงุต                  WiFi ุฎุงุต                  WiFi ุฎุงุต
  (Al-Amal_Power_IoT)      (Al-Amal_Power_IoT)      (Al-Amal_Power_IoT)
          โ                         โ                         โ
    โโโโโโโดโโโโโโ             โโโโโโโดโโโโโโ             โโโโโโโดโโโโโโ
    โ  ุนุฏุงุฏุงุช  โ             โ  ุนุฏุงุฏุงุช  โ             โ  ุนุฏุงุฏุงุช  โ
    โ   IoT    โ             โ   IoT    โ             โ   IoT    โ
    โ (ADL200) โ             โ (ADL200) โ             โ (ADL200) โ
    โโโโโโโโโโโโโ             โโโโโโโโโโโโโ             โโโโโโโโโโโโโ
```

## 10.2 ุฌุฏูู ููุงุท ุงููุตูู (access_points)

```sql
CREATE TABLE access_points (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ููุทุฉ ุงููุตูู
    ap_code VARCHAR(50) UNIQUE NOT NULL,
    ap_name VARCHAR(200) NOT NULL,
    ap_type ENUM('main', 'repeater', 'outdoor', 'indoor') NOT NULL,
    
    -- ูุนูููุงุช ุงูุฌูุงุฒ
    device_model VARCHAR(100),
    device_brand VARCHAR(100),
    mac_address VARCHAR(17) UNIQUE,
    serial_number VARCHAR(100),
    ip_address VARCHAR(45),
    
    -- ุงููููุน ุงูุฌุบุฑุงูู
    location_name VARCHAR(200),           -- ุงุณู ุงููููุน (ุณุทุญ ูุญุทุฉ Xุ ุนููุฏ ุฅูุงุฑุฉ Y)
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    altitude DECIMAL(6, 2),               -- ุงูุงุฑุชูุงุน ุจุงููุชุฑ
    coverage_radius_meters INT,           -- ูุตู ูุทุฑ ุงูุชุบุทูุฉ
    
    -- ุฅุนุฏุงุฏุงุช ุงูุดุจูุฉ
    ssid VARCHAR(100),
    channel INT,
    frequency_band VARCHAR(20),           -- 2.4GHz, 5GHz, dual
    max_clients INT,
    
    -- ุงูุฑุจุท ุจููุทุฉ ุงููุตูู ุงูุฃุนูู (ููููุฑุฑุงุช)
    parent_ap_id UUID REFERENCES access_points(id),
    
    -- ุงูุญุงูุฉ
    status ENUM('active', 'inactive', 'maintenance', 'offline') DEFAULT 'active',
    last_seen_at TIMESTAMP,
    uptime_seconds BIGINT,
    
    -- ุงูุชุฑููุจ
    installation_date DATE,
    installed_by UUID REFERENCES users(id),
    
    -- ุงูุตูุงูุฉ
    last_maintenance_date DATE,
    next_maintenance_date DATE,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_ap_station ON access_points(station_id);
CREATE INDEX idx_ap_status ON access_points(status);
CREATE INDEX idx_ap_location ON access_points USING GIST (
    ST_SetSRID(ST_MakePoint(longitude, latitude), 4326)
);
```

## 10.3 ุฌุฏูู ูุฑุงูุจุฉ ููุงุท ุงููุตูู (ap_monitoring)

```sql
CREATE TABLE ap_monitoring (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ap_id UUID NOT NULL REFERENCES access_points(id),
    
    -- ููุงุณุงุช ุงูุฃุฏุงุก
    connected_clients INT,
    cpu_usage_percent DECIMAL(5, 2),
    memory_usage_percent DECIMAL(5, 2),
    temperature_celsius DECIMAL(5, 2),
    
    -- ููุงุณุงุช ุงูุฅุดุงุฑุฉ
    signal_strength_dbm INT,
    noise_level_dbm INT,
    channel_utilization_percent DECIMAL(5, 2),
    
    -- ููุงุณุงุช ุงูุดุจูุฉ
    rx_bytes BIGINT,
    tx_bytes BIGINT,
    rx_packets BIGINT,
    tx_packets BIGINT,
    rx_errors INT,
    tx_errors INT,
    
    -- ุญุงูุฉ ุงูุงุชุตุงู
    is_online BOOLEAN DEFAULT true,
    latency_ms INT,
    
    recorded_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_ap_monitoring_ap ON ap_monitoring(ap_id);
CREATE INDEX idx_ap_monitoring_time ON ap_monitoring(recorded_at);

-- Partition by month for performance
-- CREATE TABLE ap_monitoring_2024_12 PARTITION OF ap_monitoring
--     FOR VALUES FROM ('2024-12-01') TO ('2025-01-01');
```

## 10.4 ุฌุฏูู ุฑุจุท ุงูุนุฏุงุฏุงุช ุจููุงุท ุงููุตูู (meter_ap_connections)

```sql
CREATE TABLE meter_ap_connections (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    meter_id UUID NOT NULL REFERENCES iot_meters(id),
    ap_id UUID NOT NULL REFERENCES access_points(id),
    
    -- ูุนูููุงุช ุงูุงุชุตุงู
    signal_strength_dbm INT,
    connection_quality ENUM('excellent', 'good', 'fair', 'poor', 'disconnected'),
    
    -- ุฅุญุตุงุฆูุงุช
    connected_since TIMESTAMP,
    total_disconnections INT DEFAULT 0,
    avg_latency_ms DECIMAL(10, 2),
    
    -- ุขุฎุฑ ุชุญุฏูุซ
    last_heartbeat TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(meter_id)  -- ูู ุนุฏุงุฏ ูุชุตู ุจููุทุฉ ูุตูู ูุงุญุฏุฉ ููุท
);

CREATE INDEX idx_meter_ap_meter ON meter_ap_connections(meter_id);
CREATE INDEX idx_meter_ap_ap ON meter_ap_connections(ap_id);
```

## 10.5 ุฌุฏูู ูุดุงุฑูุน ุงููุณุญ ุงููุงุณููู (wireless_surveys)

```sql
CREATE TABLE wireless_surveys (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงููุดุฑูุน
    survey_name VARCHAR(200) NOT NULL,
    survey_area VARCHAR(200),             -- ุงูููุทูุฉ ุงููุณุชูุฏูุฉ
    
    -- ุงููุฑูู
    surveyor_id UUID REFERENCES users(id),
    survey_date DATE,
    
    -- ุงููุชุงุฆุฌ
    recommended_ap_locations JSONB,       -- ููุงูุน ููุงุท ุงููุตูู ุงูููุชุฑุญุฉ
    coverage_map_file VARCHAR(500),       -- ููู ุฎุฑูุทุฉ ุงูุชุบุทูุฉ
    interference_notes TEXT,              -- ููุงุญุธุงุช ุงูุชุฏุงุฎู
    
    -- ุงูุญุงูุฉ
    status ENUM('planned', 'in_progress', 'completed', 'approved') DEFAULT 'planned',
    approved_by UUID REFERENCES users(id),
    approved_at TIMESTAMP,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

## 10.6 ุดุงุดุฉ ูุฑุงูุจุฉ ุดุจูุฉ ุงูุงุชุตุงูุงุช

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐ ูุฑุงูุจุฉ ุดุจูุฉ ุงูุงุชุตุงูุงุช IoT                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                         ููุฎุต ุงูุดุจูุฉ                                 โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  ููุงุท ุงููุตูู    โ  ุงูุนุฏุงุฏุงุช ุงููุชุตูุฉ  โ  ุฌูุฏุฉ ุงูุดุจูุฉ  โ  ุงูุชูุจููุงุช  โ   โ
โ  โ  โโโโโโโโโโโโ   โ   โโโโโโโโโโโโ     โ  โโโโโโโโโโโ  โ  โโโโโโโโโโ โ   โ
โ  โ  โ    12    โ   โ   โ   1,847  โ     โ  โ  94.5%  โ  โ  โ   3    โ โ   โ
โ  โ  โ  ๐ข 10   โ   โ   โ  โโโโโโโโโ     โ  โ ููุชุงุฒุฉ  โ  โ  โ  โ๏ธ   โ โ   โ
โ  โ  โ  ๐ด 2    โ   โ   โ  ูุชุตู   โ     โ  โโโโโโโโโโโ  โ  โโโโโโโโโโ โ   โ
โ  โ  โโโโโโโโโโโโ   โ   โโโโโโโโโโโโ     โ               โ             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุฎุฑูุทุฉ ููุงุท ุงููุตูู                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                     โ   โ
โ  โ         ๐ข AP-001                    ๐ข AP-003                      โ   โ
โ  โ         ุญู ุงูุฃูู                     ุญู ุงูุณูุงู                     โ   โ
โ  โ         (156 ุนุฏุงุฏ)                   (203 ุนุฏุงุฏ)                    โ   โ
โ  โ              โฒ                           โฑ                          โ   โ
โ  โ               โฒ                         โฑ                           โ   โ
โ  โ                โฒ       ๐ญ ุงููุญุทุฉ      โฑ                            โ   โ
โ  โ                 โฒ      ุงููุฑูุฒูุฉ     โฑ                              โ   โ
โ  โ                  โฒ                 โฑ                                โ   โ
โ  โ         ๐ด AP-002 โโโโโโโโโโโโโโโโโ                                โ   โ
โ  โ         ุญู ุงูููุฑ (ูุนุทู)                                            โ   โ
โ  โ         โ๏ธ ุขุฎุฑ ุงุชุตุงู: ููุฐ 45 ุฏูููุฉ                                 โ   โ
โ  โ                                                                     โ   โ
โ  โ  [ุทุจูุงุช: โ๏ธ ููุงุท ุงููุตูู  โ๏ธ ุงูุนุฏุงุฏุงุช  โ ุงูุชุบุทูุฉ  โ ุงูุฅุดุงุฑุฉ]       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ูุงุฆูุฉ ููุงุท ุงููุตูู                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุฏ    โ ุงูุงุณู      โ ุงูููุน   โ ุงูุนุฏุงุฏุงุช โ ุงูุญุงูุฉ  โ ุงูุฅุดุงุฑุฉ โ โ๏ธ โ   โ
โ  โโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโผโโโโโค   โ
โ  โ AP-001   โ ุญู ุงูุฃูู   โ ุฑุฆูุณูุฉ โ 156      โ ๐ข ูุชุตู โ -45 dBm โ ๐๏ธ โ   โ
โ  โ AP-002   โ ุญู ุงูููุฑ   โ ุฑุฆูุณูุฉ โ 0        โ ๐ด ูุนุทู โ --      โ ๐ง โ   โ
โ  โ AP-003   โ ุญู ุงูุณูุงู  โ ุฑุฆูุณูุฉ โ 203      โ ๐ข ูุชุตู โ -52 dBm โ ๐๏ธ โ   โ
โ  โ AP-004   โ ููุฑุฑ ุฃ-1   โ ููุฑุฑ   โ 89       โ ๐ข ูุชุตู โ -58 dBm โ ๐๏ธ โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 10.7 ุดุงุดุฉ ุชูุงุตูู ููุทุฉ ุงููุตูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐ก ุชูุงุตูู ููุทุฉ ุงููุตูู: AP-001                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ูุนูููุงุช ุงูุฌูุงุฒ              โ ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ ุงูุงุณู: ููุทุฉ ูุตูู ุญู ุงูุฃูู   โ ุงูุนุฏุงุฏุงุช ุงููุชุตูุฉ: 156                 โ   โ
โ  โ ุงูููุน: ุฑุฆูุณูุฉ (Outdoor)     โ CPU: 23%  โโโโโโโโโโ                  โ   โ
โ  โ ุงูููุฏูู: Ubiquiti UAP-AC-M  โ RAM: 45%  โโโโโโโโโโ                  โ   โ
โ  โ MAC: AA:BB:CC:DD:EE:FF      โ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: 42ยฐC                    โ   โ
โ  โ IP: 192.168.10.101          โ Uptime: 45 ููู 12 ุณุงุนุฉ               โ   โ
โ  โ ุงููููุน: ุณุทุญ ูุญุทุฉ ุงูุฃูู      โ                                       โ   โ
โ  โ ุงูุงุฑุชูุงุน: 15 ูุชุฑ            โ ุงุณุชููุงู ุงูุจูุงูุงุช (ุงูููู):             โ   โ
โ  โ ูุตู ูุทุฑ ุงูุชุบุทูุฉ: 500 ูุชุฑ   โ โ 2.3 GB  โ 1.8 GB                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                    ุงูุนุฏุงุฏุงุช ุงููุชุตูุฉ ุจูุฐู ุงูููุทุฉ                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุนุฏุงุฏ         โ ุงูุนููู        โ ุงูุฅุดุงุฑุฉ  โ ุงูุฌูุฏุฉ   โ ุขุฎุฑ ุงุชุตุงู   โ   โ
โ  โโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโโโค   โ
โ  โ ADL200-001234   โ ุฃุญูุฏ ูุญูุฏ    โ -42 dBm  โ ๐ข ููุชุงุฒ โ ููุฐ 2 ุฏูููุฉ โ   โ
โ  โ ADL200-001235   โ ุฎุงูุฏ ุนูู     โ -58 dBm  โ ๐ก ุฌูุฏ   โ ููุฐ 5 ุฏูุงุฆู โ   โ
โ  โ ADL200-001236   โ ุณุนูุฏ ุฃุญูุฏ    โ -71 dBm  โ ๐ ููุจูู โ ููุฐ 3 ุฏูุงุฆู โ   โ
โ  โ ...             โ ...          โ ...      โ ...      โ ...         โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุฑุณู ุจูุงูู ููุฃุฏุงุก (24 ุณุงุนุฉ)                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ุงูุนุฏุงุฏุงุช ุงููุชุตูุฉ:                                                         โ
โ  160โ     โญโโโโโโโฎ                    โญโโโโโโโโโโโโโโโโโโฎ                  โ
โ  140โโโโโโโฏ      โฐโโโโโโโโโโโโโโโโโโโโโฏ                 โฐโโโโโโ            โ
โ  120โ                                                                      โ
โ     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ     โ
โ      00:00    04:00    08:00    12:00    16:00    20:00    ุงูุขู            โ
โ                                                                             โ
โ            [๐ ุชูุฑูุฑ ููุตู]    [๐ง ุตูุงูุฉ]    [โ๏ธ ุฅุนุฏุงุฏุงุช]                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 10.8 Trigger: ุฅูุดุงุก ุฃูุฑ ุนูู ุนูุฏ ุงููุทุงุน ููุทุฉ ุงููุตูู

```sql
CREATE OR REPLACE FUNCTION on_ap_offline()
RETURNS TRIGGER AS $$
DECLARE
    v_offline_duration INTERVAL;
    v_station_id UUID;
BEGIN
    -- ุงูุชุญูู ูู ุงูุงูุชูุงู ูุญุงูุฉ offline
    IF NEW.status = 'offline' AND OLD.status != 'offline' THEN
        
        -- ุฌูุจ ูุนุฑู ุงููุญุทุฉ
        SELECT station_id INTO v_station_id FROM access_points WHERE id = NEW.id;
        
        -- ุฅูุดุงุก ุฃูุฑ ุนูู ุตูุงูุฉ ุชููุงุฆู
        INSERT INTO field_operations (
            station_id,
            operation_type,
            priority,
            title,
            description,
            reference_type,
            reference_id,
            status
        ) VALUES (
            v_station_id,
            'maintenance',
            'high',
            'ุตูุงูุฉ ููุทุฉ ูุตูู ูุนุทูุฉ: ' || (SELECT ap_name FROM access_points WHERE id = NEW.id),
            'ุงููุทุน ุงูุงุชุตุงู ุจููุทุฉ ุงููุตูู. ุขุฎุฑ ุงุชุตุงู: ' || NEW.last_seen_at,
            'access_point',
            NEW.id,
            'scheduled'
        );
        
        -- ุฅุฑุณุงู ุชูุจูู
        INSERT INTO system_alerts (
            station_id,
            alert_type,
            severity,
            title,
            message,
            reference_type,
            reference_id
        ) VALUES (
            v_station_id,
            'network_outage',
            'high',
            'ุงููุทุงุน ููุทุฉ ูุตูู',
            'ููุทุฉ ุงููุตูู ' || (SELECT ap_code FROM access_points WHERE id = NEW.id) || ' ุบูุฑ ูุชุตูุฉ',
            'access_point',
            NEW.id
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_ap_offline
AFTER UPDATE ON access_points
FOR EACH ROW
EXECUTE FUNCTION on_ap_offline();
```

## 10.9 Function: ุชุญุฏูุซ ุญุงูุฉ ููุงุท ุงููุตูู

```sql
CREATE OR REPLACE FUNCTION update_ap_status()
RETURNS void AS $$
BEGIN
    -- ุชุญุฏูุซ ููุงุท ุงููุตูู ุงูุชู ูู ุชุฑุณู heartbeat ููุฐ 5 ุฏูุงุฆู
    UPDATE access_points
    SET status = 'offline',
        updated_at = NOW()
    WHERE status = 'active'
      AND last_seen_at < NOW() - INTERVAL '5 minutes';
    
    -- ุชุญุฏูุซ ููุงุท ุงููุตูู ุงูุชู ุนุงุฏุช ููุงุชุตุงู
    UPDATE access_points
    SET status = 'active',
        updated_at = NOW()
    WHERE status = 'offline'
      AND last_seen_at >= NOW() - INTERVAL '5 minutes';
END;
$$ LANGUAGE plpgsql;

-- ุชุดุบูู ูู ุฏูููุฉ ุนุจุฑ pg_cron
-- SELECT cron.schedule('update-ap-status', '* * * * *', 'SELECT update_ap_status()');
```

## 10.10 View: ููุฎุต ุตุญุฉ ุงูุดุจูุฉ

```sql
CREATE OR REPLACE VIEW v_network_health_summary AS
SELECT 
    s.id AS station_id,
    s.name AS station_name,
    COUNT(ap.id) AS total_aps,
    COUNT(CASE WHEN ap.status = 'active' THEN 1 END) AS active_aps,
    COUNT(CASE WHEN ap.status = 'offline' THEN 1 END) AS offline_aps,
    COUNT(mac.id) AS total_connected_meters,
    AVG(mac.signal_strength_dbm) AS avg_signal_strength,
    COUNT(CASE WHEN mac.connection_quality = 'excellent' THEN 1 END) AS excellent_connections,
    COUNT(CASE WHEN mac.connection_quality = 'good' THEN 1 END) AS good_connections,
    COUNT(CASE WHEN mac.connection_quality = 'poor' THEN 1 END) AS poor_connections,
    ROUND(
        COUNT(CASE WHEN ap.status = 'active' THEN 1 END)::DECIMAL / 
        NULLIF(COUNT(ap.id), 0) * 100, 2
    ) AS network_availability_percent
FROM stations s
LEFT JOIN access_points ap ON ap.station_id = s.id
LEFT JOIN meter_ap_connections mac ON mac.ap_id = ap.id
GROUP BY s.id, s.name;
```

## 10.11 ุฃุตูุงู ุดุจูุฉ ุงูุงุชุตุงูุงุช ูู ุงููุฎุฒูู

| ุงูุตูู | ุงููุตู | ููุน ุงูุชุชุจุน |
|-------|-------|-----------|
| ููุทุฉ ูุตูู ุฎุงุฑุฌูุฉ | Outdoor Access Point | ุจุงูุฑูู ุงูุชุณูุณูู |
| ููุทุฉ ูุตูู ุฏุงุฎููุฉ | Indoor Access Point | ุจุงูุฑูู ุงูุชุณูุณูู |
| ููุฑุฑ ุฅุดุงุฑุฉ | Repeater | ุจุงูุฑูู ุงูุชุณูุณูู |
| ููุงุฆู Backhaul | Point-to-Point Antenna | ุจุงูุฑูู ุงูุชุณูุณูู |
| ูุงุจู ุดุจูุฉ ุฎุงุฑุฌู | Outdoor Ethernet Cable | ุจุงููููุฉ (ูุชุฑ) |
| ุตูุฏูู ุชูุตูู ุฎุงุฑุฌู | Outdoor Junction Box | ุจุงููููุฉ |

## 10.12 APIs ุฅุฏุงุฑุฉ ุดุจูุฉ ุงูุงุชุตุงูุงุช

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/network/access-points` | ูุงุฆูุฉ ููุงุท ุงููุตูู |
| GET | `/api/v1/network/access-points/:id` | ุชูุงุตูู ููุทุฉ ูุตูู |
| POST | `/api/v1/network/access-points` | ุฅุถุงูุฉ ููุทุฉ ูุตูู |
| PUT | `/api/v1/network/access-points/:id` | ุชุญุฏูุซ ููุทุฉ ูุตูู |
| GET | `/api/v1/network/access-points/:id/meters` | ุงูุนุฏุงุฏุงุช ุงููุชุตูุฉ |
| GET | `/api/v1/network/access-points/:id/monitoring` | ุจูุงูุงุช ุงููุฑุงูุจุฉ |
| GET | `/api/v1/network/health` | ููุฎุต ุตุญุฉ ุงูุดุจูุฉ |
| POST | `/api/v1/network/surveys` | ุฅูุดุงุก ูุดุฑูุน ูุณุญ |
| GET | `/api/v1/network/coverage-map` | ุฎุฑูุทุฉ ุงูุชุบุทูุฉ |


---

# 11. ูุญุฏุฉ ุงููุฑุงูุจุฉ ุจุงูููุฏูู ุงููุชูุงููุฉ (Video Surveillance Module)

## 11.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุฏูุฌ ุจุซ ุงูููุฏูู ุงููุจุงุดุฑ ูุงููุณุฌู ูู ุงููุงููุฑุงุช ุงูุฃูููุฉ ูุงูุชุดุบูููุฉ ูู ููุญุฉ ุงูุชุญูู ุงูุฌุบุฑุงููุฉ ุงูููุญุฏุฉุ ูุน ุฑุจุทูุง ุจุงูุฃุตูู ูุงูููุงูุน.

### ุงูุจููุฉ ุงููุนูุงุฑูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ูุธุงููุง (Business Layer)                              โ
โ                     ููุญุฉ ุงูุชุญูู ุงูุฌุบุฑุงููุฉ ุงูููุญุฏุฉ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                              API Integration
                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ูุธุงู ุฅุฏุงุฑุฉ ุงูููุฏูู (VMS)                                 โ
โ              (Milestone / Genetec / Frigate / ZoneMinder)                   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ       โ
โ  โ  ุงูุชุณุฌูู   โ  โ  ุงูุจุซ      โ  โ  ุงูุชุดุงู    โ  โ  ุงูุฃุฑุดูุฉ   โ       โ
โ  โ  Recording โ  โ  Streaming โ  โ  ุงูุญุฑูุฉ    โ  โ  Archive   โ       โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                          RTSP / WebRTC / ONVIF
                                    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โผ                           โผ                           โผ
โโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโ
โ   ูุงููุฑุง 1   โ          โ   ูุงููุฑุง 2   โ          โ   ูุงููุฑุง N   โ
โ  (ุงููููุฏ G1) โ          โ  (ุงูุจูุงุจุฉ)   โ          โ  (ุงููุญูู T1) โ
โโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโ
```

## 11.2 ุฌุฏูู ุงููุงููุฑุงุช (cameras)

```sql
CREATE TABLE cameras (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงููุงููุฑุง
    camera_code VARCHAR(50) UNIQUE NOT NULL,
    camera_name VARCHAR(200) NOT NULL,
    camera_type ENUM(
        'fixed',              -- ุซุงุจุชุฉ
        'ptz',                -- ูุชุญุฑูุฉ PTZ
        'dome',               -- ูุจุฉ
        'bullet',             -- ุฃุณุทูุงููุฉ
        'thermal'             -- ุญุฑุงุฑูุฉ
    ) NOT NULL,
    
    -- ูุนูููุงุช ุงูุฌูุงุฒ
    brand VARCHAR(100),
    model VARCHAR(100),
    serial_number VARCHAR(100),
    mac_address VARCHAR(17),
    ip_address VARCHAR(45),
    
    -- ุฅุนุฏุงุฏุงุช ุงูุจุซ
    rtsp_url VARCHAR(500),
    rtsp_port INT DEFAULT 554,
    username VARCHAR(100),
    password_encrypted VARCHAR(500),
    
    -- ุงููููุน ุงูุฌุบุฑุงูู
    location_name VARCHAR(200),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    viewing_angle INT,                    -- ุฒุงููุฉ ุงูุฑุคูุฉ ุจุงูุฏุฑุฌุงุช
    viewing_direction INT,                -- ุงุชุฌุงู ุงูุฑุคูุฉ (0-360)
    
    -- ุงูุฑุจุท ุจุงูุฃุตู ุงูููุฑุงููุจ
    monitored_asset_type VARCHAR(50),     -- generator, transformer, gate, etc.
    monitored_asset_id UUID,
    
    -- ุงูุฑุจุท ุจููุทุฉ ุงููุตูู
    access_point_id UUID REFERENCES access_points(id),
    
    -- ุฅุนุฏุงุฏุงุช VMS
    vms_camera_id VARCHAR(100),           -- ูุนุฑู ุงููุงููุฑุง ูู ูุธุงู VMS
    recording_enabled BOOLEAN DEFAULT true,
    motion_detection_enabled BOOLEAN DEFAULT true,
    retention_days INT DEFAULT 30,
    
    -- ุงูุญุงูุฉ
    status ENUM('online', 'offline', 'maintenance', 'disabled') DEFAULT 'online',
    last_seen_at TIMESTAMP,
    
    -- ุงูุชุฑููุจ
    installation_date DATE,
    installed_by UUID REFERENCES users(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_cameras_station ON cameras(station_id);
CREATE INDEX idx_cameras_status ON cameras(status);
CREATE INDEX idx_cameras_asset ON cameras(monitored_asset_type, monitored_asset_id);
CREATE INDEX idx_cameras_location ON cameras USING GIST (
    ST_SetSRID(ST_MakePoint(longitude, latitude), 4326)
);
```

## 11.3 ุฌุฏูู ุฃุญุฏุงุซ ุงูููุฏูู (video_events)

```sql
CREATE TABLE video_events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    camera_id UUID NOT NULL REFERENCES cameras(id),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ููุน ุงูุญุฏุซ
    event_type ENUM(
        'motion_detected',        -- ุงูุชุดุงู ุญุฑูุฉ
        'door_opened',            -- ูุชุญ ุจุงุจ
        'door_closed',            -- ุฅุบูุงู ุจุงุจ
        'intrusion_alert',        -- ุชูุจูู ุงูุชุญุงู
        'equipment_alarm',        -- ุฅูุฐุงุฑ ูุนุฏุงุช
        'manual_bookmark'         -- ุนูุงูุฉ ูุฏููุฉ
    ) NOT NULL,
    
    -- ุงูุชูุงุตูู
    event_description TEXT,
    severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',
    
    -- ุงูุฑุจุท ุจุงูุฃุตู
    related_asset_type VARCHAR(50),
    related_asset_id UUID,
    
    -- ูุนูููุงุช ุงูุชุณุฌูู
    event_timestamp TIMESTAMP NOT NULL,
    video_clip_start TIMESTAMP,
    video_clip_end TIMESTAMP,
    video_clip_url VARCHAR(500),
    thumbnail_url VARCHAR(500),
    
    -- ุงููุนุงูุฌุฉ
    is_acknowledged BOOLEAN DEFAULT false,
    acknowledged_by UUID REFERENCES users(id),
    acknowledged_at TIMESTAMP,
    notes TEXT,
    
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_video_events_camera ON video_events(camera_id);
CREATE INDEX idx_video_events_time ON video_events(event_timestamp);
CREATE INDEX idx_video_events_type ON video_events(event_type);
CREATE INDEX idx_video_events_severity ON video_events(severity);
```

## 11.4 ุฌุฏูู ุญุณุงุณุงุช ุงูุฃุจูุงุจ (door_sensors)

```sql
CREATE TABLE door_sensors (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ูุนูููุงุช ุงูุญุณุงุณ
    sensor_code VARCHAR(50) UNIQUE NOT NULL,
    sensor_name VARCHAR(200) NOT NULL,
    location_description VARCHAR(200),
    
    -- ุงูุฑุจุท ุจุงููุงููุฑุง
    linked_camera_id UUID REFERENCES cameras(id),
    
    -- ุงูุฑุจุท ุจุงูุฃุตู
    monitored_asset_type VARCHAR(50),
    monitored_asset_id UUID,
    
    -- ุงูุญุงูุฉ
    current_state ENUM('open', 'closed', 'unknown') DEFAULT 'unknown',
    last_state_change TIMESTAMP,
    status ENUM('active', 'inactive', 'faulty') DEFAULT 'active',
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Trigger: ุชุณุฌูู ุญุฏุซ ููุฏูู ุนูุฏ ูุชุญ ุงูุจุงุจ
CREATE OR REPLACE FUNCTION on_door_state_change()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.current_state = 'open' AND OLD.current_state = 'closed' THEN
        -- ุฅูุดุงุก ุญุฏุซ ููุฏูู
        INSERT INTO video_events (
            camera_id,
            station_id,
            event_type,
            event_description,
            related_asset_type,
            related_asset_id,
            event_timestamp,
            video_clip_start,
            video_clip_end
        )
        SELECT 
            NEW.linked_camera_id,
            NEW.station_id,
            'door_opened',
            'ุชู ูุชุญ ' || NEW.sensor_name,
            NEW.monitored_asset_type,
            NEW.monitored_asset_id,
            NOW(),
            NOW() - INTERVAL '5 seconds',
            NOW() + INTERVAL '10 seconds'
        WHERE NEW.linked_camera_id IS NOT NULL;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_door_state_change
AFTER UPDATE ON door_sensors
FOR EACH ROW
WHEN (OLD.current_state IS DISTINCT FROM NEW.current_state)
EXECUTE FUNCTION on_door_state_change();
```

## 11.5 ุดุงุดุฉ ูุฑุงูุจุฉ ุงูููุฏูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐น ูุฑุงูุจุฉ ุงูููุฏูู ุงููุจุงุดุฑ                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                         ุดุจูุฉ ุงูุจุซ ุงููุจุงุดุฑ                           โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ                                                                     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ ๐น ุงููููุฏ G1   โ  โ ๐น ุงูุจูุงุจุฉ     โ  โ ๐น ุงููุญูู T1   โ     โ   โ
โ  โ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ โ             โโ  โ โ             โโ  โ โ             โโ     โ   โ
โ  โ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ     โ   โ
โ  โ  โ โ             โโ  โ โ             โโ  โ โ             โโ     โ   โ
โ  โ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ ๐ข ูุชุตู       โ  โ ๐ข ูุชุตู       โ  โ ๐ด ุบูุฑ ูุชุตู   โ     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โ                                                                     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ ๐น ุบุฑูุฉ ุงูุชุญูู โ  โ ๐น ุงููุฎุฒู     โ  โ ๐น ุงูุณุงุญุฉ      โ     โ   โ
โ  โ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ โ             โโ  โ โ             โโ  โ โ             โโ     โ   โ
โ  โ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ  โ โ  [ุจุซ ูุจุงุดุฑ] โโ     โ   โ
โ  โ  โ โ             โโ  โ โ             โโ  โ โ             โโ     โ   โ
โ  โ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ  โ โโโโโโโโโโโโโโโโ     โ   โ
โ  โ  โ ๐ข ูุชุตู       โ  โ ๐ข ูุชุตู       โ  โ ๐ข ูุชุตู       โ     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโ     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุงูุฃุญุฏุงุซ ุงูุฃุฎูุฑุฉ                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุช      โ ุงููุงููุฑุง    โ ุงูุญุฏุซ              โ ุงูุฎุทูุฑุฉ โ ุงูุญุงูุฉ   โ   โ
โ  โโโโโโโโโโโโโโผโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโค   โ
โ  โ 10:45:23   โ ุงูุจูุงุจุฉ    โ ๐ช ูุชุญ ุจุงุจ        โ ๐ก ูุชูุณุทโ โณ ุฌุฏูุฏ  โ   โ
โ  โ 10:32:15   โ ุงููููุฏ G1  โ ๐ ุงูุชุดุงู ุญุฑูุฉ   โ ๐ข ููุฎูุถโ โ ูุคูุฏ  โ   โ
โ  โ 09:58:41   โ ุงููุฎุฒู     โ ๐ช ูุชุญ ุจุงุจ        โ ๐ก ูุชูุณุทโ โ ูุคูุฏ  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  [๐ ุจุญุซ ูู ุงูุชุณุฌููุงุช]  [๐ ุชูุฑูุฑ ุงูุฃุญุฏุงุซ]  [โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุงููุฑุงุช]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 11.6 ูุงูุฐุฉ ุชูุงุตูู ุงูุฃุตู ูุน ุงูููุฏูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     โก ุชูุงุตูู ุงููููุฏ: G1 - Caterpillar 500kVA              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุจูุงูุงุช ุงูุญูุฉ                  โ ุงูุจุซ ุงููุจุงุดุฑ                      โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ                                 โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ ุงูุญุงูุฉ: ๐ข ูุนูู                โ โ                             โ   โ   โ
โ  โ ุงูุญูู: 320 kW (64%)            โ โ                             โ   โ   โ
โ  โ ุงูุฌูุฏ: 380V                    โ โ      [ุจุซ ูุจุงุดุฑ ูู          โ   โ   โ
โ  โ ุงูุชูุงุฑ: 486A                   โ โ       ูุงููุฑุง ุงููููุฏ]        โ   โ   โ
โ  โ ุงูุชุฑุฏุฏ: 50.1 Hz                โ โ                             โ   โ   โ
โ  โ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: 78ยฐC             โ โ                             โ   โ   โ
โ  โ ุณุงุนุงุช ุงูุชุดุบูู: 12,450          โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ                                 โ                                   โ   โ
โ  โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ ๐น ูุงููุฑุง: CAM-G1-001            โ   โ
โ  โ ุขุฎุฑ ุตูุงูุฉ: 2024-11-15          โ ๐ข ูุชุตู | ุฌูุฏุฉ: HD               โ   โ
โ  โ ุงูุตูุงูุฉ ุงููุงุฏูุฉ: 2025-01-15    โ                                   โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุฃุญุฏุงุซ ุงูููุฏูู ุงููุฑุชุจุทุฉ                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ๐น 10:32 - ุงูุชุดุงู ุญุฑูุฉ [โถ๏ธ ุชุดุบูู ุงูููุทุน]                           โ   โ
โ  โ ๐น 09:15 - ูุชุญ ุจุงุจ ุบุฑูุฉ ุงููููุฏ [โถ๏ธ ุชุดุบูู ุงูููุทุน]                   โ   โ
โ  โ ๐น ุฃูุณ 16:45 - ุฒูุงุฑุฉ ุตูุงูุฉ [โถ๏ธ ุชุดุบูู ุงูููุทุน]                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ      [๐ง ุตูุงูุฉ]   [๐ ุณุฌู ุงูุฃุญุฏุงุซ]   [๐ฌ ุฃุฑุดูู ุงูููุฏูู]   [โ๏ธ ุฅุนุฏุงุฏุงุช]   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 11.7 APIs ุงููุฑุงูุจุฉ ุจุงูููุฏูู

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/cameras` | ูุงุฆูุฉ ุงููุงููุฑุงุช |
| GET | `/api/v1/cameras/:id` | ุชูุงุตูู ูุงููุฑุง |
| GET | `/api/v1/cameras/:id/stream` | ุฑุงุจุท ุงูุจุซ ุงููุจุงุดุฑ |
| GET | `/api/v1/cameras/:id/events` | ุฃุญุฏุงุซ ุงููุงููุฑุง |
| GET | `/api/v1/video-events` | ุฌููุน ุฃุญุฏุงุซ ุงูููุฏูู |
| POST | `/api/v1/video-events/:id/acknowledge` | ุชุฃููุฏ ุญุฏุซ |
| GET | `/api/v1/assets/:type/:id/cameras` | ูุงููุฑุงุช ุงูุฃุตู |
| GET | `/api/v1/assets/:type/:id/video-events` | ุฃุญุฏุงุซ ููุฏูู ุงูุฃุตู |


---

# 12. ุจูุงุจุฉ ุงูุฃูุงูุฑ ุงูุขููุฉ (Secure Command Gateway)

## 12.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุชูููุฑ ุทุจูุฉ ุฃูุงู ููุชุญูู ุนู ุจุนุฏ ูู ุงููุนุฏุงุช ุงูุญูููุฉ (ุงููููุฏุงุชุ ุงูููุงุทุน) ูุน ุณุฌู ุชุฏููู ูุงูู.

### ูุจุงุฏุฆ ุงูุชุตููู

1. **Whitelist Only:** ููุท ุงูุฃูุงูุฑ ุงููุนุฑููุฉ ูุณุจูุงู ูุณููุญุฉ
2. **Role-Based Access:** ุตูุงุญูุงุช ุญุณุจ ุงูุฏูุฑ
3. **Dual Confirmation:** ุชุฃููุฏ ูุฒุฏูุฌ ููุฃูุงูุฑ ุงูุญุฑุฌุฉ
4. **Full Audit Trail:** ุณุฌู ุบูุฑ ูุงุจู ููุชุนุฏูู

### ุงูุจููุฉ ุงููุนูุงุฑูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ูุงุฌูุฉ ุงููุณุชุฎุฏู (UI)                                  โ
โ                    ุฃุฒุฑุงุฑ ุงูุชุญูู ูู ููุญุฉ ุงููุฑุงูุจุฉ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                            [1] ุทูุจ ุฃูุฑ
                                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุจูุงุจุฉ ุงูุฃูุงูุฑ ุงูุขููุฉ (Command Gateway)                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ [2] ุงูุชุญูู ูู ุงูุตูุงุญูุฉ                                              โ   โ
โ  โ     - ูู ุงููุณุชุฎุฏู ูุฏูู ุตูุงุญูุฉ ูุฐุง ุงูุฃูุฑุ                            โ   โ
โ  โ     - ูู ุงูุฃูุฑ ูู ุงููุงุฆูุฉ ุงูุจูุถุงุกุ                                  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                    โ                                        โ
โ                            [3] ุทูุจ ุชุฃููุฏ                                   โ
โ                                    โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ [4] ุงูุชุฃููุฏ ุงููุฒุฏูุฌ                                                 โ   โ
โ  โ     - ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ                                             โ   โ
โ  โ     - ุฃู ุฑูุฒ OTP                                                    โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                    โ                                        โ
โ                            [5] ุชุณุฌูู ุงูุฃูุฑ                                 โ
โ                                    โผ                                        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ [6] ุณุฌู ุงูุชุฏููู (Audit Log)                                         โ   โ
โ  โ     - ููุ ูุงุฐุงุ ูุชูุ ููุงุฐุงุ ุงููุชูุฌุฉุ                               โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
                            [7] ุชูููุฐ ุงูุฃูุฑ
                                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุฃูุธูุฉ ุงูุชุญูู ุงูุตูุงุนู                                     โ
โ         DeepSea DSE7320    โ    ComAp InteliGen    โ    Acrel IoT          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.2 ุฌุฏูู ุงูุฃูุงูุฑ ุงููุณููุญุฉ (allowed_commands)

```sql
CREATE TABLE allowed_commands (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุชุนุฑูู ุงูุฃูุฑ
    command_code VARCHAR(50) UNIQUE NOT NULL,
    command_name_ar VARCHAR(200) NOT NULL,
    command_name_en VARCHAR(200) NOT NULL,
    description TEXT,
    
    -- ููุน ุงููุนุฏุงุช
    equipment_type ENUM(
        'generator',          -- ูููุฏ
        'transformer',        -- ูุญูู
        'breaker',            -- ูุงุทุน
        'meter',              -- ุนุฏุงุฏ
        'relay'               -- ูุฑุญู
    ) NOT NULL,
    
    -- ูุณุชูู ุงูุฎุทูุฑุฉ
    risk_level ENUM('low', 'medium', 'high', 'critical') NOT NULL,
    
    -- ูุชุทูุจุงุช ุงูุชุฃููุฏ
    requires_password BOOLEAN DEFAULT true,
    requires_otp BOOLEAN DEFAULT false,
    requires_supervisor_approval BOOLEAN DEFAULT false,
    
    -- ุงูุตูุงุญูุฉ ุงููุทููุจุฉ
    required_permission VARCHAR(100) NOT NULL,
    
    -- ุงูุญุงูุฉ
    is_active BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- ุงูุฃูุงูุฑ ุงูุงูุชุฑุงุถูุฉ (Whitelist)
INSERT INTO allowed_commands (command_code, command_name_ar, command_name_en, equipment_type, risk_level, required_permission, requires_otp) VALUES
-- ุฃูุงูุฑ ุงููููุฏุงุช
('START_GENERATOR', 'ุชุดุบูู ุงููููุฏ', 'Start Generator', 'generator', 'high', 'control_generators', true),
('STOP_GENERATOR', 'ุฅููุงู ุงููููุฏ', 'Stop Generator', 'generator', 'high', 'control_generators', true),
('CHANGE_MODE_AUTO', 'ุชุบููุฑ ุงููุถุน ุฅูู ุชููุงุฆู', 'Change Mode to Auto', 'generator', 'medium', 'control_generators', false),
('CHANGE_MODE_MANUAL', 'ุชุบููุฑ ุงููุถุน ุฅูู ูุฏูู', 'Change Mode to Manual', 'generator', 'medium', 'control_generators', false),
('RESET_ALARM', 'ุฅุนุงุฏุฉ ุชุนููู ุงูุฅูุฐุงุฑ', 'Reset Alarm', 'generator', 'low', 'control_generators', false),

-- ุฃูุงูุฑ ุงูููุงุทุน
('OPEN_BREAKER', 'ูุชุญ ุงููุงุทุน', 'Open Breaker', 'breaker', 'high', 'control_breakers', true),
('CLOSE_BREAKER', 'ุฅุบูุงู ุงููุงุทุน', 'Close Breaker', 'breaker', 'high', 'control_breakers', true),

-- ุฃูุงูุฑ ุงูุนุฏุงุฏุงุช
('DISCONNECT_METER', 'ูุตู ุงูุนุฏุงุฏ', 'Disconnect Meter', 'meter', 'medium', 'control_meters', false),
('RECONNECT_METER', 'ุฅุนุงุฏุฉ ุชูุตูู ุงูุนุฏุงุฏ', 'Reconnect Meter', 'meter', 'medium', 'control_meters', false);
```

## 12.3 ุฌุฏูู ุณุฌู ุชุฏููู ุงูุฃูุงูุฑ (command_audit_log)

```sql
CREATE TABLE command_audit_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ูุนูููุงุช ุงูุฃูุฑ
    command_code VARCHAR(50) NOT NULL,
    command_id UUID REFERENCES allowed_commands(id),
    
    -- ุงููุนุฏุงุช ุงููุณุชูุฏูุฉ
    target_equipment_type VARCHAR(50) NOT NULL,
    target_equipment_id UUID NOT NULL,
    target_equipment_name VARCHAR(200),
    
    -- ุงููุณุชุฎุฏู
    executed_by UUID NOT NULL REFERENCES users(id),
    executed_by_name VARCHAR(200) NOT NULL,
    executed_by_role VARCHAR(100),
    
    -- ุงููุญุทุฉ
    station_id UUID NOT NULL REFERENCES stations(id),
    
    -- ุงูุชุฃููุฏ
    confirmation_method ENUM('password', 'otp', 'supervisor', 'none') NOT NULL,
    supervisor_id UUID REFERENCES users(id),
    
    -- ุงูุณุจุจ
    reason TEXT,
    
    -- ุงูุชูููุช
    requested_at TIMESTAMP NOT NULL DEFAULT NOW(),
    executed_at TIMESTAMP,
    
    -- ุงููุชูุฌุฉ
    status ENUM('pending', 'executing', 'success', 'failed', 'rejected', 'timeout') NOT NULL DEFAULT 'pending',
    result_message TEXT,
    error_code VARCHAR(50),
    
    -- ูุนูููุงุช ุฅุถุงููุฉ
    ip_address VARCHAR(45),
    user_agent TEXT,
    
    -- ูุง ูููู ุชุนุฏูู ูุฐุง ุงูุณุฌู
    created_at TIMESTAMP NOT NULL DEFAULT NOW()
    
    -- ูุง ููุฌุฏ updated_at ูุฃู ุงูุณุฌู ุบูุฑ ูุงุจู ููุชุนุฏูู
);

-- ููุงุฑุณ ููุจุญุซ ุงูุณุฑูุน
CREATE INDEX idx_command_audit_user ON command_audit_log(executed_by);
CREATE INDEX idx_command_audit_station ON command_audit_log(station_id);
CREATE INDEX idx_command_audit_time ON command_audit_log(requested_at);
CREATE INDEX idx_command_audit_equipment ON command_audit_log(target_equipment_type, target_equipment_id);
CREATE INDEX idx_command_audit_status ON command_audit_log(status);

-- ููุน ุงูุชุนุฏูู ูุงูุญุฐู
CREATE OR REPLACE FUNCTION prevent_audit_modification()
RETURNS TRIGGER AS $$
BEGIN
    RAISE EXCEPTION 'ุณุฌู ุงูุชุฏููู ุบูุฑ ูุงุจู ููุชุนุฏูู ุฃู ุงูุญุฐู';
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_prevent_audit_update
BEFORE UPDATE ON command_audit_log
FOR EACH ROW
EXECUTE FUNCTION prevent_audit_modification();

CREATE TRIGGER trg_prevent_audit_delete
BEFORE DELETE ON command_audit_log
FOR EACH ROW
EXECUTE FUNCTION prevent_audit_modification();
```

## 12.4 ุฌุฏูู ุตูุงุญูุงุช ุงูุชุญูู (control_permissions)

```sql
CREATE TABLE control_permissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    permission_code VARCHAR(100) UNIQUE NOT NULL,
    permission_name_ar VARCHAR(200) NOT NULL,
    permission_name_en VARCHAR(200) NOT NULL,
    description TEXT,
    
    -- ุงููุฌููุนุฉ
    permission_group VARCHAR(50) NOT NULL,
    
    created_at TIMESTAMP DEFAULT NOW()
);

-- ุตูุงุญูุงุช ุงูุชุญูู
INSERT INTO control_permissions (permission_code, permission_name_ar, permission_name_en, permission_group) VALUES
('control_generators', 'ุงูุชุญูู ูู ุงููููุฏุงุช', 'Control Generators', 'equipment_control'),
('control_breakers', 'ุงูุชุญูู ูู ุงูููุงุทุน', 'Control Breakers', 'equipment_control'),
('control_meters', 'ุงูุชุญูู ูู ุงูุนุฏุงุฏุงุช', 'Control Meters', 'equipment_control'),
('view_cameras', 'ุนุฑุถ ุงููุงููุฑุงุช', 'View Cameras', 'surveillance'),
('control_cameras', 'ุงูุชุญูู ูู ุงููุงููุฑุงุช PTZ', 'Control PTZ Cameras', 'surveillance'),
('view_audit_log', 'ุนุฑุถ ุณุฌู ุงูุชุฏููู', 'View Audit Log', 'audit'),
('export_audit_log', 'ุชุตุฏูุฑ ุณุฌู ุงูุชุฏููู', 'Export Audit Log', 'audit');
```

## 12.5 ุดุงุดุฉ ุงูุชุญูู ูู ุงููููุฏ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     โก ุงูุชุญูู ูู ุงููููุฏ: G1 - Caterpillar 500kVA           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                         ุงูุจูุงูุงุช ุงูุญูุฉ                              โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ  ุงูุญุงูุฉ: ๐ข ูุนูู     โ  ุงููุถุน: โ๏ธ ุชููุงุฆู    โ  ุงูุญูู: 320 kW      โ   โ
โ  โ  ุงูุฌูุฏ: 380V         โ  ุงูุชูุงุฑ: 486A        โ  ุงูุชุฑุฏุฏ: 50.1 Hz    โ   โ
โ  โ  ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: 78ยฐC  โ  ุถุบุท ุงูุฒูุช: 4.2 bar  โ  ูุณุชูู ุงููููุฏ: 75%  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุฃูุงูุฑ ุงูุชุญูู                                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                     โ   โ
โ  โ   โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ      โ   โ
โ  โ   โ               โ    โ               โ    โ               โ      โ   โ
โ  โ   โ   ๐ข ุชุดุบูู   โ    โ   ๐ด ุฅููุงู   โ    โ ๐ ุฅุนุงุฏุฉ     โ      โ   โ
โ  โ   โ   START      โ    โ   STOP       โ    โ   ุชุนููู      โ      โ   โ
โ  โ   โ               โ    โ               โ    โ               โ      โ   โ
โ  โ   โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ      โ   โ
โ  โ                                                                     โ   โ
โ  โ   โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ                           โ   โ
โ  โ   โ               โ    โ               โ                           โ   โ
โ  โ   โ  โ๏ธ ุชููุงุฆู   โ    โ  ๐ง ูุฏูู     โ                           โ   โ
โ  โ   โ   AUTO       โ    โ   MANUAL     โ                           โ   โ
โ  โ   โ               โ    โ               โ                           โ   โ
โ  โ   โโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโ                           โ   โ
โ  โ                                                                     โ   โ
โ  โ  โ๏ธ ุงูุฃูุงูุฑ ุงูุญุฑุฌุฉ ุชุชุทูุจ ุชุฃููุฏ ุฅุถุงูู                               โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุขุฎุฑ ุงูุฃูุงูุฑ ุงููููุฐุฉ                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุช      โ ุงูุฃูุฑ         โ ุงููููุฐ        โ ุงููุชูุฌุฉ              โ   โ
โ  โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 10:30:15   โ ุชุบููุฑ โ ุชููุงุฆูโ ุฃุญูุฏ ูุญูุฏ    โ โ ูุฌุญ               โ   โ
โ  โ 08:15:22   โ ุชุดุบูู         โ ูุญูุฏ ุนูู     โ โ ูุฌุญ               โ   โ
โ  โ ุฃูุณ 22:00  โ ุฅููุงู         โ ุฎุงูุฏ ุฃุญูุฏ    โ โ ูุฌุญ               โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ                              [๐ ุณุฌู ุงูุชุฏููู ุงููุงูู]                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.6 ูุงูุฐุฉ ุชุฃููุฏ ุงูุฃูุฑ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         โ๏ธ ุชุฃููุฏ ุชูููุฐ ุงูุฃูุฑ                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                     โ   โ
โ  โ  ุงูุฃูุฑ: ๐ด ุฅููุงู ุงููููุฏ (STOP_GENERATOR)                           โ   โ
โ  โ  ุงููุนุฏุงุช: G1 - Caterpillar 500kVA                                  โ   โ
โ  โ  ูุณุชูู ุงูุฎุทูุฑุฉ: ๐ด ุนุงูู                                            โ   โ
โ  โ                                                                     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                                                                     โ   โ
โ  โ  ุณุจุจ ุชูููุฐ ุงูุฃูุฑ (ุงุฎุชูุงุฑู):                                        โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  โ ุตูุงูุฉ ูุฌุฏููุฉ                                                โ   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ                                                                     โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ   โ
โ  โ                                                                     โ   โ
โ  โ  ๐ ุฃุฏุฎู ุฑูุฒ ุงูุชุฃููุฏ (OTP):                                        โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  โ [  ] [  ] [  ] [  ] [  ] [  ]                               โ   โ   โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   โ
โ  โ  ๐ฑ ุชู ุฅุฑุณุงู ุงูุฑูุฒ ุฅูู ูุงุชูู: ***1234                              โ   โ
โ  โ                                                                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ              [โ ุฅูุบุงุก]                    [โ ุชุฃููุฏ ูุชูููุฐ]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.7 ุดุงุดุฉ ุณุฌู ุงูุชุฏููู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     ๐ ุณุฌู ุชุฏููู ุฃูุงูุฑ ุงูุชุญูู                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุงููุชุฑุฉ: [ูู: 01/12/2024] [ุฅูู: 16/12/2024]  ุงููุญุทุฉ: [ุฌููุน ุงููุญุทุงุช โผ]     โ
โ  ุงููุนุฏุงุช: [ุฌููุน ุงููุนุฏุงุช โผ]  ุงููุณุชุฎุฏู: [ุฌููุน ุงููุณุชุฎุฏููู โผ]  [๐ ุจุญุซ]       โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูุชุงุฑูุฎ/ุงูููุช โ ุงูุฃูุฑ      โ ุงููุนุฏุงุช   โ ุงููููุฐ    โ ุงููุชูุฌุฉโ ุงูุชูุงุตููโ  โ
โ  โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโผโโโโโโโโโโค  โ
โ  โ 16/12 10:30  โ STOP       โ G1        โ ุฃุญูุฏ ู.  โ โ ูุฌุญ โ [๐๏ธ]    โ  โ
โ  โ 16/12 08:15  โ START      โ G1        โ ูุญูุฏ ุน.  โ โ ูุฌุญ โ [๐๏ธ]    โ  โ
โ  โ 15/12 22:00  โ STOP       โ G2        โ ุฎุงูุฏ ุฃ.  โ โ ูุฌุญ โ [๐๏ธ]    โ  โ
โ  โ 15/12 18:30  โ AUTO       โ G1        โ ุฃุญูุฏ ู.  โ โ ูุฌุญ โ [๐๏ธ]    โ  โ
โ  โ 15/12 14:22  โ DISCONNECT โ M-1234    โ ุณุนูุฏ ุญ.  โ โ ูุฌุญ โ [๐๏ธ]    โ  โ
โ  โ 14/12 09:45  โ START      โ G3        โ ูุญูุฏ ุน.  โ โ ูุดู โ [๐๏ธ]    โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ุฅุฌูุงูู: 156 ุฃูุฑ | ูุฌุญ: 152 | ูุดู: 4                                       โ
โ                                                                             โ
โ  [๐ฅ ุชุตุฏูุฑ Excel]  [๐ฅ ุชุตุฏูุฑ PDF]  [๐จ๏ธ ุทุจุงุนุฉ]                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.8 APIs ุจูุงุจุฉ ุงูุฃูุงูุฑ

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/commands` | ูุงุฆูุฉ ุงูุฃูุงูุฑ ุงููุณููุญุฉ |
| POST | `/api/v1/commands/execute` | ุชูููุฐ ุฃูุฑ |
| POST | `/api/v1/commands/verify-otp` | ุงูุชุญูู ูู OTP |
| GET | `/api/v1/commands/audit-log` | ุณุฌู ุงูุชุฏููู |
| GET | `/api/v1/commands/audit-log/:id` | ุชูุงุตูู ุฃูุฑ |
| GET | `/api/v1/equipment/:type/:id/commands` | ุฃูุงูุฑ ูุนุฏุงุช ูุญุฏุฏุฉ |


---

# 12. ุชูุญูุฏ ูุตุงุฏุฑ ุงูุจูุงูุงุช (Unified Data Sources)

## 12.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุฏูุฌ ุงูุจูุงูุงุช ุงููุฏููุฉ ูุงูุขููุฉ ูู ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุชูููุฒ ุงููุตุฏุฑุ ูุถูุงู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุชุณูุฉ ููุณุงุฑ ุชุฑููุฉ ุณูุณ.

### ูุตุงุฏุฑ ุงูุจูุงูุงุช ุงููุฏุนููุฉ

| ุงููุตุฏุฑ | ุงูููุฏ | ุงููุตู |
|--------|-------|-------|
| ูุฏูู | `MANUAL` | ูุฑุงุกุงุช ูู ุฌููุงุช ุงููุฑุงุกุฉ ุงููุฏููุฉ |
| Acrel | `AUTOMATIC_ACREL` | ุจูุงูุงุช ูู ูุธุงู ูุฑุงูุจุฉ ุงูุทุงูุฉ |
| DeepSea | `AUTOMATIC_DEEPSEA` | ุจูุงูุงุช ูู ูุญุฏุงุช ุงูุชุญูู ุจุงููููุฏุงุช |
| ComAp | `AUTOMATIC_COMAP` | ุจูุงูุงุช ูู ูุญุฏุงุช ComAp |
| IoT Meters | `AUTOMATIC_IOT` | ุจูุงูุงุช ูู ุงูุนุฏุงุฏุงุช ุงูุฐููุฉ |
| SCADA | `AUTOMATIC_SCADA` | ุจูุงูุงุช ูู ูุธุงู SCADA |

## 12.2 ุชุญุฏูุซ ุฌุฏูู ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ

```sql
-- ุฅุถุงูุฉ ุญูู ูุตุฏุฑ ุงูุจูุงูุงุช ูุฌุฏูู ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
ALTER TABLE asset_telemetry_data 
ADD COLUMN IF NOT EXISTS data_source ENUM(
    'MANUAL',
    'AUTOMATIC_ACREL',
    'AUTOMATIC_DEEPSEA',
    'AUTOMATIC_COMAP',
    'AUTOMATIC_IOT',
    'AUTOMATIC_SCADA'
) NOT NULL DEFAULT 'MANUAL';

-- ุฅุถุงูุฉ ุญูู ุงููุณุชุฎุฏู (ูููุฑุงุกุงุช ุงููุฏููุฉ)
ALTER TABLE asset_telemetry_data 
ADD COLUMN IF NOT EXISTS recorded_by UUID REFERENCES users(id);

-- ุฅุถุงูุฉ ุญูู ูุนุฑู ุงูุฌููุฉ (ูููุฑุงุกุงุช ุงููุฏููุฉ)
ALTER TABLE asset_telemetry_data 
ADD COLUMN IF NOT EXISTS reading_round_id UUID REFERENCES scheduled_reading_rounds(id);

-- ููุฑุณ ููุจุญุซ ุญุณุจ ุงููุตุฏุฑ
CREATE INDEX idx_telemetry_data_source ON asset_telemetry_data(data_source);
```

## 12.3 ุฌุฏูู ุฅุนุฏุงุฏุงุช ูุตุฏุฑ ุงูุจูุงูุงุช ููุฃุตูู

```sql
CREATE TABLE asset_data_source_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    asset_id UUID NOT NULL REFERENCES assets(id),
    asset_type VARCHAR(50) NOT NULL,
    
    -- ูุตุฏุฑ ุงูุจูุงูุงุช ุงูุญุงูู
    current_data_source ENUM(
        'MANUAL',
        'AUTOMATIC_ACREL',
        'AUTOMATIC_DEEPSEA',
        'AUTOMATIC_COMAP',
        'AUTOMATIC_IOT',
        'AUTOMATIC_SCADA'
    ) NOT NULL DEFAULT 'MANUAL',
    
    -- ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู (ูููุตุงุฏุฑ ุงูุขููุฉ)
    connection_config JSONB,
    -- ูุซุงู: {"device_id": "GEN001", "protocol": "modbus", "address": "192.168.1.100"}
    
    -- ุญุงูุฉ ุงูุงุชุตุงู
    is_connected BOOLEAN DEFAULT false,
    last_data_received_at TIMESTAMP,
    
    -- ุชุงุฑูุฎ ุงูุชุญููู
    converted_from VARCHAR(50),           -- ุงููุตุฏุฑ ุงูุณุงุจู
    converted_at TIMESTAMP,
    converted_by UUID REFERENCES users(id),
    
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    UNIQUE(asset_id)
);

CREATE INDEX idx_asset_data_source ON asset_data_source_config(asset_id);
CREATE INDEX idx_asset_data_source_type ON asset_data_source_config(current_data_source);
```

## 12.4 Function ููู ุงููุฑุงุกุงุช ุงููุฏููุฉ ููุฌุฏูู ุงูููุญุฏ

```sql
CREATE OR REPLACE FUNCTION sync_manual_readings_to_telemetry()
RETURNS TRIGGER AS $$
BEGIN
    -- ููู ุงููุฑุงุกุงุช ุงููุฏููุฉ ูุฌุฏูู ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ ุงูููุญุฏ
    INSERT INTO asset_telemetry_data (
        asset_id,
        asset_type,
        timestamp,
        data,
        data_source,
        recorded_by,
        reading_round_id
    ) VALUES (
        NEW.asset_id,
        NEW.asset_type,
        NEW.recorded_at,
        NEW.readings,
        'MANUAL',
        NEW.recorded_by,
        NEW.round_id
    );
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_sync_manual_readings
    AFTER INSERT ON recorded_readings
    FOR EACH ROW
    EXECUTE FUNCTION sync_manual_readings_to_telemetry();
```

## 12.5 Function ุชุญููู ูุตุฏุฑ ุงูุจูุงูุงุช (ุงูุชุฑููุฉ)

```sql
CREATE OR REPLACE FUNCTION convert_asset_data_source(
    p_asset_id UUID,
    p_new_source VARCHAR(50),
    p_connection_config JSONB,
    p_user_id UUID
) RETURNS JSONB AS $$
DECLARE
    v_old_source VARCHAR(50);
    v_result JSONB;
BEGIN
    -- ุงูุญุตูู ุนูู ุงููุตุฏุฑ ุงูุญุงูู
    SELECT current_data_source INTO v_old_source
    FROM asset_data_source_config
    WHERE asset_id = p_asset_id;
    
    -- ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
    UPDATE asset_data_source_config
    SET 
        current_data_source = p_new_source,
        connection_config = p_connection_config,
        converted_from = v_old_source,
        converted_at = NOW(),
        converted_by = p_user_id,
        updated_at = NOW()
    WHERE asset_id = p_asset_id;
    
    -- ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุฃูุดุฆ ุณุฌูุงู ุฌุฏูุฏุงู
    IF NOT FOUND THEN
        INSERT INTO asset_data_source_config (
            asset_id, asset_type, current_data_source, 
            connection_config, converted_by
        )
        SELECT 
            p_asset_id,
            asset_type,
            p_new_source,
            p_connection_config,
            p_user_id
        FROM assets WHERE id = p_asset_id;
    END IF;
    
    -- ุชุณุฌูู ูู ุณุฌู ุงูุชุฏููู
    INSERT INTO audit_log (
        entity_type, entity_id, action, 
        old_values, new_values, performed_by
    ) VALUES (
        'asset_data_source', p_asset_id, 'convert',
        jsonb_build_object('source', v_old_source),
        jsonb_build_object('source', p_new_source, 'config', p_connection_config),
        p_user_id
    );
    
    RETURN jsonb_build_object(
        'success', true,
        'old_source', v_old_source,
        'new_source', p_new_source,
        'message', 'ุชู ุชุญููู ูุตุฏุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ'
    );
END;
$$ LANGUAGE plpgsql;
```

## 12.6 View ุงูุจูุงูุงุช ุงูููุญุฏุฉ ูุน ูุนูููุงุช ุงููุตุฏุฑ

```sql
CREATE OR REPLACE VIEW v_unified_asset_data AS
SELECT 
    t.id,
    t.asset_id,
    t.asset_type,
    a.asset_name,
    a.asset_code,
    t.timestamp,
    t.data,
    t.data_source,
    
    -- ูุนูููุงุช ุงููุตุฏุฑ
    CASE t.data_source
        WHEN 'MANUAL' THEN 'ูุฏูู'
        WHEN 'AUTOMATIC_ACREL' THEN 'Acrel'
        WHEN 'AUTOMATIC_DEEPSEA' THEN 'DeepSea'
        WHEN 'AUTOMATIC_COMAP' THEN 'ComAp'
        WHEN 'AUTOMATIC_IOT' THEN 'IoT'
        WHEN 'AUTOMATIC_SCADA' THEN 'SCADA'
    END AS data_source_name_ar,
    
    -- ูููุฑุงุกุงุช ุงููุฏููุฉ
    t.recorded_by,
    u.full_name AS recorded_by_name,
    
    -- ุญุณุงุจ ุงููุงุฑู ุงูุฒููู
    EXTRACT(EPOCH FROM (NOW() - t.timestamp)) / 3600 AS hours_since_update,
    
    -- ุนูุงูุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
    CASE 
        WHEN t.data_source = 'MANUAL' AND EXTRACT(EPOCH FROM (NOW() - t.timestamp)) > 28800 THEN true
        WHEN t.data_source != 'MANUAL' AND EXTRACT(EPOCH FROM (NOW() - t.timestamp)) > 300 THEN true
        ELSE false
    END AS is_stale
    
FROM asset_telemetry_data t
JOIN assets a ON a.id = t.asset_id
LEFT JOIN users u ON u.id = t.recorded_by;
```

## 12.7 ุดุงุดุฉ ุนุฑุถ ุงูุจูุงูุงุช ุงูููุญุฏุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ ุจูุงูุงุช ุงูุฃุตู: ุงููููุฏ G2                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  ๐ ุงููููุน: ูุญุทุฉ ุงูุดูุงู - ุบุฑูุฉ ุงููููุฏุงุช                            โ   โ
โ  โ  ๐ ูุตุฏุฑ ุงูุจูุงูุงุช: [ูุฏูู ๐]                                        โ   โ
โ  โ  โฐ ุขุฎุฑ ุชุญุฏูุซ: ููุฐ 3 ุณุงุนุงุช ุจูุงุณุทุฉ: ุฃุญูุฏ ูุญูุฏ                       โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                           ุงููุฑุงุกุงุช ุงูุญุงููุฉ                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโ     โ
โ  โ ุงููุคุดุฑ          โ ุงููููุฉ       โ ุงููุญุฏุฉ       โ ุขุฎุฑ ุชุญุฏูุซ        โ     โ
โ  โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโค     โ
โ  โ ุณุงุนุงุช ุงูุชุดุบูู   โ 1,234.5      โ ุณุงุนุฉ        โ ููุฐ 3 ุณุงุนุงุช ๐   โ     โ
โ  โ ูุฑุงุกุฉ ุงูุทุงูุฉ    โ 56,789       โ kWh         โ ููุฐ 3 ุณุงุนุงุช ๐   โ     โ
โ  โ ูุณุชูู ุงููููุฏ   โ 75           โ %           โ ููุฐ 3 ุณุงุนุงุช ๐   โ     โ
โ  โ ุถุบุท ุงูุฒูุช      โ 4.2          โ bar         โ ููุฐ 3 ุณุงุนุงุช ๐   โ     โ
โ  โโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโ     โ
โ                                                                             โ
โ  ๐ = ูุฑุงุกุฉ ูุฏููุฉ    ๐ = ูุฑุงุกุฉ ุขููุฉ                                       โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุชุฑููุฉ ูุตุฏุฑ ุงูุจูุงูุงุช                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โ๏ธ ูุฐุง ุงูุฃุตู ูุณุชุฎุฏู ุงููุฑุงุกุงุช ุงููุฏููุฉ ุญุงููุงู.                              โ
โ  [๐ ุชุฑููุฉ ุฅูู DeepSea]  [๐ ุชุฑููุฉ ุฅูู SCADA]                              โ
โ                                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.8 ุดุงุดุฉ ุชุญููู ูุตุฏุฑ ุงูุจูุงูุงุช

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ๐ ุชุญููู ูุตุฏุฑ ุงูุจูุงูุงุช: ุงููููุฏ G2                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  ุงููุตุฏุฑ ุงูุญุงูู: [ูุฏูู ๐]                                                  โ
โ  ุงููุตุฏุฑ ุงูุฌุฏูุฏ: [DeepSea โผ]                                                โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                         ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  ูุนุฑู ุงูุฌูุงุฒ:    [GEN002                    ]                              โ
โ  ุงูุจุฑูุชูููู:     [Modbus TCP โผ]                                            โ
โ  ุนููุงู IP:       [192.168.1.102             ]                              โ
โ  ุงููููุฐ:         [502                       ]                              โ
โ                                                                             โ
โ  [๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู]                                                       โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ โ ุชู ุงูุงุชุตุงู ุจูุฌุงุญ!                                                โ   โ
โ  โ ๐ ุงูุจูุงูุงุช ุงููุณุชููุฉ: ุณุงุนุงุช ุงูุชุดุบูู: 1234.8, ุงูุทุงูุฉ: 56792 kWh     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โ๏ธ ููุงุญุธุฉ: ุจุนุฏ ุงูุชุญูููุ ุณุชุชููู ุฌููุงุช ุงููุฑุงุกุฉ ุงููุฏููุฉ ููุฐุง ุงูุฃุตู          โ
โ     ูุณูุจุฏุฃ ุงููุธุงู ูู ุงุณุชูุจุงู ุงูุจูุงูุงุช ุงูุขููุฉ.                              โ
โ                                                                             โ
โ              [โ ุฅูุบุงุก]                    [โ ุชุฃููุฏ ุงูุชุญููู]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 12.9 APIs ุชูุญูุฏ ุงูุจูุงูุงุช

| Method | Endpoint | ุงููุตู |
|--------|----------|-------|
| GET | `/api/v1/assets/:id/data` | ุจูุงูุงุช ุงูุฃุตู ุงูููุญุฏุฉ |
| GET | `/api/v1/assets/:id/data/history` | ุงูุณุฌู ุงูุชุงุฑูุฎู |
| GET | `/api/v1/assets/:id/data-source` | ุฅุนุฏุงุฏุงุช ูุตุฏุฑ ุงูุจูุงูุงุช |
| PUT | `/api/v1/assets/:id/data-source` | ุชุญููู ูุตุฏุฑ ุงูุจูุงูุงุช |
| POST | `/api/v1/assets/:id/data-source/test` | ุงุฎุชุจุงุฑ ุงูุงุชุตุงู |


---

# 10. ุทุจูุฉ ุงููุฑู ุงูููุฏุงููุฉ ุนูู ุงูุฎุฑูุทุฉ (Field Teams Layer)

## 10.1 ูุธุฑุฉ ุนุงูุฉ

> **ุงูุบุฑุถ:** ุนุฑุถ ููุงูุน ุงูููููู ุงูููุฏุงูููู ุนูู ุงูุฎุฑูุทุฉ ูู ุงูููุช ุงููุนูู ูุน ุฅููุงููุฉ ุนุฑุถ ูุณุงุฑ ุงูุฑุญูุฉ.

## 10.2 ุฅุนุฏุงุฏุงุช ุทุจูุฉ ุงููุฑู ุงูููุฏุงููุฉ

```sql
CREATE TABLE map_layer_field_teams (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- ุฅุนุฏุงุฏุงุช ุงูุนุฑุถ
    layer_name VARCHAR(100) DEFAULT 'ุงููุฑู ุงูููุฏุงููุฉ',
    is_enabled BOOLEAN DEFAULT true,
    default_visible BOOLEAN DEFAULT false,
    
    -- ุฃููููุงุช ุงูุญุงูุงุช
    icon_available VARCHAR(200) DEFAULT '/icons/technician-available.png',
    icon_on_task VARCHAR(200) DEFAULT '/icons/technician-busy.png',
    icon_on_break VARCHAR(200) DEFAULT '/icons/technician-break.png',
    icon_offline VARCHAR(200) DEFAULT '/icons/technician-offline.png',
    
    -- ุฅุนุฏุงุฏุงุช ุงูุชุญุฏูุซ
    refresh_interval_seconds INT DEFAULT 30,
    show_trail BOOLEAN DEFAULT false,             -- ุนุฑุถ ุฃุซุฑ ุงูุญุฑูุฉ
    trail_duration_minutes INT DEFAULT 30,
    
    -- ููุงุชุฑ ุงูุนุฑุถ
    show_available_only BOOLEAN DEFAULT false,
    show_my_team_only BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 10.3 View ุงููุฑู ุงูููุฏุงููุฉ ููุฎุฑูุทุฉ

```sql
CREATE OR REPLACE VIEW v_map_field_teams AS
SELECT 
    lkl.employee_id,
    e.full_name AS employee_name,
    e.employee_code,
    e.department,
    e.job_title,
    s.station_name,
    s.branch_id,
    
    -- ุงููููุน
    lkl.latitude,
    lkl.longitude,
    lkl.accuracy_meters,
    
    -- ุงูุญุงูุฉ
    lkl.employee_status,
    CASE lkl.employee_status
        WHEN 'available' THEN 'โ ูุชุงุญ'
        WHEN 'on_task' THEN '๐ง ูุดุบูู'
        WHEN 'on_break' THEN 'โ ุงุณุชุฑุงุญุฉ'
        WHEN 'traveling' THEN '๐ ูู ุงูุทุฑูู'
        WHEN 'offline' THEN 'โซ ุบูุฑ ูุชุตู'
    END AS status_display,
    
    -- ุงููููุฉ ุงูุญุงููุฉ
    lkl.current_task_id,
    wo.description AS current_task_description,
    wo.priority AS task_priority,
    
    -- ูุนูููุงุช ุฅุถุงููุฉ
    lkl.battery_level,
    lkl.last_update,
    EXTRACT(EPOCH FROM (NOW() - lkl.last_update)) / 60 AS minutes_since_update,
    lkl.is_online,
    
    -- GeoJSON ููุฎุฑูุทุฉ
    jsonb_build_object(
        'type', 'Feature',
        'geometry', jsonb_build_object(
            'type', 'Point',
            'coordinates', ARRAY[lkl.longitude, lkl.latitude]
        ),
        'properties', jsonb_build_object(
            'id', lkl.employee_id,
            'name', e.full_name,
            'status', lkl.employee_status,
            'battery', lkl.battery_level,
            'task', wo.description,
            'lastUpdate', lkl.last_update
        )
    ) AS geojson

FROM last_known_locations lkl
JOIN employees e ON e.id = lkl.employee_id
LEFT JOIN stations s ON s.id = e.station_id
LEFT JOIN work_orders wo ON wo.id = lkl.current_task_id
WHERE e.is_field_employee = true;
```

## 10.4 ุดุงุดุฉ ุนุงุฑุถ ูุณุงุฑ ุงูุฑุญูุฉ (Route Replay)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐บ๏ธ ุนุงุฑุถ ูุณุงุฑ ุงูุฑุญูุฉ - ุฃุญูุฏ ูุญูุฏ                         โ
โ                         ๐ 16/12/2024                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ                                                                     โ   โ
โ  โ                         [ุฎุฑูุทุฉ ุชูุงุนููุฉ]                             โ   โ
โ  โ                                                                     โ   โ
โ  โ     ๐ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ ๐ง           โ   โ
โ  โ     ุงูุจุฏุงูุฉ                                          ูููุฉ 1        โ   โ
โ  โ     08:05                                            08:45         โ   โ
โ  โ                              โ                                     โ   โ
โ  โ                              โ                                     โ   โ
โ  โ                              โผ                                     โ   โ
โ  โ                           ๐ง ูููุฉ 2                                โ   โ
โ  โ                           10:30                                    โ   โ
โ  โ                              โ                                     โ   โ
โ  โ                              โผ                                     โ   โ
โ  โ                           โ ุงุณุชุฑุงุญุฉ                               โ   โ
โ  โ                           12:00-12:30                              โ   โ
โ  โ                                                                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ููุฎุต ุงูููู                                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ ุงููุณุงูุฉ     โ ุงูููุงู       โ ููุช ุงูุชููู  โ ููุช ุงูุนูู               โ โ
โ  โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโค โ
โ  โ 45.2 ูู     โ 5 ููุงู      โ 2.5 ุณุงุนุฉ    โ 5.5 ุณุงุนุฉ                โ โ
โ  โโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                              ููุงุท ุงูุชููู                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  โโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ ุงูููุช โ ุงููููุน                  โ ุงููุฏุฉ       โ ุงููุดุงุท            โ   โ
โ  โโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโค   โ
โ  โ 08:45  โ ุญู ุงููุตุฑุ ุดุงุฑุน 15      โ 45 ุฏูููุฉ   โ ๐ง ุชุฑููุจ ุนุฏุงุฏ     โ   โ
โ  โ 10:30  โ ุญู ุงูุณูุงูุ ุดุงุฑุน 7      โ 90 ุฏูููุฉ   โ ๐ง ุตูุงูุฉ ูุญูู     โ   โ
โ  โ 12:00  โ ูุทุนู ุงูุดุฑู             โ 30 ุฏูููุฉ   โ โ ุงุณุชุฑุงุญุฉ ุบุฏุงุก   โ   โ
โ  โ 13:00  โ ุญู ุงููุญุฏุฉุ ุดุงุฑุน 3      โ 60 ุฏูููุฉ   โ ๐ง ุงุณุชุจุฏุงู ุนุฏุงุฏ   โ   โ
โ  โโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโ   โ
โ                                                                             โ
โ  [โถ๏ธ ุชุดุบูู]  [โธ๏ธ ุฅููุงู]  [โช ุฅุฑุฌุงุน]  [โฉ ุชูุฏูู]  [๐ค ุชุตุฏูุฑ]              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## 10.5 Function ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงููุณุงุฑ

```sql
CREATE OR REPLACE FUNCTION calculate_route_statistics(
    p_employee_id UUID,
    p_date DATE DEFAULT CURRENT_DATE
) RETURNS JSONB AS $$
DECLARE
    v_result JSONB;
    v_total_distance DECIMAL(10, 2) := 0;
    v_prev_lat DECIMAL(10, 8);
    v_prev_lon DECIMAL(11, 8);
    v_point RECORD;
BEGIN
    -- ุญุณุงุจ ุงููุณุงูุฉ ุงูุฅุฌูุงููุฉ
    FOR v_point IN 
        SELECT latitude, longitude
        FROM location_tracking_log
        WHERE employee_id = p_employee_id
        AND DATE(recorded_at) = p_date
        ORDER BY recorded_at
    LOOP
        IF v_prev_lat IS NOT NULL THEN
            v_total_distance := v_total_distance + (
                6371 * ACOS(
                    COS(RADIANS(v_prev_lat)) * COS(RADIANS(v_point.latitude)) *
                    COS(RADIANS(v_point.longitude) - RADIANS(v_prev_lon)) +
                    SIN(RADIANS(v_prev_lat)) * SIN(RADIANS(v_point.latitude))
                )
            );
        END IF;
        v_prev_lat := v_point.latitude;
        v_prev_lon := v_point.longitude;
    END LOOP;
    
    -- ุฌูุน ุงูุฅุญุตุงุฆูุงุช
    SELECT jsonb_build_object(
        'total_distance_km', ROUND(v_total_distance, 2),
        'total_points', COUNT(*),
        'first_location_time', MIN(recorded_at),
        'last_location_time', MAX(recorded_at),
        'tasks_completed', COUNT(DISTINCT current_task_id) FILTER (WHERE current_task_id IS NOT NULL),
        'time_on_task_minutes', COUNT(*) FILTER (WHERE employee_status = 'on_task') * 5,
        'time_traveling_minutes', COUNT(*) FILTER (WHERE employee_status = 'traveling') * 5,
        'time_on_break_minutes', COUNT(*) FILTER (WHERE employee_status = 'on_break') * 5
    ) INTO v_result
    FROM location_tracking_log
    WHERE employee_id = p_employee_id
    AND DATE(recorded_at) = p_date;
    
    RETURN v_result;
END;
$$ LANGUAGE plpgsql;
```


---

# ๐ ุงูุชูุงูู ูุน ูุธุงู ุงููุทูุฑ (02)

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู (SCADA) ูุชูุงูู ูุน ูุธุงู ุงููุทูุฑ ุนุจุฑ:
1. **APIs ุงูุฏุงุฎููุฉ** - ููุชูุงุตู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู
2. **ูุธุงู ุงูุฃุญุฏุงุซ** - ููุดุฑ ุงูุชูุจููุงุช ูุงูุฅูุฐุงุฑุงุช
3. **ุงูุจูุงูุงุช ุงูุญูุฉ** - ุนุจุฑ WebSocket
4. **ุชูุงูู IoT** - ูุงุณุชูุจุงู ุจูุงูุงุช ุงูุฃุฌูุฒุฉ

---

## ๐ก APIs ุงููุณุฌูุฉ ูู ูุธุงู ุงููุทูุฑ

ุฌููุน APIs ูุธุงู ุงููุฑุงูุจุฉ ูุงูุชุญูู ูุชุงุญุฉ ุนุจุฑ `/api/scada/*`:

| ุงููุฌููุนุฉ | Endpoint | ุงููุตู |
|----------|----------|-------|
| ุงูุดุจูุฉ | `/api/scada/network` | ุญุงูุฉ ุงูุดุจูุฉ |
| ุงูุชูุจููุงุช | `/api/scada/alerts` | ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช |
| ุงููุฑุงุกุงุช | `/api/scada/readings` | ูุฑุงุกุงุช ุงูุฃุฌูุฒุฉ |
| ุงูุชุญูู | `/api/scada/control` | ุฃูุงูุฑ ุงูุชุญูู |

---

## ๐ฏ ุงูุฃุญุฏุงุซ ุงูููุดูุฑุฉ

```
network.status_changed      - ุชุบูุฑ ุญุงูุฉ ุงูุดุจูุฉ
network.outage_detected     - ุงูุชุดุงู ุงููุทุงุน

alert.created               - ุฅูุดุงุก ุชูุจูู
alert.acknowledged          - ุงูุฅูุฑุงุฑ ุจุชูุจูู
alert.resolved              - ุญู ุชูุจูู

reading.threshold_exceeded  - ุชุฌุงูุฒ ุญุฏ ุงููุฑุงุกุฉ
reading.anomaly_detected    - ุงูุชุดุงู ูุฑุงุกุฉ ุดุงุฐุฉ

control.command_sent        - ุฅุฑุณุงู ุฃูุฑ ุชุญูู
control.command_executed    - ุชูููุฐ ุฃูุฑ ุชุญูู
```

---

## ๐ฅ ุงูุฃุญุฏุงุซ ุงููุณุชูุจูุฉ

| ุงูุญุฏุซ | ุงููุตุฏุฑ | ุงูุฅุฌุฑุงุก |
|-------|--------|---------|
| `asset.installed` | ุงูุฃุตูู ูุงูุตูุงูุฉ | ุฅุถุงูุฉ ุฌูุงุฒ ูููุฑุงูุจุฉ |
| `asset.decommissioned` | ุงูุฃุตูู ูุงูุตูุงูุฉ | ุฅุฒุงูุฉ ุฌูุงุฒ ูู ุงููุฑุงูุจุฉ |
| `maintenance.started` | ุงูุฃุตูู ูุงูุตูุงูุฉ | ุชุนููู ุชูุจููุงุช ุงูุฌูุงุฒ |

---

## ๐ WebSocket ููุจูุงูุงุช ุงูุญูุฉ

### ุงูุงุชุตุงู

```
ws://api/scada/live
```

### ุงูุงุดุชุฑุงู ูู ุงููููุงุช

```json
{
  "action": "subscribe",
  "channels": [
    "network.status",
    "alerts.critical",
    "readings.station.123"
  ]
}
```

### ุฃุญุฏุงุซ WebSocket

```json
{
  "channel": "readings.station.123",
  "event": "reading.new",
  "data": {
    "device_id": "METER-001",
    "parameter": "active_power",
    "value": 150.5,
    "timestamp": "2024-12-15T10:00:00Z"
  }
}
```

---

## ๐ ููุงููุณ ุงูุฃุฏุงุก ุงููุฑุณูุฉ ููุธุงู ุงููุทูุฑ

```sql
INSERT INTO performance_metrics (metric_name, metric_type, metric_value, labels)
VALUES
  ('scada.devices_online', 'gauge', 250, '{}'),
  ('scada.active_alerts', 'gauge', 5, '{}'),
  ('scada.readings_per_second', 'gauge', 500, '{}'),
  ('scada.network_availability', 'gauge', 99.95, '{}');
```

---

## ๐ค ุชูุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู

### ูุดู ุงูุฃุนุทุงู ุงูุชูุจุคู

```
POST /api/ai/detect/network-anomalies
{
  "station_id": "uuid",
  "analysis_window_hours": 24
}
```

### ุชุญุณูู ุชูุฒูุน ุงูุฃุญูุงู

```
POST /api/ai/optimize/load-distribution
{
  "station_ids": ["uuid1", "uuid2"],
  "target": "balance_load"
}
```


---

# ๐ฑ ุงูุดุงุดุงุช ูุงููุงุฌูุงุช ุงูุชูุตูููุฉ

## 1. ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ (Main Dashboard)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ุฎุฑูุทุฉ ุงูุดุจูุฉ | ุนุฑุถ GIS ูููุญุทุงุช ูุงูุฎุทูุท |
| ูุคุดุฑุงุช ุงูุฃุฏุงุก | KPIs ุงูุฑุฆูุณูุฉ (ุงูุชููุฑุ ุงูููุฏุ ุงูุญูู) |
| ูุงุฆูุฉ ุงูุชูุจููุงุช | ุงูุชูุจููุงุช ุงููุดุทุฉ ูุฑุชุจุฉ ุจุงูุฃููููุฉ |
| ุฑุณู ุจูุงูู ุงูุญูู | ููุญูู ุงูุญูู ุงูุญุงูู |
| ุญุงูุฉ ุงููุญุทุงุช | ููุฎุต ุญุงูุฉ ูู ูุญุทุฉ |

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- ุงูููุฑ ุนูู ูุญุทุฉ ูุนุฑุถ ุงูุชูุงุตูู
- ููุชุฑุฉ ุงูุชูุจููุงุช ุญุณุจ ุงูููุน/ุงูุฃููููุฉ
- ุชุบููุฑ ูุทุงู ุงูุฑุณู ุงูุจูุงูู
- ุชุตุฏูุฑ ุงูุจูุงูุงุช

---

## 2. ุดุงุดุฉ ูุฑุงูุจุฉ ุงููุญุทุฉ (Station Monitoring)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ูุฎุทุท ุฃุญุงุฏู ุงูุฎุท | Single Line Diagram ูููุญุทุฉ |
| ูุฑุงุกุงุช ุงููููุฏุงุช | ุงูุฌูุฏุ ุงูุชูุงุฑุ ุงููุฏุฑุฉุ ุงูุชุฑุฏุฏ |
| ูุฑุงุกุงุช ุงููุญููุงุช | ุงูุญููุ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ |
| ูุฑุงุกุงุช ุงููุบุฐูุงุช | ุงูุชูุงุฑุ ุงููุฏุฑุฉุ ุนุงูู ุงููุฏุฑุฉ |
| ุณุฌู ุงูุฃุญุฏุงุซ | ุขุฎุฑ 50 ุญุฏุซ |

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- ูุชุญ/ุฅุบูุงู ุงูููุงุทุน (ูุน ุชุฃููุฏ)
- ุชุนุฏูู ููุงุท ุงูุถุจุท
- ุฅุฑุณุงู ุฃูุงูุฑ ุงูุชุญูู
- ุชุตุฏูุฑ ุงููุฑุงุกุงุช

---

## 3. ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงูุชูุจููุงุช (Alerts Management)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ูุงุฆูุฉ ุงูุชูุจููุงุช | ุฌููุน ุงูุชูุจููุงุช ูุน ุงูููุชุฑุฉ |
| ุชูุงุตูู ุงูุชูุจูู | ูุนูููุงุช ููุตูุฉ ุนู ุงูุชูุจูู ุงููุญุฏุฏ |
| ุณุฌู ุงูุฅุฌุฑุงุกุงุช | ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ |
| ุฅุญุตุงุฆูุงุช | ุนุฏุฏ ุงูุชูุจููุงุช ุญุณุจ ุงูููุน/ุงูุฃููููุฉ |

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- ุงูุฅูุฑุงุฑ ุจุงูุชูุจูู (Acknowledge)
- ุฅุบูุงู ุงูุชูุจูู ูุน ููุงุญุธุงุช
- ุชุตุนูุฏ ุงูุชูุจูู
- ุฅูุดุงุก ุฃูุฑ ุนูู

---

## 4. ุดุงุดุฉ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช (Reports & Analytics)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ุชูุฑูุฑ ุงูุฅูุชุงุฌ | ุงูุทุงูุฉ ุงูููุชุฌุฉ ููููุงู/ุดูุฑูุงู |
| ุชูุฑูุฑ ุงูุงุณุชููุงู | ุงูุทุงูุฉ ุงููุณุชูููุฉ |
| ุชูุฑูุฑ ุงูููุฏ | ุงูููุฏ ุงูููู ูุงูุชุฌุงุฑู |
| ุชูุฑูุฑ ุงูุชููุฑ | ูุณุจุฉ ุชููุฑ ุงูุฎุฏูุฉ |
| ุชูุฑูุฑ ุงูุฃุนุทุงู | ุฅุญุตุงุฆูุงุช ุงูุฃุนุทุงู |

---

## 5. ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงูุฃุฌูุฒุฉ (Device Management)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ูุงุฆูุฉ ุงูุฃุฌูุฒุฉ | RTUs, PLCs, Meters |
| ุญุงูุฉ ุงูุงุชุตุงู | Online/Offline |
| ุขุฎุฑ ูุฑุงุกุฉ | ููุช ุขุฎุฑ ูุฑุงุกุฉ |
| ุฅุนุฏุงุฏุงุช ุงูุฌูุงุฒ | ูุนููุงุช ุงูุงุชุตุงู |

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- ุฅุถุงูุฉ ุฌูุงุฒ ุฌุฏูุฏ
- ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงูุฌูุงุฒ
- ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุงุฒ
- ุงุฎุชุจุงุฑ ุงูุงุชุตุงู

---

## 6. ุดุงุดุฉ ุงูุชุญูู ุนู ุจุนุฏ (Remote Control)

### ููููุงุช ุงูุดุงุดุฉ:
| ุงููููู | ุงููุตู |
|--------|-------|
| ูุงุฆูุฉ ููุงุท ุงูุชุญูู | ุงูููุงุทุนุ ุงูููุงุชูุญ |
| ุญุงูุฉ ุงูููุทุฉ | ููุชูุญ/ูุบูู |
| ุฃุฒุฑุงุฑ ุงูุชุญูู | ูุชุญ/ุฅุบูุงู |
| ุณุฌู ุงูุฃูุงูุฑ | ุชุงุฑูุฎ ุงูุฃูุงูุฑ |

### ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ:
- ุฅุฑุณุงู ุฃูุฑ ูุชุญ/ุฅุบูุงู
- ุฌุฏููุฉ ุฃูุฑ
- ุฅูุบุงุก ุฃูุฑ ูุนูู

---

# โ๏ธ ููุงุนุฏ ุงูุนูู (Business Rules)

## ููุงุนุฏ ุงูุชูุจููุงุช

| ุงููุงุนุฏุฉ | ุงููุตู | ุงูุฅุฌุฑุงุก |
|---------|-------|---------|
| BR-SCADA-001 | ุงูุฌูุฏ ุฎุงุฑุฌ ุงููุทุงู (ยฑ10%) | ุชูุจูู ุนุงูู ุงูุฃููููุฉ |
| BR-SCADA-002 | ุงูุชุฑุฏุฏ ุฎุงุฑุฌ ุงููุทุงู (ยฑ0.5Hz) | ุชูุจูู ุญุฑุฌ |
| BR-SCADA-003 | ุงูุญูู ุงูุฒุงุฆุฏ (>90%) | ุชูุจูู ูุชูุณุท |
| BR-SCADA-004 | ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุนุงููุฉ | ุชูุจูู ุนุงูู |
| BR-SCADA-005 | ููุฏุงู ุงูุงุชุตุงู ุจุงูุฌูุงุฒ | ุชูุจูู ุญุฑุฌ |
| BR-SCADA-006 | ุนุทู ูู ุงููุงุทุน | ุชูุจูู ุญุฑุฌ + ุฃูุฑ ุนูู |

## ููุงุนุฏ ุงูุชุญูู

| ุงููุงุนุฏุฉ | ุงููุตู | ุงูุดุฑุท |
|---------|-------|-------|
| BR-CTRL-001 | ุชุฃููุฏ ูุฒุฏูุฌ ููุฃูุงูุฑ ุงูุญุฑุฌุฉ | ุงูููุงุทุน ุงูุฑุฆูุณูุฉ |
| BR-CTRL-002 | ูุชุฑุฉ ุงูุชุธุงุฑ ุจูู ุงูุฃูุงูุฑ | 30 ุซุงููุฉ |
| BR-CTRL-003 | ุญุฏ ุฃูุตู ููุฃูุงูุฑ ุงูููููุฉ | 100 ุฃูุฑ |
| BR-CTRL-004 | ุชุณุฌูู ุฌููุน ุงูุฃูุงูุฑ | ุฅูุฒุงูู |
| BR-CTRL-005 | ุตูุงุญูุฉ ุงูุชุญูู | ูุณุชุฎุฏููู ูุญุฏุฏูู ููุท |

## ููุงุนุฏ ุงูุจูุงูุงุช

| ุงููุงุนุฏุฉ | ุงููุตู |
|---------|-------|
| BR-DATA-001 | ุญูุธ ุงููุฑุงุกุงุช ูู 15 ุฏูููุฉ |
| BR-DATA-002 | ุญูุธ ุงูุฃุญุฏุงุซ ููุฑุงู |
| BR-DATA-003 | ุฃุฑุดูุฉ ุงูุจูุงูุงุช ุจุนุฏ 90 ููู |
| BR-DATA-004 | ุงููุณุฎ ุงูุงุญุชูุงุทู ููููุงู |

---

# ๐ ููุงุนุฏ ุงูุชุญูู (Validation Rules)

## ุงูุชุญูู ูู ุงููุฑุงุกุงุช

```sql
-- ุงูุชุญูู ูู ุตุญุฉ ูุฑุงุกุฉ ุงูุฌูุฏ
CREATE OR REPLACE FUNCTION validate_voltage_reading()
RETURNS TRIGGER AS $$
BEGIN
    -- ุงูุฌูุฏ ูุฌุจ ุฃู ูููู ุจูู 0 ู 500 ูููููููุช
    IF NEW.voltage < 0 OR NEW.voltage > 500000 THEN
        RAISE EXCEPTION 'ูุฑุงุกุฉ ุงูุฌูุฏ ุบูุฑ ุตุงูุญุฉ: %', NEW.voltage;
    END IF;
    
    -- ุงูุชุญูู ูู ุงูุชุบูุฑ ุงูููุงุฌุฆ (ุฃูุซุฑ ูู 20%)
    IF EXISTS (
        SELECT 1 FROM device_readings 
        WHERE device_id = NEW.device_id 
        AND ABS(voltage - NEW.voltage) / voltage > 0.2
        AND recorded_at > NOW() - INTERVAL '5 minutes'
    ) THEN
        -- ุฅูุดุงุก ุชูุจูู
        INSERT INTO alerts (device_id, alert_type, severity, message)
        VALUES (NEW.device_id, 'voltage_spike', 'high', 'ุชุบูุฑ ููุงุฌุฆ ูู ุงูุฌูุฏ');
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

## ุงูุชุญูู ูู ุฃูุงูุฑ ุงูุชุญูู

```sql
-- ุงูุชุญูู ูู ุตูุงุญูุฉ ุฃูุฑ ุงูุชุญูู
CREATE OR REPLACE FUNCTION validate_control_command()
RETURNS TRIGGER AS $$
DECLARE
    user_has_permission BOOLEAN;
    commands_today INT;
BEGIN
    -- ุงูุชุญูู ูู ุตูุงุญูุฉ ุงููุณุชุฎุฏู
    SELECT EXISTS (
        SELECT 1 FROM user_permissions 
        WHERE user_id = NEW.user_id 
        AND permission = 'scada.control'
    ) INTO user_has_permission;
    
    IF NOT user_has_permission THEN
        RAISE EXCEPTION 'ุงููุณุชุฎุฏู ููุณ ูุฏูู ุตูุงุญูุฉ ุงูุชุญูู';
    END IF;
    
    -- ุงูุชุญูู ูู ุนุฏุฏ ุงูุฃูุงูุฑ ุงูููููุฉ
    SELECT COUNT(*) INTO commands_today
    FROM control_commands
    WHERE user_id = NEW.user_id
    AND created_at::date = CURRENT_DATE;
    
    IF commands_today >= 100 THEN
        RAISE EXCEPTION 'ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู ููุฃูุงูุฑ ุงูููููุฉ';
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

# ๐ ููุงููุณ ุงูุฃุฏุงุก (KPIs)

| ุงููููุงุณ | ุงููุตู | ุงููุฏู |
|---------|-------|-------|
| SAIDI | ูุชูุณุท ูุฏุฉ ุงูุงููุทุงุน | < 60 ุฏูููุฉ/ุณูุฉ |
| SAIFI | ูุชูุณุท ุชูุฑุงุฑ ุงูุงููุทุงุน | < 2 ูุฑุฉ/ุณูุฉ |
| CAIDI | ูุชูุณุท ูุฏุฉ ุงูุงููุทุงุน ููู ุนููู | < 30 ุฏูููุฉ |
| Network Availability | ุชููุฑ ุงูุดุจูุฉ | > 99.9% |
| Technical Losses | ุงูููุฏ ุงูููู | < 8% |
| Commercial Losses | ุงูููุฏ ุงูุชุฌุงุฑู | < 5% |


---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ ูููุธุงู

### ูุนูููุงุช ุงููุณุชูุฏุน

| ุงูุนูุตุฑ | ุงููููุฉ |
|--------|--------|
| **ุงุณู ุงููุณุชูุฏุน** | `scada-system` |
| **ุงููููุฐ API** | 3005 |
| **ุงููููุฐ Web** | 4205 |
| **ุงููููุฐ WebSocket** | 3015 |
| **ุจุงุฏุฆุฉ ุงูุฌุฏุงูู** | `scada_` |
| **ูุณุงุฑ API** | `/api/v1/scada` |

### Prisma Schema ุงูุฃุณุงุณู

```prisma
model scada_stations {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(20)
  name        String   @db.VarChar(200)
  type        String   @db.VarChar(50)
  latitude    Decimal? @db.Decimal(10, 8)
  longitude   Decimal? @db.Decimal(11, 8)
  capacity    Decimal? @db.Decimal(15, 2)
  status      String   @default("online") @db.VarChar(20)
  lastSyncAt  DateTime? @map("last_sync_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  devices     scada_devices[]
  readings    scada_readings[]
  alerts      scada_alerts[]
  
  @@map("scada_stations")
}

model scada_devices {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(50)
  name        String   @db.VarChar(200)
  stationId   String   @map("station_id") @db.Uuid
  type        String   @db.VarChar(50)
  protocol    String   @db.VarChar(50)
  ipAddress   String?  @map("ip_address") @db.VarChar(50)
  port        Int?
  slaveId     Int?     @map("slave_id")
  status      String   @default("online") @db.VarChar(20)
  lastReadAt  DateTime? @map("last_read_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  station     scada_stations @relation(fields: [stationId], references: [id])
  dataPoints  scada_data_points[]
  
  @@map("scada_devices")
}

model scada_data_points {
  id          String   @id @default(uuid()) @db.Uuid
  deviceId    String   @map("device_id") @db.Uuid
  code        String   @db.VarChar(50)
  name        String   @db.VarChar(100)
  dataType    String   @map("data_type") @db.VarChar(20)
  unit        String?  @db.VarChar(20)
  address     String?  @db.VarChar(50)
  scaleFactor Decimal  @default(1) @map("scale_factor") @db.Decimal(10, 4)
  minValue    Decimal? @map("min_value") @db.Decimal(15, 4)
  maxValue    Decimal? @map("max_value") @db.Decimal(15, 4)
  isAlarmEnabled Boolean @default(false) @map("is_alarm_enabled")
  createdAt   DateTime @default(now()) @map("created_at")
  
  device      scada_devices @relation(fields: [deviceId], references: [id])
  
  @@unique([deviceId, code])
  @@map("scada_data_points")
}

model scada_readings {
  id          String   @id @default(uuid()) @db.Uuid
  stationId   String   @map("station_id") @db.Uuid
  dataPointId String   @map("data_point_id") @db.Uuid
  value       Decimal  @db.Decimal(15, 4)
  quality     String   @default("good") @db.VarChar(20)
  timestamp   DateTime @default(now())
  
  station     scada_stations @relation(fields: [stationId], references: [id])
  
  @@index([stationId, timestamp])
  @@index([dataPointId, timestamp])
  @@map("scada_readings")
}

model scada_alerts {
  id            String    @id @default(uuid()) @db.Uuid
  stationId     String    @map("station_id") @db.Uuid
  dataPointId   String?   @map("data_point_id") @db.Uuid
  alertType     String    @map("alert_type") @db.VarChar(50)
  severity      String    @db.VarChar(20)
  message       String    @db.Text
  value         Decimal?  @db.Decimal(15, 4)
  threshold     Decimal?  @db.Decimal(15, 4)
  status        String    @default("active") @db.VarChar(20)
  acknowledgedBy String?  @map("acknowledged_by") @db.Uuid
  acknowledgedAt DateTime? @map("acknowledged_at")
  resolvedAt    DateTime? @map("resolved_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  
  station       scada_stations @relation(fields: [stationId], references: [id])
  
  @@index([stationId])
  @@index([severity])
  @@index([status])
  @@map("scada_alerts")
}

model scada_commands {
  id          String    @id @default(uuid()) @db.Uuid
  deviceId    String    @map("device_id") @db.Uuid
  command     String    @db.VarChar(100)
  parameters  Json      @default("{}")
  status      String    @default("pending") @db.VarChar(20)
  result      Json?
  executedBy  String    @map("executed_by") @db.Uuid
  executedAt  DateTime? @map("executed_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@index([deviceId])
  @@map("scada_commands")
}
```

### Environment Variables

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/electricity_management"
JWT_SECRET="scada-system-secret-key"
API_PORT=3005
WS_PORT=3015
CORE_API_URL="http://localhost:3001/api/v1"
ASSETS_API_URL="http://localhost:3003/api/v1"
```
